
<!DOCTYPE html>
<html>


<head>
<title> Visualizing snake </title>
</head>


<body>

<div class="panel">
<canvas id="canvas" width="1000" height="600" style="position:relative; top:50px; left:50px"></canvas>
</div>

<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
 
boardx = 10;
boardy = 10;
cellS = 40;
windx = 1000;
windy = 600;
marginx = (windx - boardx * cellS) / 2
marginy = (windy - boardy * cellS) / 2
border = 5
snakeWidth = 20
appleSize = 20
textSize = 20

framesPerMove = 7

dir = [[0,1], [1,0], [0,-1], [-1,0]];

pi = Math.PI;

space = "#fff"
cLine = "#000"
cShade = "#eee"
cSnake = "#00f"
cApple = "#f00"
cText = "#000"

cValue = "#d00"
cSearch = "#bb0"
cNetwork = "#0d0"

TIME_LIMIT = 1200

function randint(max){
    return Math.floor(Math.random()*max)
}

class Environment{
    constructor(){
        this.timer = 0
        this.score = 0;
        this.actionType = 0;
        this.snakeSize = 2;
        this.headx = boardx/2;
        this.heady = 2;
        this.tailx = this.headx;
        this.taily = 1;

        this.snake = []
        for(var i=0; i<boardx; i++){
            this.snake[i] = []
            for(var j=0; j<boardy; j++){
                this.snake[i][j] = -1;
            }
        }
        this.snake[this.headx][this.heady] = 4;
        this.snake[this.tailx][this.taily] = 0;
        this.applex = 0;
        this.appley = 0;
    }

    agentAction(actionIndex){
        this.timer ++
        var newHeadx = this.headx + dir[actionIndex][0];
        var newHeady = this.heady + dir[actionIndex][1];
        this.snake[this.headx][this.heady] = actionIndex;
        this.headx = newHeadx;
        this.heady = newHeady;
        this.snake[newHeadx][newHeady] = 4;

        if(this.headx == this.applex && this.heady == this.appley){
            this.score += 1;
            //score += 1 - timer*0.5/maxTime;
            this.snakeSize++;
            this.actionType = 1;
        }
        else{
            var tailDir = this.snake[this.tailx][this.taily];
            this.snake[this.tailx][this.taily] = -1;
            this.tailx += dir[tailDir][0];
            this.taily += dir[tailDir][1];
        }
    }

    chanceAction(actionIndex){
        this.applex = Math.floor(actionIndex / boardy);
        this.appley = actionIndex % boardy;
        this.actionType = 0
    }

    validAgentAction(d){
        var newHeadx = this.headx + dir[d][0];
        var newHeady = this.heady + dir[d][1];
        if(newHeadx == -1 || newHeadx == boardx){
            return false;
        }
        if(newHeady == -1 || newHeady == boardy){
            return false;
        }
        return this.snake[newHeadx][newHeady] == -1;
    }

    randomChanceAction(){
        while(true){
            this.applex = randint(boardx)
            this.appley = randint(boardy)
            if(this.snake[this.applex][this.appley] == -1){
                break
            }
        }
        this.actionType = 0
    }
}

env = new Environment();

//Agent game:
actions = [63,1,0,16,3,3,0,0,3,3,3,0,90,1,1,2,1,1,2,1,1,2,2,2,1,2,1,77,0,0,0,0,0,3,3,6,3,3,3,2,3,3,3,3,87,0,1,1,1,1,1,1,1,1,96,1,2,92,2,2,2,2,43,3,0,3,3,3,3,62,2,1,1,29,1,3,3,3,3,0,0,0,0,0,3,0,0,0,45,1,2,2,2,2,79,1,0,0,1,1,0,0,80,1,1,2,2,2,2,2,2,2,2,74,0,0,0,0,3,18,0,3,3,3,3,0,0,3,3,0,6,3,2,42,1,1,2,1,2,2,1,96,0,0,1,1,0,1,1,0,35,3,3,3,2,3,3,40,0,3,2,2,2,1,2,2,1,2,18,3,3,3,0,0,0,0,0,0,1,0,82,3,1,1,1,1,1,1,1,2,2,2,2,2,2,3,48,3,0,1,0,0,0,0,3,3,3,11,3,2,1,2,3,2,2,3,3,2,2,2,21,1,43,0,0,1,80,2,1,2,2,1,1,1,26,1,3,3,3,0,0,3,3,0,3,3,6,3,3,20,2,2,2,2,2,2,1,97,0,3,1,1,2,2,0,1,2,1,1,0,0,0,0,0,0,57,3,3,3,3,98,0,1,1,1,1,63,2,2,2,1,1,2,2,2,16,3,0,0,3,3,0,3,33,2,2,1,1,2,60,2,2,2,1,1,1,87,1,1,1,0,0,0,0,0,0,3,86,2,19,3,0,3,3,0,3,3,3,3,9,3,46,1,1,1,1,2,62,1,1,2,2,2,36,3,0,0,0,3,0,99,0,3,3,1,1,2,1,1,2,2,1,1,1,0,0,0,1,1,0,0,0,0,0,93,3,3,3,3,3,2,1,1,1,1,1,3,3,2,1,1,2,3,0,0,0,2,2,2,1,1,1,2,1,0,1,1,0,22,0,0,3,3,2,2,2,2,2,2,1,1,1,2,3,3,74,0,0,0,3,0,1,2,1,1,1,1,77,0,0,0,48,3,2,2,3,3,0,3,2,83,1,1,1,1,2,2,2,2,2,56,2,3,2,1,1,0,2,1,0,1,1,2,1,0,0,0,57,0,50,3,2,2,3,3,0,2,2,2,2,2,2,2,3,2,2,20,1,0,0,0,0,0,0,0,0,0,3,2,2,2,2,1,83,0,3,0,1,0,3,0,3,0,1,1,3,3,2,1,0,3,2,1,1,1,51,2,3,3,3,2,34,3,0,0,0,89,2,0,1,1,0,0,0,0,0,0,88,2,9,3,0,2,2,2,2,2,2,36,1,1,0,3,1,1,76,1,2,1,1,11,0,1,2,0,3,2,2,3,3,62,3,0,0,47,0,1,1,0,0,2,0,2,2,3,8,3,0,1,1,3,3,12,2,2,2,2,2,2,23,1,91,3,1,3,0,0,2,1,2,2,2,0,3,1,1,1,94,0,0,0,87,0,0,0,0,2,83,2,2,2,2,64,3,3,0,82,1,0,0,0,0,3,3,3,3,1,3,1,0,1,1,1,1,2,2,2,2,1,1,1,26,0,0,0,0,0,1,3,10,3,3,3,97,0,0,0,0,98,0,88,3,87,2,74,2,2,2,2,3,79,9,3,7,2,2,2,23,1,15,3,1,28,68,66,65,55]
values = [2.4318,2.55979,2.69452,1.69452,1.7837,1.87758,1.9764,2.08042,2.18992,2.30518,2.4265,2.55421,1.55421,1.63601,1.72212,1.81276,1.90817,2.0086,2.11431,2.22559,2.34273,2.46603,2.59582,2.73244,2.87625,3.02764,3.18699,2.42325,2.55079,2.68505,2.82636,2.97512,3.1317,3.29653,3.47003,2.47003,2.60003,2.73688,2.88092,3.03255,3.19216,3.36017,3.53702,3.72318,2.72318,2.8665,3.01737,3.17618,3.34335,3.51931,3.70454,3.89952,4.10476,4.3208,3.3208,3.49557,3.67955,2.67955,2.82058,2.96903,3.1253,3.28979,2.28979,2.4103,2.53716,2.67069,2.81126,2.95922,3.11497,2.11497,2.22628,2.34345,2.46679,1.46679,1.62525,1.71079,1.80084,1.89562,1.99539,2.10041,2.21095,2.32732,2.44981,2.57875,2.71447,2.85734,3.00773,3.16603,2.16603,2.28003,2.40003,2.65931,2.79928,2.94661,1.94661,2.04906,2.1569,2.27043,2.38992,2.51571,2.64811,2.78749,1.78749,1.88157,2.08484,2.19457,2.31007,2.43165,2.55963,2.69435,2.83616,2.98543,3.30796,2.30796,2.42943,2.55729,2.69189,2.83356,2.9827,1.9827,2.08705,2.1969,2.31252,2.43424,2.56235,2.69721,2.83917,2.9886,3.1459,3.31147,2.31147,2.43313,2.69599,1.69599,1.78525,1.97811,2.08223,2.19182,2.30717,2.42861,2.55643,1.55643,1.63834,1.81534,1.91088,2.01146,2.11732,2.22876,2.34606,2.46954,1.46954,1.54688,1.6283,1.714,1.89917,1.99912,2.10434,1.16247,1.22365,1.28805,1.35584,1.4272,1.50232,1.66462,1.75223,1.84445,1.94153,2.04371,1.04371,1.15647,1.21734,1.34885,1.41984,1.49457,1.57323,1.65603,1.74319,1.83494,1.93152,2.03318,1.03318,1.26847,1.33523,1.40551,1.47948,1.55735,1.63931,1.72559,1.91201,2.01265,2.11857,2.23008,2.34745,2.471,2.60105,2.73795,1.73795,1.82942,1.92571,2.13375,2.24605,2.36426,2.4887,2.75756,2.90269,3.05547,3.21628,2.21628,2.33293,2.45571,2.58496,2.72101,2.86422,3.01497,3.17366,3.34069,3.51652,3.7016,3.89642,4.10149,3.10149,3.26473,2.26473,2.38392,2.64147,2.78049,1.78049,1.8742,1.97284,2.07668,2.18598,2.30103,2.42213,2.54961,1.54961,1.71702,1.80739,1.90252,2.10806,2.21901,2.3358,2.45873,2.72436,2.86774,3.01868,3.17756,2.17756,2.29216,2.4128,1.4128,1.48716,1.56543,1.64782,1.73455,1.82584,2.0231,2.12958,1.12958,1.18903,1.31748,1.38682,1.45981,1.53664,1.70265,1.79227,1.8866,2.20043,2.31625,2.56648,2.70156,2.84374,2.99341,3.15096,3.3168,3.49137,2.49137,2.62249,2.76052,2.90581,3.05875,2.05875,2.1671,2.28116,2.40122,2.5276,2.66063,2.25908,2.37798,2.50314,2.63488,2.77356,2.91954,3.0732,3.23495,3.40521,2.40521,2.5318,2.66505,2.95296,3.10838,3.27198,3.44419,3.62546,2.62546,2.76365,2.9091,3.06221,3.22338,3.39303,2.39303,2.51898,2.65156,2.79112,2.93802,3.09265,3.25542,2.25542,2.37413,2.49908,2.76907,2.91481,3.06822,3.2297,3.39969,3.57862,3.76696,3.96523,2.96523,3.12129,2.12129,2.23294,2.35046,2.47417,2.74146,2.88575,3.03763,3.19751,3.3658,3.54294,2.54294,2.67678,1.76503,1.85793,1.95572,2.05865,2.28105,2.40111,1.40111,1.47485,1.63418,1.72019,1.81073,1.90603,0.906027,0.953713,1.00391,1.05675,1.17091,1.23254,1.29741,0.297406,0.329536,0.34688,0.384354,0.404584,0.448292,0.471886,0.496723,0.550385,0.579353,0.609845,0.641942,0.675729,0.711293,0.74873,0.788137,0.829617,0.873281,0.919244,0.967625,1.01855,1.07216,1.12859,1.18799,0.197884,0.208299,0.219262,0.230802,0.255736,0.269196,0.283364,0.313977,0.330502,0.347897,0.366207,0.40577,0.427126,0.449606,0.47327,0.498179,0.611633,0.643824,0.67771,0.713378,0.750925,0.83205,0.875842,0.970462,1.02154,1.1319,1.19147,1.32019,1.38967,1.46282,1.53981,1.62085,1.70616,1.79595,0.795954,0.837846,1.55053,1.63214,1.80846,1.90365,2.00384,2.1093,2.22032,2.33718,2.46019,2.58967,2.72597,1.72597,1.81681,1.91243,2.01309,1.24381,1.30927,1.37818,1.52707,1.69204,1.7811,1.87484,2.07738,2.18672,2.30181,2.42296,2.55048,1.55048,1.63209,1.71798,1.80841,0.808405,0.850953,0.89574,0.992509,1.04475,1.15761,1.21854,1.28267,1.83676,0.836756,0.880795,0.927153,0.97595,1.02732,1.08139,1.1383,1.19821,1.26127,1.32766,0.327658,0.344903,0.363056,0.382164,0.402278,0.42345,1.24339,1.30883,1.37772,1.6069,1.69147,1.7805,1.87421,1.97285,2.07669,2.18598,2.30104,1.30104,1.36951,0.369512,0.38896,0.409432,0.477541,0.502675,0.55698,0.617153,0.839558,0.883746,0.930259,0.97922,1.03076,1.08501,1.14211,1.20222,1.2655,1.3321,0.332105,0.349584,0.387351,0.407738,0.429198,0.451787,0.475565,0.500595,0.526942,0.554676,0.583869,1.08052,1.13739,1.19725,1.26026,1.39641,1.46991,0.46991,0.494642,0.54808,0.576926,0.607291,0.639254,0.784836,0.826143,1.18301,1.31082,1.37981,1.52888,1.60934,1.7832,1.87706,1.97585,2.42583,2.5535,2.6879,2.82936,2.97828,3.13503,2.13503,2.2474,2.36568,2.49019,2.62126,2.75922,1.75922,1.85181,1.94927,2.05186,2.27353,1.41112,1.82366,2.02068,2.12703,2.23898,2.61144,2.74888,2.89356,3.04585,3.20616,3.55253,2.55253,2.68687,1.68687,1.77566,2.67652,1.85764,1.95541,2.05833,2.16666,2.28069,2.40073,1.40073,1.47445,1.55205,1.63374,1.81024,2.00581,2.2225,1.2225,1.28684,1.50091,1.5799,1.66306,0.663057,0.697954,0.81406,0.902005,1.05205,1.16571,1.22706,1.94695,2.04942,2.15729,1.15729,1.74442,1.83623,1.93288,0.932879,1.03366,1.08806,1.14533,1.48017,1.64008,1.81727,2.01359,2.11957,2.34855,2.47216,1.47216,1.54964,1.6312,1.71706,2.21905,2.33584,2.58819,1.58819,1.67178,1.75976,1.85238,1.94988,2.0525,2.27424,1.27424,1.4119,0.411901,0.4564,0.505706,0.560339,0.589831,0.762271,0.844621,0.889075,0.935868,1.03697,1.27313,1.82309,2.74801,2.89265,3.04489,3.37384,2.37384,2.49878,2.6303,2.76873,1.76873,1.86182,1.95981,2.06296,2.53278,2.66608,1.66608,1.75377,1.84607,1.94323,2.04551,1.04551,1.10054,1.15846,1.21943,0.21943,0.243136,0.255932,0.269402,0.283581,0.314218,0.330755,0.348164,0.366488,0.644318,0.713925,0.791053,1.02232,1.13277,1.19239,1.25514,1.3212,1.46394,1.54099,1.70746,1.89193,1.9915,2.09632,2.20665,2.32279,1.70951,1.79949,1.8942,1.99389,2.09884,2.2093,2.71244,3.00548,2.7282,2.87179,3.02293,3.5258,4.44058,4.67429,4.92031,5.17927,5.45186,4.45186,4.68617,3.68617,3.88018,2.88018,3.03177,2.03177,2.1387,2.25127,2.36975,2.62577,3.06256,2.66557,1.66557,2.38504,1.53468,0.623619,0.656441,0.690991,-0.325273,-0.360413,-1.36041,-1.50738,-1.75814,-3.38627,-5.38519,-7.075,-8.5,-10]
network_values = [3.32127,3.4082,3.59027,2.1283,2.39166,2.61469,2.70125,2.74008,2.9225,3.11149,3.1329,3.20222,1.96503,1.7218,1.78509,1.93138,2.02979,2.15039,2.36674,2.50374,2.42634,2.7076,2.46357,2.63817,2.8471,3.05356,2.95056,2.37249,2.56438,2.64838,2.84192,2.94778,3.03065,3.07769,3.13257,2.07371,2.25835,2.22558,2.35181,2.28364,2.80861,2.58846,3.01687,3.24743,2.11668,2.03748,2.12672,2.28058,2.28292,2.50043,2.65795,2.77022,2.92318,3.19619,2.66499,2.94041,3.06538,2.28532,2.76592,2.87291,2.94676,2.80769,2.71466,2.62346,2.59385,2.79172,2.87909,3.30761,2.94651,2.5312,2.53706,2.81286,2.92546,1.86047,1.65028,1.62958,1.77873,1.94705,2.12325,2.17642,2.02148,2.23401,2.24274,2.59771,2.41813,2.55395,2.85179,2.88396,2.31126,2.14643,2.39564,2.76971,3.08715,2.94232,1.85227,1.92666,2.2985,2.56036,2.49966,2.55893,2.82485,2.71614,1.86468,1.94665,2.08603,1.96472,2.26574,2.39773,2.32762,2.58987,2.62201,2.76856,3.02632,2.78322,2.55958,2.98927,3.20327,3.11103,3.17806,1.70037,1.76361,1.74839,1.91652,2.11663,2.29516,2.38751,2.48722,2.65837,2.45953,2.61064,2.06652,2.09958,2.79953,2.03332,2.1254,2.20669,2.50071,2.49558,2.55925,2.7722,2.83272,1.77872,1.87084,2.07808,2.17102,2.04654,2.44073,2.25613,2.65094,2.68246,1.82372,1.80832,2.16345,2.04035,2.79491,2.53067,2.51572,1.71038,1.69919,1.71162,1.84189,1.98457,2.31137,2.16957,2.58112,2.35382,2.37321,2.53232,1.52665,1.65796,1.68173,1.65191,1.87993,2.13897,2.11883,2.35905,2.11574,2.385,2.31121,2.27627,1.29258,1.57156,1.76127,1.63548,1.86666,2.18288,1.86957,2.1054,2.59982,2.60498,2.45985,2.6894,2.87812,2.9254,3.09644,3.05485,1.48952,1.73964,1.84053,2.07559,2.20845,2.31271,2.45622,2.56339,2.72375,2.78643,2.73428,1.71466,1.44187,2.00834,1.67978,1.45511,1.6186,1.51845,1.94247,1.96741,2.01086,2.21264,2.41702,2.49942,2.41,2.4678,1.9115,2.2694,2.29002,2.40426,1.83114,1.92349,1.91914,1.59108,2.07786,1.97979,2.31666,2.37974,1.29284,1.18114,1.35637,1.42755,1.70177,1.67847,1.45312,1.89268,2.24088,2.39299,2.26205,2.40333,2.26358,2.31621,2.3795,1.60139,1.84112,1.80503,1.76835,1.91032,1.90236,2.64027,2.43677,1.29094,1.05671,1.39866,1.30768,1.48206,1.52798,1.89359,1.50057,1.6506,2.16724,2.09952,2.02287,2.5174,2.45705,2.47101,2.9655,3.05068,3.00362,2.37728,2.36472,2.61319,2.83078,2.91563,1.67971,1.67865,1.85678,2.18589,1.64248,2.78856,1.93339,1.97743,2.34074,2.33396,2.46007,2.41447,2.62993,2.43454,2.70202,1.58825,1.66357,1.85533,2.03274,2.04859,2.29243,2.47808,2.40809,1.8829,2.05389,2.03381,2.44934,2.44751,2.49853,1.86553,1.496,1.65225,1.95703,1.76868,1.9242,2.2799,1.49438,1.29659,1.52888,1.60844,1.52116,1.722,2.00214,1.83089,2.07538,2.12895,1.96742,2.16689,1.77547,1.24847,0.939425,1.26579,1.32582,1.54954,1.59966,1.61368,1.77212,2.06525,2.18736,1.81325,1.9645,1.71543,1.78835,1.8007,2.08093,2.08567,2.22083,1.29512,1.28428,1.71657,2.1719,2.11846,2.43979,1.38869,1.06617,1.61609,1.83464,2.30945,1.86309,2.29012,1.11464,1.2646,0.870323,1.05184,0.805211,0.933057,0.825151,0.786651,0.839429,1.16563,1.09438,1.0765,1.31778,1.23789,1.52071,1.72482,1.48509,1.49909,1.67332,1.91644,1.72673,1.91014,1.4801,1.68401,1.14644,0.973315,0.914901,1.02578,1.34494,1.11184,0.861536,1.27079,1.28571,1.47482,0.728366,1.28963,1.5351,1.35528,1.46003,1.60472,1.0026,0.870376,1.18606,0.799638,1.34842,0.913774,0.843136,1.32242,1.21966,1.2634,1.4805,1.80689,1.16414,1.72385,2.25095,1.45304,2.10029,2.16386,1.10607,1.03619,1.63635,1.94468,1.81958,1.77344,2.01011,1.60499,2.00944,2.20129,1.94141,1.97531,2.07875,1.48815,1.33725,1.83062,1.79128,1.2939,1.57319,1.67841,1.41871,1.71569,1.62844,1.32233,1.36729,1.96152,1.96712,2.6513,2.84469,1.95201,2.00393,1.96183,2.45319,1.0675,2.07865,1.57346,1.56458,1.01171,1.31779,1.51433,1.56639,2.1391,1.19673,1.2657,1.30184,1.44418,1.53634,1.45134,1.76529,1.55079,2.18325,2.07244,1.04627,1.16308,1.23955,0.81185,1.19274,1.14089,1.65895,2.1208,1.73105,1.63256,1.65708,1.68078,1.63633,1.56918,1.60399,1.94848,2.15086,2.02827,1.82145,0.839708,1.17298,1.22305,1.45485,1.28808,1.0904,1.52896,1.4488,1.40249,1.06905,1.25278,1.86867,2.00429,2.00321,1.98888,2.25818,2.13892,1.52506,0.954716,1.03179,1.11066,0.978087,0.553443,0.661249,0.429741,0.684108,0.277027,0.939362,1.44823,1.81319,1.82453,1.99785,1.93253,1.94169,1.5252,1.03292,0.8461,0.537619,1.03608,1.04825,1.17369,0.503739,1.07256,0.958951,0.750917,1.43219,0.911012,1.48992,1.50069,1.13985,1.88114,1.79681,1.77096,1.87148,2.53278,2.37789,1.46004,1.2867,1.72785,1.97797,1.7054,2.06866,1.23796,1.4111,1.26129,0.539708,1.10255,0.0821812,0.0874725,0.526222,0.768584,1.02028,1.25597,1.30253,1.53797,1.84595,2.00756,2.04492,1.65145,2.04048,0.994874,1.43453,1.9756,1.88282,1.35478,1.43945,1.94752,2.04362,2.06104,1.1999,0.720247,0.842508,1.36398,1.85175,2.04811,1.94177,0.72572,1.25739,1.86411,1.65066,1.83037,0.200515,-0.0716048,0.478569,0.47995,1.04396,0.810322,1.03704,1.55393,1.67687,1.91019,1.13419,2.15838,1.81147,1.77886,0.853853,0.74342,0.878544,0.909293,1.31662,1.48203,1.87295,1.74008,1.71084,2.18352,2.16904,1.1104,1.37825,1.43512,1.43529,1.98305,2.1533,2.14833,1.73238,1.92221,1.30853,1.8039,2.30234,1.80562,2.10988,2.22935,2.11156,0.74222,0.579717,0.523469,0.396512,0.357529,0.697006,1.24361,0.504289,1.27627,1.26057,0.892959,1.02306,2.2256,2.80535,2.63121,2.63677,2.19194,2.32425,2.74815,2.42046,2.50944,2.70875,2.34307,2.32398,2.66921,2.72675,1.37031,1.96531,1.87525,2.59483,2.81156,2.58686,2.42791,2.39703,3.14303,1.18499,1.12382,0.794004,1.06245,0.924547,1.01502,0.915306,0.777664,0.910656,0.807799,0.5823,0.802451,0.476838,0.710965,0.382456,0.890529,0.887927,1.07855,1.26714,0.832693,1.35344,1.80011,1.73977,2.07255,2.7046,1.73026,1.07764,1.35541,1.77278,1.43936,1.82224,2.07938,1.71234,2.1545,2.28438,2.36541,2.16154,2.03435,2.78527,2.33045,3.39625,3.07147,2.92465,2.94416,2.82162,4.52593,3.01927,4.2801,2.46857,2.28408,2.66564,2.8313,3.95023,4.11456,5.6754,2.95761,4.94136,5.55381,3.78665,3.95554,4.98422,6.13326,4.53953,5.40867,7.10282,7.50998,9.18837,8.2034,9.38985,8.00677,9.58395]
search_values = [3.14766,3.27116,3.47416,2.04549,2.11097,2.21916,2.37407,2.54273,2.73535,2.91333,3.08671,3.27472,1.46236,1.54629,1.6286,1.69385,1.77003,1.8302,1.91625,2.01926,2.16811,2.24286,2.36673,2.57691,2.72523,2.85442,3.01472,2.08444,2.28247,2.41876,2.56952,2.71824,2.87404,3.01756,3.19361,1.7981,1.91729,2.19029,2.36758,2.50709,2.64657,2.79076,2.94837,3.11656,1.58924,1.64601,1.93126,2.11959,2.3027,2.46851,2.61752,2.76832,2.9171,3.0815,2.87849,2.99621,3.16303,2.51863,2.6271,2.72987,2.86881,3.02672,2.02439,2.34003,2.53918,2.69273,2.83606,3.00265,3.1727,2.53678,2.65634,2.77363,2.92987,1.13914,1.19495,1.28204,1.36514,1.43865,1.53951,1.72888,1.90741,2.06593,2.21873,2.34417,2.48996,2.62646,2.76481,2.92105,2.28736,2.39674,2.52062,2.78937,2.93114,3.09155,1.815,2.01801,2.1855,2.30124,2.43779,2.55199,2.69576,2.85364,1.45073,1.6427,1.86646,1.98464,2.10167,2.22149,2.34364,2.4767,2.60737,2.74704,3.04628,2.47893,2.60735,2.75906,2.89165,3.03037,3.19776,1.53378,1.48747,1.6186,1.67933,1.77079,2.01467,2.21381,2.36252,2.49162,2.6295,2.78607,2.41944,2.54784,2.83226,1.71994,1.87981,2.15578,2.31074,2.45566,2.56833,2.71311,2.87288,1.57899,1.60302,1.84962,2.07628,2.2429,2.36542,2.47357,2.5804,2.72514,1.76149,1.95958,2.07706,2.18593,2.41726,2.55195,2.69286,1.29599,1.31378,1.48269,1.70042,1.84129,1.95655,2.19232,2.30678,2.4182,2.5504,2.70757,0.895857,1.12587,1.38612,1.64283,1.79724,1.91399,2.02901,2.13779,2.25353,2.37078,2.47247,2.6109,1.06254,1.35138,1.3644,1.42589,1.46736,1.48247,1.65065,1.83334,2.08421,2.23194,2.36491,2.49397,2.62694,2.76865,2.91849,3.07754,1.57838,1.54618,1.62589,1.86991,1.98886,2.08016,2.19375,2.44403,2.57146,2.71064,2.858,1.32797,1.34321,1.38793,1.34902,1.39627,1.47556,1.6708,1.91138,2.05064,2.17642,2.31043,2.44036,2.58028,2.44479,2.60616,2.08123,2.22376,2.44174,2.58805,1.45598,1.69867,1.8841,2.0313,2.15313,2.26711,2.37476,2.50568,0.915769,1.02485,1.01583,1.24272,1.49909,1.67913,1.80835,1.9382,2.16988,2.28828,2.40151,2.53833,2.26082,2.35232,2.4985,1.56515,1.69604,1.77515,1.88196,1.98115,2.10366,2.33583,2.46464,0.759456,0.872297,0.739471,0.991615,1.13073,1.23029,1.40958,1.45997,1.56485,1.83402,1.94347,2.16031,2.27817,2.40646,2.53395,2.67165,2.80852,2.95895,2.24811,2.44118,2.56212,2.72156,2.88354,1.84858,2.02219,2.14185,2.26098,2.37808,2.51866,1.54713,1.74931,1.89059,2.0234,2.15536,2.28314,2.42213,2.56577,2.71205,1.46902,1.6693,1.78323,1.97889,2.0936,2.19309,2.24296,2.37861,1.76217,1.93263,2.03569,2.15825,2.24844,2.41971,1.23549,1.60672,1.75161,1.85752,1.94824,2.05168,2.16587,1.01547,1.23597,1.36845,1.56276,1.64608,1.73462,1.83309,1.93512,2.01627,2.12429,2.24366,2.10599,2.24924,0.950005,1.31886,1.42573,1.52325,1.67809,1.77131,1.84723,1.9318,2.02698,2.13859,2.09663,2.22453,1.72397,1.82289,1.93093,2.06172,2.29339,2.42497,1.5395,1.65622,1.7757,1.87646,1.95878,2.0906,1.53237,1.65666,1.72736,1.83163,2.03733,2.13962,2.26373,0.373313,0.37672,0.400165,0.430487,0.42419,0.494958,0.487543,0.503428,0.605783,0.667165,0.767849,0.883697,0.977363,1.06214,1.16764,1.26066,1.33855,1.42259,1.50158,1.58071,1.66402,1.75263,1.85248,1.95621,0.429236,0.344871,0.415419,0.390981,0.403865,0.377226,0.255398,0.242702,0.22319,0.252181,0.211052,0.285679,0.287216,0.328048,0.373707,0.430038,0.517743,0.544525,0.573609,0.602462,0.634179,0.705984,0.71478,0.768086,0.892053,1.12125,1.32156,1.43027,1.49185,1.58201,1.61827,1.65325,1.69284,1.78798,0.448623,0.497669,1.02226,1.04998,1.19038,1.24924,1.32717,1.39513,1.45552,1.55157,1.66916,1.7991,1.91643,1.72422,1.77368,1.84199,1.94675,0.874395,1.11182,1.20125,1.37208,1.55507,1.68354,1.79079,2.00058,2.12827,2.25853,2.39105,2.52486,1.82327,1.8141,1.94997,2.06965,0.943597,0.921256,1.05488,1.12028,1.21819,1.37268,1.40889,1.41088,2.03703,1.16216,1.33849,1.49071,1.60349,1.71487,1.82992,1.94335,2.05695,2.17937,2.29747,0.611439,0.49341,0.298946,0.243314,0.341857,0.363607,1.05819,1.1117,1.18871,1.40625,1.48657,1.53224,1.39423,1.41993,1.46384,1.54094,1.64391,1.5648,1.70195,0.233449,0.408883,0.506348,0.65251,0.697116,0.791497,0.886106,1.21482,1.2811,1.35607,1.43478,1.51202,1.58783,1.66847,1.75268,1.83389,1.94997,0.116522,0.315441,0.425888,0.519732,0.571988,0.612057,0.658592,0.702566,0.740439,0.778927,0.823877,1.52228,1.60082,1.67923,1.76852,1.95114,2.06296,0.439581,0.313311,0.30794,0.194017,0.224988,0.297291,0.38937,0.464343,0.653893,0.771831,0.858284,0.972351,1.07325,1.20625,1.30326,1.38419,1.7315,1.87727,2.01217,2.14998,2.28623,2.42013,1.47166,1.44777,1.51249,1.49345,1.53009,1.60798,0.689606,1.01887,1.16906,1.24054,1.37768,0.602928,0.855755,1.00985,1.0971,1.20408,1.44963,1.54828,1.64482,1.75037,1.86159,2.06693,1.7441,1.85035,1.37292,1.43789,2.17569,1.5229,1.61697,1.69423,1.78819,1.87531,1.97965,1.14918,1.35198,1.44337,1.51167,1.62013,1.79151,2.00338,1.19945,1.21911,1.35697,1.38217,1.48211,0.0655863,0.384816,0.532526,0.713629,0.867946,0.982074,1.05077,1.6718,1.75846,1.85656,1.16506,1.73481,1.82316,1.92734,0.586884,0.818737,0.872966,0.919918,1.1888,1.31808,1.47194,1.60639,1.71973,1.9299,2.03869,1.27576,1.29244,1.41328,1.53578,1.99367,2.10682,2.34153,1.44141,1.46671,1.47849,1.54911,1.61752,1.66833,1.85647,1.92538,2.13999,-0.0184117,0.20124,0.332028,0.435806,0.466831,0.625482,0.718514,0.779655,0.836949,0.933227,1.15416,1.65314,2.49412,2.62915,2.76756,3.06943,2.48137,2.65837,2.82733,2.98241,1.95352,2.06573,2.18797,2.34158,2.86651,3.02305,2.23716,2.36453,2.46574,2.57511,2.71599,2.048,2.1432,2.29587,2.4332,-0.0202551,-0.106831,-0.162891,-0.0212184,0.105049,0.191742,0.256882,0.30075,0.332884,0.602345,0.680671,0.761101,0.995897,1.11354,1.18883,1.26959,1.34865,1.50193,1.59068,1.76555,1.96272,2.07261,2.18458,2.30373,2.42851,1.46712,1.59763,1.71676,1.82074,1.90761,2.01666,2.47351,2.74241,2.51034,2.64537,2.78964,3.25956,2.6181,2.77684,2.9554,3.14078,3.31075,2.9773,3.14892,3.01231,3.21716,3.13619,3.39132,2.59879,2.57855,2.59463,2.79419,3.11188,3.63134,4.06832,2.92879,4.21121,5.08636,3.83764,3.90737,4.11386,4.06503,4.51373,3.45492,3.48058,4.06326,4.81461,6.69529,5.23877,0,-10]

function updateEnvironment(index){
    env = new Environment()
    for(i=0; i<index; i++){
        if(i == 0 || env.actionType == 1){
            env.chanceAction(actions[i])
        }
        else{
            env.agentAction(actions[i])
        }
        while(env.actionType == 0){
            // Check if there is only one valid action
            numValidActions = 0
            validAction = -1
            for(d = 0; d < 4; d++){
                if(env.validAgentAction(d)){
                    numValidActions++
                    validAction = d
                }
            }
            if(numValidActions == 1){
                env.agentAction(validAction)
            }
            else{
                break
            }
        }
    }
}


updateEnvironment(1)
currAction = actions[1]
currActionIndex = 2

/*
updateEnvironment(203)
currAction = actions[203]
currActionIndex = 204
*/
tick = 0


/*
//Manual game:
currAction = 0
tick = -1
env.randomChanceAction()
*/

console.log(env)


function fillRect(color,sx,sy,l,w){
    ctx.fillStyle = color;
    ctx.fillRect(sx,sy,l,w);
}

function drawLine(color,p1x,p1y,p2x,p2y, width){
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(p1x,p1y);
    ctx.lineTo(p2x,p2y);
    ctx.stroke();
}

function fillCirc(color,x,y,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,2*pi);
    ctx.fillStyle = color;
    ctx.fill();
}

function fillText(text,color,size,x,y){
    ctx.font = String(size)+"px Arial";
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.fillText(text,x,y);
}

document.addEventListener("keydown",keyHandler);
document.addEventListener("click",clickHandler);

keyMove = ["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"]

paused = true

function keyHandler(event){
    key = event.code
    event.preventDefault()
    /*
    for(i=0; i<4; i++){
        if(keyMove[i] == key){
            if(env.timer != TIME_LIMIT && env.validAgentAction(i)){
                currAction = i
                tick = 0
            }
        }
    }
    */
    if(key == "Space"){
        paused = !paused
        if(paused){
            tick = 0
        }
    }
    if(key == "ArrowRight"){
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowLeft"){
        while(true){
            currActionIndex--
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowDown"){
        currActionIndex = 2
        currAction = actions[currActionIndex-1]
        updateEnvironment(currActionIndex-1)
    }
    if(key == "ArrowUp"){
        currActionIndex = actions.length - 15
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
}

function clickHandler(event){
    rect = canvas.getBoundingClientRect();
    x = event.clientX - rect.left;
    y = event.clientY - rect.top;
}

function draw(){
    fillRect(space, 0, 0, windx, windy)
    fillRect(cLine, marginx - border, marginy - border, boardx*cellS + 2*border, boardy*cellS + 2*border)
    fillRect(space, marginx, marginy, boardx*cellS, boardy*cellS)
    for(var i = 0; i < boardx; i++){
        for(var j = 0; j < boardy; j++){
            if((i + j) % 2 == 0){
                fillRect(cShade, marginx + j * cellS, marginy + i * cellS, cellS, cellS)
            }
        }
    }
    fillCirc(cApple, marginx + env.appley*cellS + cellS/2, marginy + env.applex*cellS + cellS/2, appleSize/2)
    for(i = 0; i < boardx; i++){
        for(j = 0; j < boardy; j++){
            type = env.snake[i][j]
            if(type != -1){
                centerx = marginx + j*cellS + cellS/2
                centery = marginy + i*cellS + cellS/2
                slideProp = tick / framesPerMove
                if(i == env.tailx && j == env.taily && (env.headx + dir[currAction][0] != env.applex || env.heady + dir[currAction][1] != env.appley)){
                    nextx = centerx + dir[type][1] * cellS * slideProp
                    nexty = centery + dir[type][0] * cellS * slideProp
                    fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    drawLine(cSnake, nextx, nexty, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                }
                else{
                    fillCirc(cSnake, centerx, centery, snakeWidth / 2)
                    if(type == 4){
                        nextDir = dir[currAction]
                        nextx = centerx + nextDir[1] * cellS * (tick / framesPerMove)
                        nexty = centery + nextDir[0] * cellS * (tick / framesPerMove)
                        drawLine(cSnake, centerx, centery, nextx, nexty, snakeWidth)
                        fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    }
                    else{
                        drawLine(cSnake, centerx, centery, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                    }
                }
            }
        }
    }
    fillText("Score: " + env.score.toString(), cText, textSize, windx/2, marginy/2)
    fillText("Timer: " + env.timer.toString(), cText, textSize, windx/2, marginy/2 + textSize * 1.5)


    fillText("Value", cValue, textSize, marginx/3, textSize)
    fillText(values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize)
    fillText("Search Value", cSearch, textSize, marginx/3, textSize*2)
    fillText(search_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*2)
    fillText("Network Value", cNetwork, textSize, marginx/3, textSize*3)
    fillText(network_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*3)

    drawLine(cValue, marginx/4, windy/2, marginx/4, windy/2 - values[currActionIndex-2] * 25, marginx/4)

    drawLine(cSearch, marginx*2/4, windy/2, marginx*2/4, windy/2 - search_values[currActionIndex-2] * 25, marginx/4)

    drawLine(cNetwork, marginx*3/4, windy/2, marginx*3/4, windy/2 - network_values[currActionIndex-2] * 25, marginx/4)

    //fillText("Reward", cText, textSize, marginx/4, 100)
    //fillText(values[currActionIndex-1].toString(), cText, textSize, marginx/4, 120)
    //drawLine(cText, marginx/4, windy/2, marginx/4, windy/2 + rewards[currActionIndex-1] * 100, 3)
}

endState = false

function update(){
    if(endState) return
    draw()
    if(!paused){
        tick++
    }
    if(tick >= framesPerMove){
        tick = 0

        env.agentAction(currAction)
        if(env.actionType == 1){
            env.chanceAction(actions[currActionIndex])
            currActionIndex++
        }
        if(env.timer == TIME_LIMIT){
            endState = true
            return
        }

        // Check if there is only one valid action
        numValidActions = 0
        validAction = -1
        for(i = 0; i < 4; i++){
            if(env.validAgentAction(i)){
                numValidActions++
                validAction = i
            }
        }
        if(numValidActions == 0){
            endState = true
            return
        }
        if(numValidActions == 1){
            currAction = validAction
        }
        else{
            currAction = actions[currActionIndex]
            currActionIndex++
        }
    }
}

function updateManual(){
    draw()
    if(tick == -1){
        
    }
    else if(tick < framesPerMove){
        tick++
    }
    else{
        env.agentAction(currAction)
        tick = -1
        if(env.actionType == 1){
            env.randomChanceAction()
        }
    }
}

var ONE_FRAME_TIME = 1000 / 60 ;
var mainloop = function() {
    update()
    //updateManual()
};
setInterval( mainloop, ONE_FRAME_TIME );

</script>

</body>

</html>
