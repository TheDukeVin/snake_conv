
<!DOCTYPE html>
<html>


<head>
<title> Visualizing snake </title>
</head>


<body>

<div class="panel">
<canvas id="canvas" width="1000" height="600" style="position:relative; top:50px; left:50px"></canvas>
</div>

<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
 
boardx = 10;
boardy = 10;
cellS = 40;
windx = 1000;
windy = 600;
marginx = (windx - boardx * cellS) / 2
marginy = (windy - boardy * cellS) / 2
border = 5
snakeWidth = 20
appleSize = 20
textSize = 20

framesPerMove = 7

dir = [[0,1], [1,0], [0,-1], [-1,0]];

pi = Math.PI;

space = "#fff"
cLine = "#000"
cShade = "#eee"
cSnake = "#00f"
cApple = "#f00"
cText = "#000"

cValue = "#d00"
cSearch = "#bb0"
cNetwork = "#0d0"

cPolicy = "#66d"
cNetPolicy = "#f0f"

TIME_LIMIT = 1200

function randint(max){
    return Math.floor(Math.random()*max)
}

class Environment{
    constructor(){
        this.timer = 0
        this.score = 0;
        this.actionType = 0;
        this.snakeSize = 2;
        this.headx = boardx/2;
        this.heady = 2;
        this.tailx = this.headx;
        this.taily = 1;

        this.snake = []
        for(var i=0; i<boardx; i++){
            this.snake[i] = []
            for(var j=0; j<boardy; j++){
                this.snake[i][j] = -1;
            }
        }
        this.snake[this.headx][this.heady] = 4;
        this.snake[this.tailx][this.taily] = 0;
        this.applex = 0;
        this.appley = 0;
    }

    agentAction(actionIndex){
        this.timer ++
        var newHeadx = this.headx + dir[actionIndex][0];
        var newHeady = this.heady + dir[actionIndex][1];
        this.snake[this.headx][this.heady] = actionIndex;
        this.headx = newHeadx;
        this.heady = newHeady;
        this.snake[newHeadx][newHeady] = 4;

        if(this.headx == this.applex && this.heady == this.appley){
            this.score += 1;
            //score += 1 - timer*0.5/maxTime;
            this.snakeSize++;
            this.actionType = 1;
        }
        else{
            var tailDir = this.snake[this.tailx][this.taily];
            this.snake[this.tailx][this.taily] = -1;
            this.tailx += dir[tailDir][0];
            this.taily += dir[tailDir][1];
        }
    }

    chanceAction(actionIndex){
        this.applex = Math.floor(actionIndex / boardy);
        this.appley = actionIndex % boardy;
        this.actionType = 0
    }

    validAgentAction(d){
        var newHeadx = this.headx + dir[d][0];
        var newHeady = this.heady + dir[d][1];
        if(newHeadx == -1 || newHeadx == boardx){
            return false;
        }
        if(newHeady == -1 || newHeady == boardy){
            return false;
        }
        return this.snake[newHeadx][newHeady] == -1;
    }

    randomChanceAction(){
        while(true){
            this.applex = randint(boardx)
            this.appley = randint(boardy)
            if(this.snake[this.applex][this.appley] == -1){
                break
            }
        }
        this.actionType = 0
    }
}

env = new Environment();

//Agent game:
actions = [96,1,1,1,1,0,0,0,0,51,3,2,2,2,2,2,3,3,3,87,0,1,0,0,1,0,0,1,0,12,3,3,3,3,3,3,2,2,2,2,3,2,85,1,1,1,1,1,1,0,0,1,0,66,0,3,3,48,0,3,0,3,43,2,2,2,2,2,52,1,2,85,1,1,0,0,0,1,37,0,3,0,3,3,3,3,22,2,2,2,2,3,2,11,3,2,56,1,1,0,0,0,0,1,0,41,1,2,2,3,2,2,3,18,3,3,0,3,0,0,0,0,0,0,0,47,1,1,2,1,85,1,1,1,1,2,2,93,1,2,2,62,2,3,3,3,26,3,3,3,3,0,0,0,0,96,1,0,1,1,1,1,1,1,2,40,2,1,2,2,2,2,3,3,3,3,3,3,3,3,3,0,0,26,0,0,0,1,1,45,1,2,1,56,0,1,29,0,3,3,3,0,0,17,1,2,0,2,2,2,2,3,3,2,3,0,3,0,0,0,21,3,2,1,1,2,26,2,1,0,0,1,0,0,0,0,3,3,3,3,3,9,0,0,3,3,91,1,1,1,1,1,1,2,2,2,2,2,2,2,0,2,3,3,3,3,3,3,3,3,68,0,0,0,0,0,0,1,1,1,1,0,1,11,2,2,3,3,3,3,3,2,2,2,2,9,0,0,0,0,2,2,2,2,2,3,0,0,60,2,2,1,1,1,2,2,2,2,2,2,2,1,74,0,0,0,0,1,99,0,0,0,0,0,1,1,80,2,2,2,2,2,2,2,2,83,0,0,0,2,0]
values = [1.9028,2.00295,2.10837,2.21933,2.33614,2.45909,2.58852,2.72476,2.86817,1.86817,1.96649,2.06999,2.17894,2.29362,2.41433,2.5414,2.67516,2.81596,2.96417,1.96417,2.06755,2.17636,2.29091,2.41148,2.5384,2.672,2.81264,2.96067,3.11649,2.11649,2.22789,2.34515,2.46857,2.5985,2.73526,2.87922,3.03076,3.19028,3.35819,3.53493,3.72098,3.91682,2.91682,3.07034,3.23194,3.40204,3.58109,3.76957,3.96797,4.17681,4.39664,4.62804,4.87162,3.87162,4.07539,4.28989,4.51567,3.51567,3.70071,3.89548,4.10051,4.31632,3.31632,3.49087,3.6746,3.868,4.07158,4.28587,3.28587,3.45881,3.64085,2.64085,2.77984,2.92615,3.08016,3.24227,3.41292,3.59255,2.59255,2.729,2.87263,3.02382,3.18297,3.35049,3.52683,3.71246,2.71246,2.85522,3.00549,3.16368,3.33019,3.50546,3.68996,2.68996,2.83153,2.98056,1.98056,2.0848,2.19453,2.43161,2.55959,2.6943,2.83611,2.98538,3.1425,2.1425,2.25527,2.37396,2.49891,2.76888,2.91461,3.06801,3.22948,2.34682,2.47034,2.60036,2.73722,2.88128,3.03293,3.19256,3.36058,3.53746,3.72364,3.91962,4.12592,3.12592,3.29044,3.46362,3.64591,3.8378,2.8378,2.98716,3.14438,3.30988,3.48408,3.66745,3.86048,2.86048,3.01103,3.1695,3.33632,2.33632,2.45928,2.58872,2.72497,2.86839,1.86839,1.96672,2.07023,2.17919,2.29389,2.41462,2.5417,2.67548,2.81629,1.81629,1.91189,2.01251,2.11843,2.22993,2.3473,2.47084,2.60088,2.73777,2.88186,1.98091,2.08517,2.31044,2.43204,2.56004,2.69478,2.9859,3.14306,3.30848,3.48261,3.66591,2.66591,2.80622,2.95391,3.10938,3.4453,3.62663,3.81751,2.81751,2.96579,3.12189,3.2862,3.45916,3.64122,2.64122,2.78023,2.92656,3.08059,2.08059,2.19009,2.30536,1.30536,1.37406,1.44638,1.52251,1.60264,1.68699,1.77578,0.775777,0.816607,0.904828,1.00258,1.11089,1.16936,1.2309,1.29569,1.43567,1.51123,1.59077,1.67449,1.85539,1.95304,2.05584,2.16404,2.27793,1.27793,1.34519,1.65154,1.73847,1.92628,2.02766,1.02766,1.08175,1.13869,1.19862,1.32811,1.39801,1.54904,1.71639,1.80672,1.90181,2.00191,2.10727,2.21818,2.33493,2.45782,1.45782,1.53455,1.61531,1.70033,1.88402,1.03108,1.08534,1.14247,1.2026,1.26589,1.33252,1.47647,1.55418,1.63598,1.72209,1.81272,1.90813,2.00856,2.11427,1.11427,1.23465,1.29963,1.36803,1.44003,1.51582,1.5956,1.67958,1.76798,1.86103,0.906351,0.954054,1.00427,1.05712,1.11276,1.17133,1.29787,1.36618,1.43808,1.51377,1.59344,1.67731,1.76559,0.765589,0.805883,0.848298,0.892946,0.939943,0.989413,1.04149,1.154,1.21474,1.27867,1.34597,1.41681,0.438751,0.461843,0.48615,0.511737,0.567022,0.596865,0.628279,0.661346,0.696154,0.732794,1.2239,1.28832,1.35612,0.374864,0.394594,0.437223,0.460235,0.484458,0.509956,0.536795,0.565048,0.594787,0.626092,0.659044,0.693731,0.730243,0.768677,-0.231323,-0.243498,-0.256314,-0.269804,-0.284005,-0.298952,-1.29895,-1.36732,-1.43928,-1.51503,-1.59477,-1.67871,-1.76706,-1.86006,-3.01059,-3.16905,-3.33584,-3.51141,-3.69622,-3.89076,-4.09553,-4.31109,-4.77683,-5.77683,-6.08087,-6.40092,-6.73781,-7.73781,-10]
network_values = [1.97227,2.09774,2.23028,2.40545,2.50757,2.47128,2.74506,2.92201,3.19199,2.18026,1.9251,2.30737,2.38255,2.52271,2.73232,2.79544,2.98885,3.22321,3.24901,1.81822,1.90057,2.13943,2.24968,2.56415,2.62165,2.69553,2.84372,2.86928,3.25613,1.53533,1.56472,1.69489,1.6943,1.73599,1.98844,2.23719,2.19352,2.6574,2.58405,2.84086,2.84847,3.21718,1.72479,1.85007,2.07378,2.24347,2.19439,2.60308,2.61376,2.75038,2.8968,3.07766,3.16897,2.80813,2.80384,3.04931,3.1328,2.63527,2.54681,2.82769,3.07007,3.21641,2.25845,2.46498,2.5992,2.81218,3.1609,3.24238,2.88125,3.05778,3.17283,2.15362,2.29169,2.54781,2.57787,2.62783,2.84824,2.76949,2.13317,2.44849,2.62899,2.45929,2.63055,2.8769,2.94417,3.16052,2.3454,2.46073,2.51427,2.71699,2.94006,2.86402,3.03513,2.73654,2.83814,2.82975,1.58804,1.67621,1.9609,2.07132,2.38305,2.6531,2.88228,3.15884,3.11892,1.98709,1.8167,1.94289,2.22574,2.21389,2.48078,2.5416,2.59853,1.60798,1.68279,1.67984,1.7644,1.73267,2.12593,2.12777,2.41772,2.3487,2.55018,2.8144,3.003,2.47848,2.75934,2.84679,2.77712,3.24477,2.26026,2.52911,2.47177,2.46311,2.79731,2.83834,3.03681,2.51815,2.42855,2.77195,2.77337,2.52531,2.63073,2.69895,2.94544,2.96054,2.06405,2.16125,2.15161,2.35537,2.09532,2.3231,2.51444,2.89209,2.78753,1.66475,1.72403,1.48289,1.75561,1.84886,1.77641,2.13213,2.34305,2.09666,2.62747,1.33171,1.75774,1.82143,1.9546,1.97735,2.03911,2.27738,2.3487,2.63368,2.8223,2.97898,2.0223,2.40682,2.50641,2.45313,2.5665,2.88478,3.12142,2.46361,2.59576,2.59385,2.63511,2.87465,2.90936,2.61492,2.67511,2.66224,2.84173,2.7318,2.78125,2.83645,1.68528,1.82368,1.98367,2.04788,1.98322,2.24352,2.106,2.14859,1.55002,1.30591,1.21913,1.45989,0.907123,1.42098,1.29135,1.20731,1.47944,1.37107,1.49803,1.89607,1.8896,1.99477,2.20227,2.63726,1.12266,1.20472,1.99736,2.01795,2.37704,2.25091,1.30102,1.5526,1.32758,1.18521,1.47576,1.48301,1.48509,1.46697,1.35156,1.9652,2.00776,1.75936,2.21561,2.33394,2.2932,1.54574,1.7288,1.78449,1.93339,2.38765,0.996166,1.09695,0.904164,1.27674,1.58297,1.39615,1.35418,1.73991,1.99625,2.09834,2.03897,2.4504,2.4493,2.53867,1.95829,2.12554,2.2415,2.15827,2.16397,2.35105,2.23781,2.43879,2.6899,2.65326,1.3318,1.46488,1.61189,1.689,1.76004,1.8161,1.948,1.82122,2.1529,2.16547,2.30492,2.31302,2.65891,1.17081,1.17572,1.2735,1.46177,1.21325,1.61157,1.72385,1.73552,1.82083,2.32978,2.67764,2.53188,0.966803,1.13404,1.04996,1.10654,1.07603,1.32146,1.38127,1.15225,0.701599,1.02624,2.0296,2.18766,2.30351,1.23671,1.14858,0.908591,1.28155,1.4008,1.58503,1.36914,1.67875,1.52542,1.70417,1.95034,1.94083,2.28041,2.46577,1.06225,1.71222,1.99112,1.98711,1.58367,2.35313,0.877052,1.336,1.74899,0.89333,1.43957,1.97425,2.27527,1.98858,0.656972,1.75069,0.804521,0.697917,1.19891,1.11933,1.49104,-0.540576,-1.60472,-3.34558,1.66856,-2.01143,-1.95428,-3.72102,-1.28728]
search_values = [2.07209,2.18568,2.30334,2.43362,2.56527,2.70587,2.85294,3.00177,3.15981,2.04413,2.13631,2.2514,2.37646,2.50832,2.6417,2.79154,2.94242,3.10441,3.26889,1.96886,2.07114,2.18665,2.30548,2.42525,2.56815,2.7124,2.85536,3.00826,3.16672,1.68078,1.74961,1.84515,1.95292,2.05788,2.16994,2.28182,2.40478,2.54381,2.6833,2.8289,2.98378,3.14093,1.88585,1.97617,2.08593,2.21193,2.33177,2.45873,2.58981,2.72904,2.87826,3.03786,3.19773,2.7602,2.6841,2.84098,2.99117,2.53119,2.66544,2.8316,2.98719,3.14426,2.50535,2.64057,2.78451,2.94091,3.09413,3.25691,2.82637,2.99189,3.14917,2.22646,2.33668,2.46358,2.60419,2.75302,2.89603,3.04853,2.15954,2.27664,2.39885,2.55554,2.70053,2.84643,3.00167,3.16042,2.25097,2.34764,2.4738,2.61848,2.7649,2.92197,3.07582,2.60973,2.77329,2.91906,1.97662,2.09168,2.20186,2.43715,2.56582,2.70091,2.8468,3.00392,3.16188,1.76591,1.89076,1.99995,2.1227,2.36698,2.49449,2.62815,2.76675,1.65316,1.73476,1.84645,1.96199,2.06653,2.18445,2.30262,2.43043,2.56057,2.69673,2.84098,2.99076,2.54044,2.68248,2.81653,2.96339,3.11971,2.21752,2.32456,2.44386,2.57444,2.68711,2.81571,2.96388,2.43077,2.57972,2.7216,2.86474,2.43482,2.56069,2.68209,2.82824,2.97694,1.91325,2.01563,2.11901,2.23348,2.35051,2.47841,2.61373,2.75072,2.89555,1.5501,1.67123,1.74044,1.81629,1.89945,1.98689,2.08829,2.19618,2.3058,2.42729,1.5636,1.6662,1.85626,1.95771,2.06364,2.17591,2.42118,2.55281,2.68962,2.83447,2.98366,2.16809,2.28106,2.39245,2.52117,2.80165,2.94893,3.1042,2.39583,2.53377,2.68855,2.85451,3.01411,3.17355,2.58994,2.75711,2.93125,3.08602,2.68837,2.86702,3.01815,1.78909,1.86098,1.94805,2.05765,2.18816,2.3046,2.43039,0.60902,0.700293,0.799473,0.859113,0.97598,1.03634,1.10521,1.17089,1.30876,1.3893,1.48432,1.57322,1.75624,1.8725,1.97841,2.08432,2.19404,1.53946,1.63,2.01905,2.10652,2.33609,2.4629,0.944033,1.01732,1.04719,1.07887,1.19425,1.2617,1.40808,1.56507,1.6529,1.74795,1.85358,1.96318,2.07506,2.1912,2.30702,1.64512,1.74553,1.84544,1.93603,2.14519,1.30333,1.38265,1.45886,1.54357,1.6314,1.71899,1.91241,2.01752,2.12818,2.24706,2.369,2.4967,2.63076,2.76929,1.75725,1.94792,2.06122,2.1697,2.28189,2.40356,2.53218,2.66136,2.80476,2.95244,1.45138,1.54083,1.63383,1.69602,1.76303,1.83609,2.04468,2.18898,2.22781,2.35541,2.47607,2.62343,2.76201,1.33178,1.41424,1.48548,1.56469,1.65503,1.74369,1.83821,2.03582,2.14225,2.25527,2.37055,2.49516,0.767327,0.846906,0.90465,0.959177,1.06377,1.12382,1.18986,1.25456,1.32159,1.39556,2.3352,2.46102,2.59083,1.13228,1.19026,1.32267,1.39275,1.46449,1.53692,1.62339,1.70446,1.79339,1.88566,1.98503,2.09133,2.19955,2.316,1.70901,1.80075,1.8914,1.99984,2.10874,2.22121,1.06255,0.980055,0.894114,0.825793,0.796979,0.728571,0.640213,0.673108,-0.891059,-1.03323,-1.18069,-1.49228,-1.79727,-2.12531,-2.49044,-2.87288,-3.15596,-3.48857,-4.78336,-5.45954,-5.74835,-7.98219,2.65766]
network_policy = [[0.00759763,0.992393,-1,8.87536e-06],[0.0429361,0.956818,0.000245857,-1],[0.0540914,0.945349,0.000559581,-1],[0.134738,0.86502,0.000241809,-1],[0.998052,-1,0.0019482,-1],[0.999417,-1,-1,0.00058302],[0.999219,-1,-1,0.000781356],[0.998014,-1,-1,0.00198648],[-1,-1,-1,-1],[0.00405948,-1,-1,0.995941],[4.07915e-06,-1,0.998765,0.0012311],[-1,1.41516e-05,0.995071,0.00491503],[-1,1.64571e-05,0.966825,0.0331581],[-1,2.67348e-05,0.964614,0.0353595],[-1,1.03173e-05,0.533565,0.466425],[-1,1.65316e-05,0.0423275,0.957656],[0.000327725,-1,0.0139243,0.985748],[0.000341837,-1,0.11229,0.887368],[-1,-1,-1,-1],[0.983772,-1,0.0152412,0.000987329],[0.0158844,0.984114,-1,1.72172e-06],[0.400329,0.599671,-1,-1],[0.606383,0.39347,-1,0.00014694],[0.275867,0.724128,-1,4.65192e-06],[0.99124,0.0087602,1.99554e-07,-1],[0.924346,0.0755215,-1,0.000132243],[0.115743,0.884206,-1,5.12116e-05],[0.998576,0.00142187,2.46062e-06,-1],[-1,-1,-1,-1],[0.000376515,0.000333611,-1,0.99929],[9.74601e-05,-1,-1,0.999903],[8.20734e-05,-1,0.345853,0.654065],[0.000159442,-1,0.100475,0.899365],[2.85002e-05,-1,0.0485986,0.951373],[5.09156e-06,-1,0.224568,0.775427],[6.05808e-05,-1,0.813135,0.186805],[-1,0.000856641,0.674782,0.324361],[-1,2.16231e-05,0.979612,0.020366],[-1,7.90152e-05,0.948415,0.0515063],[-1,5.48981e-05,0.567463,0.432482],[1.21831e-05,-1,0.994612,0.00537561],[-1,-1,-1,-1],[-1,0.999444,0.00055062,5.52916e-06],[-1,0.999732,0.000268279,-1],[0.010303,0.9894,0.000296926,-1],[0.00432262,0.995655,2.23451e-05,-1],[0.0937593,0.906212,2.86882e-05,-1],[0.0224962,0.977495,8.80649e-06,-1],[0.884654,0.115325,2.10854e-05,-1],[0.724144,0.275367,-1,0.000488922],[0.498705,0.501243,-1,5.26296e-05],[0.991936,0.00805692,7.45694e-06,-1],[-1,-1,-1,-1],[0.796815,0.000438054,-1,0.202747],[0.00694566,6.79073e-06,-1,0.993048],[0.0403237,-1,0.00773211,0.951944],[-1,-1,-1,-1],[0.904452,-1,7.23017e-05,0.0954759],[0.581185,0.000826462,-1,0.417989],[0.765872,-1,0.000133085,0.233995],[0.00199528,3.97299e-06,-1,0.998001],[-1,-1,-1,-1],[5.98297e-05,-1,0.995253,0.00468717],[-1,-1,0.998613,0.00138705],[-1,0.0108031,0.987996,0.0012005],[-1,0.00122451,0.997147,0.0016281],[-1,0.000800495,0.995979,0.00322032],[-1,-1,-1,-1],[-1,0.609369,0.390624,7.63893e-06],[4.57051e-05,0.00101743,0.998937,-1],[-1,-1,-1,-1],[-1,0.999976,1.81196e-05,5.82079e-06],[0.36519,0.634713,9.61737e-05,-1],[0.772355,0.227639,6.05526e-06,-1],[0.914747,0.0723426,-1,0.0129106],[0.749432,0.249011,-1,0.00155766],[0.00140093,0.998584,-1,1.48403e-05],[-1,-1,-1,-1],[0.999755,4.86772e-05,0.000196055,-1],[0.106012,6.65681e-06,-1,0.893981],[0.0821481,-1,-1,0.917852],[0.00363395,7.30721e-05,-1,0.996293],[0.00613087,-1,0.00118377,0.992685],[0.000747175,-1,0.000796914,0.998456],[0.00988042,-1,0.0323336,0.957786],[-1,-1,-1,-1],[9.65758e-05,-1,0.832053,0.167851],[-1,2.86099e-05,0.970121,0.0298506],[-1,7.49067e-05,0.954401,0.0455238],[-1,7.81225e-05,0.818663,0.181259],[-1,2.91782e-05,0.335789,0.664182],[5.60344e-06,-1,0.998035,0.0019594],[-1,-1,-1,-1],[-1,0.0001131,0.364876,0.635011],[8.95657e-05,-1,0.993708,0.00620248],[-1,-1,-1,-1],[-1,0.880679,0.040481,0.0788401],[-1,0.961035,0.038965,-1],[0.944105,0.0552868,0.000608346,-1],[0.981559,0.0181466,0.000294336,-1],[0.996921,0.0030793,-1,-1],[0.995418,0.00458185,-1,-1],[0.500217,0.499783,-1,-1],[0.999428,0.000517618,5.48031e-05,-1],[-1,-1,-1,-1],[0.0364872,0.148903,-1,0.81461],[0.00788976,0.00828872,0.983822,-1],[-1,0.00537189,0.994628,-1],[-1,0.00012646,0.218097,0.781777],[-1,0.003459,0.996541,-1],[-1,0.00180465,0.998195,-1],[-1,9.89072e-05,0.013487,0.986414],[-1,-1,-1,-1],[-1,0.00106303,-1,0.998937],[0.455383,-1,-1,0.544617],[0.429401,-1,-1,0.570599],[0.24288,0.0129586,-1,0.744162],[0.788208,-1,0.0110234,0.200768],[0.922525,0.00311663,-1,0.0743585],[0.970326,0.00139348,-1,0.0282803],[0.999056,0.000360441,-1,0.000583634],[0.999143,2.09575e-05,-1,0.000836135],[0.999263,6.31745e-05,-1,0.000673963],[0.969449,0.00125974,-1,0.0292909],[-1,-1,-1,-1],[0.0185876,0.981268,-1,0.000144045],[0.000245168,0.984514,0.0152413,-1],[0.00143348,0.681758,0.316809,-1],[-1,0.998181,0.00142041,0.000398645],[-1,-1,-1,-1],[0.000507539,0.989866,0.00962636,-1],[0.000260378,0.986779,0.0129608,-1],[6.5982e-05,0.953657,0.0462769,-1],[3.48254e-05,0.513273,0.486693,-1],[7.97595e-06,0.0307982,0.969194,-1],[-1,0.00945297,0.989374,0.0011728],[-1,-1,-1,-1],[-1,0.0815127,0.918093,0.000394617],[0.000439862,-1,0.99956,-1],[-1,-1,0.996866,0.00313374],[-1,-1,-1,-1],[-1,-1,0.792998,0.207002],[-1,-1,0.0164013,0.983599],[0.0245178,-1,0.0170755,0.958407],[0.00163978,-1,0.00176131,0.996599],[-1,-1,-1,-1],[0.0877297,-1,0.00112462,0.911146],[0.0944809,-1,7.37729e-05,0.905445],[0.239333,-1,0.00343753,0.757229],[0.159602,-1,0.000211768,0.840186],[0.973422,-1,0.000194321,0.0263832],[0.986748,0.00270305,-1,0.0105486],[0.996584,0.00182845,-1,0.00158802],[0.987441,0.000319175,-1,0.0122401],[-1,-1,-1,-1],[0.540221,0.0552756,-1,0.404504],[0.687029,0.21522,0.0977512,-1],[0.184329,0.760857,-1,0.0548146],[0.0659094,0.919929,0.0141617,-1],[0.0642712,0.914682,0.0210464,-1],[0.0161592,0.976826,0.00701515,-1],[0.00549034,0.98657,0.00793979,-1],[0.0123825,0.950255,0.037363,-1],[0.00325649,-1,0.996744,-1],[-1,-1,-1,-1],[-1,-1,0.610116,0.389884],[-1,0.505045,0.491111,0.00384375],[-1,-1,0.99242,0.0075798],[-1,-1,0.994669,0.00533132],[-1,-1,0.981274,0.0187256],[-1,-1,0.982577,0.0174232],[0.000728342,-1,-1,0.999272],[0.00100266,-1,-1,0.998997],[0.000273515,-1,-1,0.999726],[0.00428757,-1,-1,0.995712],[-1,-1,-1,-1],[0.000911443,-1,-1,0.999089],[0.000665282,-1,-1,0.999335],[0.0142808,-1,-1,0.985719],[0.0205126,-1,-1,0.979487],[0.991096,0.00890361,-1,-1],[0.999325,0.000674826,-1,-1],[-1,-1,-1,-1],[0.999526,0.000474162,-1,-1],[0.996682,0.00331751,-1,-1],[0.936944,0.063056,-1,-1],[0.025375,0.974625,-1,-1],[0.00151582,0.98234,0.0161444,-1],[-1,-1,-1,-1],[0.000524726,0.972282,0.0271929,-1],[5.21577e-05,0.611649,0.388299,-1],[-1,0.997366,0.00260975,2.42913e-05],[-1,-1,-1,-1],[0.627978,0.372007,1.47238e-05,-1],[0.0124786,0.987521,-1,-1],[-1,-1,-1,-1],[0.989582,0.00485411,0.00556392,-1],[0.053181,0.000485892,-1,0.946333],[0.0891689,-1,-1,0.910831],[0.352959,-1,-1,0.647041],[0.958454,-1,-1,0.0415458],[0.766953,0.109963,-1,0.123084],[-1,-1,-1,-1],[-1,0.00628988,-1,0.99371],[-1,0.0711506,0.928849,-1],[0.490523,0.509477,-1,-1],[-1,0.0934695,0.90653,-1],[0.453241,0.0288352,0.517924,-1],[-1,0.032754,0.967246,-1],[-1,0.155036,0.844964,-1],[-1,0.0481276,0.215002,0.73687],[-1,0.00906262,0.0130896,0.977848],[-1,-1,0.0204294,0.979571],[-1,0.0597041,0.0227689,0.917527],[0.929505,-1,0.00259603,0.0678985],[0.825915,-1,0.00434533,0.16974],[0.962516,-1,0.000692403,0.0367911],[0.950927,0.0421316,-1,0.0069413],[0.989813,0.00391988,-1,0.00626756],[-1,-1,-1,-1],[0.0230491,-1,-1,0.976951],[0.00479347,-1,0.995207,-1],[-1,0.268257,0.731743,-1],[-1,0.142868,0.857132,-1],[-1,0.206566,0.745534,0.0478994],[-1,-1,-1,-1],[-1,0.285814,0.0865698,0.627616],[-1,0.762592,-1,0.237408],[0.74931,0.25069,-1,-1],[0.969924,0.0300756,-1,-1],[-1,0.843293,0.156707,-1],[0.951782,0.0421171,0.00610126,-1],[0.91191,0.036708,0.0513815,-1],[0.952193,0.0282525,0.0195542,-1],[0.984163,0.0158372,-1,-1],[0.236595,0.00317725,-1,0.760228],[0.0916101,-1,0.0822994,0.82609],[0.0123358,-1,0.0512049,0.936459],[0.0118627,-1,0.0326922,0.955445],[0.0278953,-1,0.0450504,0.927054],[-1,-1,-1,-1],[0.896854,-1,0.103146,-1],[0.620745,0.379255,-1,-1],[0.0749299,0.00617319,-1,0.918897],[0.0119572,-1,-1,0.988043],[-1,-1,-1,-1],[-1,0.95647,0.0435304,-1],[-1,0.863783,0.136217,-1],[-1,0.987933,0.0120667,-1],[-1,0.987343,0.0126571,-1],[-1,0.990963,0.00903712,-1],[-1,0.977234,0.0227659,-1],[-1,-1,0.957035,0.0429646],[-1,-1,0.998747,0.00125265],[-1,-1,0.997624,0.00237645],[-1,-1,0.998931,0.0010687],[-1,-1,0.998693,0.00130736],[-1,-1,0.997945,0.00205454],[-1,-1,0.997952,0.00204803],[-1,-1,-1,-1],[-1,-1,0.993565,0.00643517],[0.0154581,-1,-1,0.984542],[0.000225095,-1,-1,0.999775],[0.000483718,-1,-1,0.999516],[0.00155007,-1,-1,0.99845],[0.000151735,-1,-1,0.999848],[0.000433103,-1,-1,0.999567],[0.00694884,-1,-1,0.993051],[0.00533204,-1,-1,0.994668],[-1,-1,-1,-1],[0.715032,0.284968,-1,-1],[0.893821,0.106179,-1,-1],[0.97592,0.0240796,-1,-1],[0.989052,0.0109477,-1,-1],[0.991064,0.00893646,-1,-1],[0.994157,0.00584271,-1,-1],[0.503811,0.490078,0.00611099,-1],[0.141988,0.854874,0.00313805,-1],[0.130986,0.868772,0.000242824,-1],[0.0181427,0.980519,0.00133812,-1],[0.243942,0.755609,0.000448877,-1],[-1,0.999824,-1,0.000176482],[-1,-1,-1,-1],[-1,0.116244,0.883756,-1],[-1,0.0191929,0.980807,-1],[-1,0.013209,0.111997,0.874794],[-1,-1,0.162471,0.837529],[-1,-1,0.0832365,0.916763],[-1,-1,0.223645,0.776355],[-1,-1,0.38016,0.61984],[-1,0.0297081,0.970292,-1],[-1,0.0338764,0.966124,-1],[-1,0.00446887,0.995531,-1],[-1,0.000527863,0.999472,-1],[-1,-1,-1,-1],[0.359764,0.640236,-1,-1],[0.899602,0.100398,-1,-1],[0.957376,0.0426238,-1,-1],[0.996808,0.00319194,-1,-1],[-1,0.296303,0.703697,-1],[-1,0.293749,0.706251,-1],[-1,0.0838702,0.91613,-1],[-1,0.042671,0.957329,-1],[-1,0.0532786,0.946721,-1],[-1,0.00837024,-1,0.99163],[0.970899,0.0291007,-1,-1],[0.993674,0.00632563,-1,-1],[-1,-1,-1,-1],[-1,0.178364,0.821636,-1],[-1,0.0838495,0.91615,-1],[0.154845,0.845155,-1,-1],[0.0351868,0.964813,-1,-1],[0.0384568,0.961543,-1,-1],[0.000147444,0.0788469,0.921006,-1],[-1,0.0344451,0.935446,0.0301085],[-1,0.0707083,0.910052,0.0192402],[-1,0.0216277,0.93586,0.0425125],[-1,0.00978816,0.987412,0.00279942],[-1,0.107703,0.8777,0.0145968],[-1,0.151275,0.842991,0.00573386],[-1,0.967159,-1,0.0328407],[-1,-1,-1,-1],[0.968335,0.0316647,-1,-1],[0.977708,0.0222922,-1,-1],[0.913265,0.0867349,-1,-1],[0.833058,0.166942,-1,-1],[0.0134121,0.986588,-1,-1],[-1,-1,-1,-1],[0.937479,0.0570745,0.00544663,-1],[0.746745,0.0845556,-1,0.168699],[0.941403,0.0554198,-1,0.0031775],[0.964569,0.0343956,-1,0.00103551],[0.603707,0.391611,-1,0.00468277],[-1,0.99372,-1,0.00627986],[-1,0.981736,0.0182639,-1],[-1,-1,-1,-1],[-1,-1,0.779217,0.220783],[-1,-1,0.833679,0.166321],[-1,-1,0.962233,0.037767],[-1,-1,0.980308,0.0196918],[-1,-1,0.987925,0.0120746],[-1,-1,0.85398,0.14602],[-1,-1,0.984312,0.0156882],[-1,-1,0.955057,0.0449429],[-1,-1,-1,-1],[0.0816573,-1,-1,0.918343],[0.870146,-1,-1,0.129854],[0.98184,-1,-1,0.0181598],[-1,-1,-1,-1],[0.0648308,-1,-1,0.935169],[0.774756,-1,0.225244,-1],]
search_policy = [[0,1,-1,0],[2.53786e-05,0.999975,0,-1],[0.000578308,0.999422,0,-1],[0.000690225,0.99931,0,-1],[1,-1,0,-1],[1,-1,-1,0],[1,-1,-1,0],[1,-1,-1,0],[-1,-1,-1,-1],[0,-1,-1,1],[0,-1,1,0],[-1,0,1,0],[-1,0,0.998094,0.00190621],[-1,0,0.999962,3.8181e-05],[-1,0,0.783656,0.216344],[-1,0,4.30432e-06,0.999996],[0,-1,7.40606e-07,0.999999],[0,-1,8.68873e-06,0.999991],[-1,-1,-1,-1],[1,-1,0,0],[2.36791e-05,0.999976,-1,0],[0.477061,0.522939,-1,-1],[0.866711,0.133289,-1,0],[0.118185,0.881815,-1,0],[1,0,0,-1],[0.999975,2.4937e-05,-1,0],[0.00164425,0.998356,-1,0],[1,0,0,-1],[-1,-1,-1,-1],[0,0,-1,1],[0,-1,-1,1],[0,-1,0.109316,0.890684],[0,-1,0.000810511,0.999189],[0,-1,0.00580684,0.994193],[0,-1,0.200495,0.799505],[0,-1,0.910427,0.0895728],[-1,0,0.964917,0.0350826],[-1,0,0.999999,1.21827e-06],[-1,0,0.99997,2.98053e-05],[-1,0,0.0306636,0.969336],[0,-1,1,0],[-1,-1,-1,-1],[-1,1,0,0],[-1,1,0,-1],[0,1,0,-1],[0,1,0,-1],[0.000259555,0.99974,0,-1],[1.77432e-05,0.999982,0,-1],[0.999329,0.000670709,0,-1],[0.992232,0.00776845,-1,0],[0.00924939,0.990751,-1,0],[1,0,0,-1],[-1,-1,-1,-1],[0.833673,0,-1,0.166327],[0,0,-1,1],[5.40628e-05,-1,0,0.999946],[-1,-1,-1,-1],[0.989673,-1,0,0.010327],[0.450769,0,-1,0.549231],[0.98916,-1,0,0.0108398],[0,0,-1,1],[-1,-1,-1,-1],[0,-1,1,0],[-1,-1,1,0],[-1,0,1,0],[-1,0,1,0],[-1,0,1,0],[-1,-1,-1,-1],[-1,0.964023,0.0359766,0],[0,0,1,-1],[-1,-1,-1,-1],[-1,1,0,0],[0.401473,0.598527,0,-1],[0.99776,0.00223998,0,-1],[0.999755,0.000233425,-1,1.15272e-05],[0.634529,0.365471,-1,0],[0,1,-1,0],[-1,-1,-1,-1],[1,0,0,-1],[0.31472,0,-1,0.68528],[0.944566,-1,-1,0.0554336],[0,0,-1,1],[0,-1,0,1],[0,-1,0,1],[0,-1,3.02983e-06,0.999997],[-1,-1,-1,-1],[0,-1,0.959841,0.0401587],[-1,0,0.999736,0.000264323],[-1,0,0.999921,7.88658e-05],[-1,0,0.976154,0.0238463],[-1,0,0.00397798,0.996022],[0,-1,1,0],[-1,-1,-1,-1],[-1,0,0.0488989,0.951101],[0,-1,1,0],[-1,-1,-1,-1],[-1,0.99995,2.47506e-05,2.47506e-05],[-1,0.999994,6.28133e-06,-1],[0.999997,2.80576e-06,0,-1],[0.999804,0.000196318,0,-1],[1,0,-1,-1],[1,0,-1,-1],[0.114864,0.885136,-1,-1],[1,0,0,-1],[-1,-1,-1,-1],[2.70519e-05,0.98688,-1,0.0130931],[0,0,1,-1],[-1,0,1,-1],[-1,0,2.60301e-05,0.999974],[-1,0,1,-1],[-1,0,1,-1],[-1,0,5.25099e-07,0.999999],[-1,-1,-1,-1],[-1,0,-1,1],[0.0100576,-1,-1,0.989942],[0.997396,-1,-1,0.00260389],[0.00151847,1.93682e-06,-1,0.99848],[0.999484,-1,6.16902e-05,0.000454493],[0.999945,0,-1,5.4664e-05],[0.999998,0,-1,2.44522e-06],[1,0,-1,0],[1,0,-1,0],[1,0,-1,0],[1,0,-1,2.32478e-07],[-1,-1,-1,-1],[0,1,-1,0],[0,1,0,-1],[0,0.352249,0.647751,-1],[-1,1,0,0],[-1,-1,-1,-1],[0,1,0,-1],[0,1,0,-1],[0,0.999899,0.00010066,-1],[0,0.843414,0.156586,-1],[0,1.75431e-06,0.999998,-1],[-1,0,1,0],[-1,-1,-1,-1],[-1,0.744079,0.255921,0],[0,-1,1,-1],[-1,-1,1,0],[-1,-1,-1,-1],[-1,-1,0.984449,0.0155506],[-1,-1,6.88886e-06,0.999993],[2.99324e-06,-1,2.99324e-06,0.999994],[0,-1,0,1],[-1,-1,-1,-1],[0.000212039,-1,0,0.999788],[0.00215866,-1,0,0.997841],[0.00182037,-1,0,0.99818],[0.0176724,-1,0,0.982328],[0.999999,-1,0,1.32422e-06],[0.999999,0,-1,8.78356e-07],[1,0,-1,0],[1,0,-1,4.66571e-07],[-1,-1,-1,-1],[0.00708239,0.988242,-1,0.00467548],[0.992401,0.00756753,3.14985e-05,-1],[0.000274638,0.999712,-1,1.35624e-05],[1.65243e-05,0.999982,1.83603e-06,-1],[7.44708e-05,0.999921,4.65443e-06,-1],[7.90123e-07,0.999999,0,-1],[0,0.999995,5.15745e-06,-1],[4.39139e-07,0.999956,4.39139e-05,-1],[0,-1,1,-1],[-1,-1,-1,-1],[-1,-1,0.997759,0.0022411],[-1,0.992396,0.00760379,0],[-1,-1,1,0],[-1,-1,1,0],[-1,-1,0.999999,1.05627e-06],[-1,-1,0.999999,7.29266e-07],[0,-1,-1,1],[0,-1,-1,1],[0,-1,-1,1],[0,-1,-1,1],[-1,-1,-1,-1],[0,-1,-1,1],[0,-1,-1,1],[2.57646e-06,-1,-1,0.999997],[5.9488e-06,-1,-1,0.999994],[1,0,-1,-1],[1,0,-1,-1],[-1,-1,-1,-1],[1,0,-1,-1],[1,0,-1,-1],[0.999932,6.76244e-05,-1,-1],[1.53932e-06,0.999998,-1,-1],[0,0.999999,9.92047e-07,-1],[-1,-1,-1,-1],[0,0.999978,2.24608e-05,-1],[0,0.00863588,0.991364,-1],[-1,1,0,0],[-1,-1,-1,-1],[0.993032,0.00696845,0,-1],[0,1,-1,-1],[-1,-1,-1,-1],[1,0,0,-1],[0.174736,0,-1,0.825264],[0.000163639,-1,-1,0.999836],[0.0336134,-1,-1,0.966387],[0.999998,-1,-1,1.72675e-06],[0.999955,1.76905e-05,-1,2.76414e-05],[-1,-1,-1,-1],[-1,0.99991,-1,8.98372e-05],[-1,0.000220518,0.999779,-1],[0.999258,0.000742406,-1,-1],[-1,0.000134148,0.999866,-1],[0.00705023,0.000151658,0.992798,-1],[-1,1.35911e-05,0.999986,-1],[-1,0.0436383,0.956362,-1],[-1,6.36935e-07,5.73241e-06,0.999994],[-1,4.75624e-07,4.75624e-07,0.999999],[-1,-1,0.985208,0.0147921],[-1,9.21526e-06,9.43643e-05,0.999896],[0.982564,-1,0,0.0174357],[0.00781384,-1,0,0.992186],[0.999995,-1,0,4.55595e-06],[0.999998,2.10243e-06,-1,2.33603e-07],[1,0,-1,1.94579e-07],[-1,-1,-1,-1],[1.89032e-05,-1,-1,0.999981],[0,-1,1,-1],[-1,0.898464,0.101536,-1],[-1,0.973338,0.0266617,-1],[-1,0.000341011,0.999657,1.73985e-06],[-1,-1,-1,-1],[-1,0.0750434,0.867502,0.0574551],[-1,0.999991,-1,8.96403e-06],[0.995663,0.00433711,-1,-1],[0.999992,8.23362e-06,-1,-1],[-1,0.99863,0.00136986,-1],[0.999986,1.42666e-05,0,-1],[0.999997,6.34909e-07,2.53963e-06,-1],[0.999994,4.2865e-06,1.90511e-06,-1],[1,3.68649e-07,-1,-1],[0.000188442,0,-1,0.999812],[2.01686e-05,-1,1.22008e-05,0.999968],[8.26445e-07,-1,2.06611e-07,0.999999],[6.96764e-07,-1,1.74191e-07,0.999999],[1.48843e-07,-1,5.95374e-07,0.999999],[-1,-1,-1,-1],[0.999982,-1,1.78031e-05,-1],[0.998901,0.00109939,-1,-1],[0.0105016,0,-1,0.989498],[0,-1,-1,1],[-1,-1,-1,-1],[-1,0.999977,2.28927e-05,-1],[-1,0.999945,5.48667e-05,-1],[-1,0.999997,2.7502e-06,-1],[-1,0.999998,1.5586e-06,-1],[-1,0.999999,1.002e-06,-1],[-1,0.999999,6.97929e-07,-1],[-1,-1,0.999999,5.13868e-07],[-1,-1,1,0],[-1,-1,1,0],[-1,-1,1,0],[-1,-1,1,0],[-1,-1,1,0],[-1,-1,1,0],[-1,-1,-1,-1],[-1,-1,1,0],[5.23642e-06,-1,-1,0.999995],[0,-1,-1,1],[0,-1,-1,1],[0,-1,-1,1],[0,-1,-1,1],[0,-1,-1,1],[0,-1,-1,1],[0,-1,-1,1],[-1,-1,-1,-1],[0.997437,0.00256302,-1,-1],[0.999786,0.000214112,-1,-1],[0.999989,1.08562e-05,-1,-1],[0.999986,1.39574e-05,-1,-1],[0.999999,9.98002e-07,-1,-1],[1,0,-1,-1],[0.84634,0.15366,0,-1],[0.824047,0.175953,0,-1],[0.00228652,0.997713,0,-1],[3.03511e-06,0.999997,0,-1],[0.662361,0.337639,0,-1],[-1,1,-1,0],[-1,-1,-1,-1],[-1,9.33424e-05,0.999907,-1],[-1,6.09659e-06,0.999994,-1],[-1,2.78693e-06,4.45909e-05,0.999953],[-1,-1,0.000102537,0.999897],[-1,-1,1.64907e-05,0.999984],[-1,-1,8.79329e-05,0.999912],[-1,-1,0.000947981,0.999052],[-1,4.27745e-07,1,-1],[-1,1.3427e-06,0.999999,-1],[-1,0,1,-1],[-1,0,1,-1],[-1,-1,-1,-1],[0.956389,0.0436114,-1,-1],[0.999832,0.000167762,-1,-1],[0.999953,4.73966e-05,-1,-1],[1,0,-1,-1],[-1,0.000210431,0.99979,-1],[-1,0.000108495,0.999892,-1],[-1,4.95291e-06,0.999995,-1],[-1,4.1839e-07,1,-1],[-1,3.28781e-07,1,-1],[-1,0,-1,1],[1,2.18156e-07,-1,-1],[1,1.82785e-07,-1,-1],[-1,-1,-1,-1],[-1,0.0114193,0.988581,-1],[-1,2.36791e-05,0.999976,-1],[2.44261e-05,0.999976,-1,-1],[1.54315e-06,0.999998,-1,-1],[8.98195e-06,0.999991,-1,-1],[0,1.75064e-05,0.999982,-1],[-1,5.16085e-07,0.999999,5.16085e-07],[-1,0.00367182,0.996328,4.43403e-07],[-1,3.47655e-07,0.999999,3.47655e-07],[-1,2.78766e-07,1,0],[-1,0.00488675,0.995113,2.60363e-07],[-1,0.0387508,0.961249,2.99003e-07],[-1,1,-1,2.52265e-07],[-1,-1,-1,-1],[0.999981,1.87399e-05,-1,-1],[0.999978,2.18355e-05,-1,-1],[0.999907,9.33424e-05,-1,-1],[0.999741,0.000259434,-1,-1],[9.90074e-07,0.999999,-1,-1],[-1,-1,-1,-1],[0.999184,0.000815661,0,-1],[0.998351,0.000164939,-1,0.00148445],[0.999855,0.000145138,-1,0],[0.999893,0.000107374,-1,0],[0.642488,0.357503,-1,8.34333e-06],[-1,0.999998,-1,1.76364e-06],[-1,0.999972,2.78758e-05,-1],[-1,-1,-1,-1],[-1,-1,0.950884,0.0491159],[-1,-1,0.996493,0.00350676],[-1,-1,0.99997,2.97512e-05],[-1,-1,0.937216,0.0627838],[-1,-1,0.999994,6.37686e-06],[-1,-1,0.999764,0.000236146],[-1,-1,0.990853,0.00914732],[-1,-1,0.952509,0.0474913],[-1,-1,-1,-1],[0.999979,-1,-1,2.1433e-05],[0.999785,-1,-1,0.00021516],[0.999595,-1,-1,0.000405223],[-1,-1,-1,-1],[0.102302,-1,-1,0.897698],[-1,-1,-1,-1],]

function updateEnvironment(index){
    env = new Environment()
    for(i=0; i<index; i++){
        if(i == 0 || env.actionType == 1){
            env.chanceAction(actions[i])
        }
        else{
            env.agentAction(actions[i])
        }
        while(env.actionType == 0){
            // Check if there is only one valid action
            numValidActions = 0
            validAction = -1
            for(d = 0; d < 4; d++){
                if(env.validAgentAction(d)){
                    numValidActions++
                    validAction = d
                }
            }
            if(numValidActions == 1){
                env.agentAction(validAction)
            }
            else{
                break
            }
        }
    }
}


updateEnvironment(1)
currAction = actions[1]
currActionIndex = 2

/*
updateEnvironment(203)
currAction = actions[203]
currActionIndex = 204
*/
tick = 0


/*
//Manual game:
currAction = 0
tick = -1
env.randomChanceAction()
*/

console.log(env)


function fillRect(color,sx,sy,l,w){
    ctx.fillStyle = color;
    ctx.fillRect(sx,sy,l,w);
}

function drawLine(color,p1x,p1y,p2x,p2y, width){
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(p1x,p1y);
    ctx.lineTo(p2x,p2y);
    ctx.stroke();
}

function fillCirc(color,x,y,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,2*pi);
    ctx.fillStyle = color;
    ctx.fill();
}

function fillText(text,color,size,x,y){
    ctx.font = String(size)+"px Arial";
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.fillText(text,x,y);
}

document.addEventListener("keydown",keyHandler);
document.addEventListener("click",clickHandler);

keyMove = ["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"]

paused = true

function keyHandler(event){
    key = event.code
    event.preventDefault()
    /*
    for(i=0; i<4; i++){
        if(keyMove[i] == key){
            if(env.timer != TIME_LIMIT && env.validAgentAction(i)){
                currAction = i
                tick = 0
            }
        }
    }
    */
    if(key == "Space"){
        paused = !paused
        if(paused){
            tick = 0
        }
    }
    if(key == "ArrowRight"){
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowLeft"){
        while(true){
            currActionIndex--
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowDown"){
        currActionIndex = 2
        currAction = actions[currActionIndex-1]
        updateEnvironment(currActionIndex-1)
    }
    if(key == "ArrowUp"){
        currActionIndex = actions.length - 15
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
}

function clickHandler(event){
    rect = canvas.getBoundingClientRect();
    x = event.clientX - rect.left;
    y = event.clientY - rect.top;
}

function draw(){
    fillRect(space, 0, 0, windx, windy)
    fillRect(cLine, marginx - border, marginy - border, boardx*cellS + 2*border, boardy*cellS + 2*border)
    fillRect(space, marginx, marginy, boardx*cellS, boardy*cellS)
    for(var i = 0; i < boardx; i++){
        for(var j = 0; j < boardy; j++){
            if((i + j) % 2 == 0){
                fillRect(cShade, marginx + j * cellS, marginy + i * cellS, cellS, cellS)
            }
        }
    }
    fillCirc(cApple, marginx + env.appley*cellS + cellS/2, marginy + env.applex*cellS + cellS/2, appleSize/2)
    for(i = 0; i < boardx; i++){
        for(j = 0; j < boardy; j++){
            type = env.snake[i][j]
            if(type != -1){
                centerx = marginx + j*cellS + cellS/2
                centery = marginy + i*cellS + cellS/2
                slideProp = tick / framesPerMove
                if(i == env.tailx && j == env.taily && (env.headx + dir[currAction][0] != env.applex || env.heady + dir[currAction][1] != env.appley)){
                    nextx = centerx + dir[type][1] * cellS * slideProp
                    nexty = centery + dir[type][0] * cellS * slideProp
                    fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    drawLine(cSnake, nextx, nexty, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                }
                else{
                    fillCirc(cSnake, centerx, centery, snakeWidth / 2)
                    if(type == 4){
                        nextDir = dir[currAction]
                        nextx = centerx + nextDir[1] * cellS * (tick / framesPerMove)
                        nexty = centery + nextDir[0] * cellS * (tick / framesPerMove)
                        drawLine(cSnake, centerx, centery, nextx, nexty, snakeWidth)
                        fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    }
                    else{
                        drawLine(cSnake, centerx, centery, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                    }
                }
            }
        }
    }
    fillText("Score: " + env.score.toString(), cText, textSize, windx/2, marginy/2)
    fillText("Timer: " + env.timer.toString(), cText, textSize, windx/2, marginy/2 + textSize * 1.5)


    fillText("Value", cValue, textSize, marginx/3, textSize)
    fillText(values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize)
    fillText("Search Value", cSearch, textSize, marginx/3, textSize*2)
    fillText(search_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*2)
    fillText("Network Value", cNetwork, textSize, marginx/3, textSize*3)
    fillText(network_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*3)

    drawLine(cValue, marginx/4, windy/2, marginx/4, windy/2 - values[currActionIndex-2] * 25, marginx/4)

    drawLine(cSearch, marginx*2/4, windy/2, marginx*2/4, windy/2 - search_values[currActionIndex-2] * 25, marginx/4)

    drawLine(cNetwork, marginx*3/4, windy/2, marginx*3/4, windy/2 - network_values[currActionIndex-2] * 25, marginx/4)

    fillText("Search Policy", cPolicy, textSize, windx - marginx/3, textSize);
    fillText("Network Policy", cNetPolicy, textSize, windx - marginx/3, textSize*2);
    scale = 200
    for(d=0; d<4; d++){
        if(search_policy[currActionIndex-2][d] != -1){
            x = windx - marginx/2
            y = windy/2
            drawLine(cPolicy, x, y, x + dir[d][1] * search_policy[currActionIndex-2][d] * scale, y + dir[d][0] * search_policy[currActionIndex-2][d] * scale, 20)
        }
    }
    for(d=0; d<4; d++){
        if(search_policy[currActionIndex-2][d] != -1){
            x = windx - marginx/2
            y = windy/2
            drawLine(cNetPolicy, x, y, x + dir[d][1] * network_policy[currActionIndex-2][d] * scale, y + dir[d][0] * network_policy[currActionIndex-2][d] * scale, 10)
        }
    }
}

endState = false

function update(){
    if(endState) return
    draw()
    if(!paused){
        tick++
    }
    if(tick >= framesPerMove){
        tick = 0

        env.agentAction(currAction)
        if(env.actionType == 1){
            env.chanceAction(actions[currActionIndex])
            currActionIndex++
        }
        if(env.timer == TIME_LIMIT){
            endState = true
            return
        }

        // Check if there is only one valid action
        numValidActions = 0
        validAction = -1
        for(i = 0; i < 4; i++){
            if(env.validAgentAction(i)){
                numValidActions++
                validAction = i
            }
        }
        if(numValidActions == 0){
            endState = true
            return
        }
        if(numValidActions == 1){
            currAction = validAction
        }
        else{
            currAction = actions[currActionIndex]
            currActionIndex++
        }
    }
}

function updateManual(){
    draw()
    if(tick == -1){
        
    }
    else if(tick < framesPerMove){
        tick++
    }
    else{
        env.agentAction(currAction)
        tick = -1
        if(env.actionType == 1){
            env.randomChanceAction()
        }
    }
}

var ONE_FRAME_TIME = 1000 / 60 ;
var mainloop = function() {
    update()
    //updateManual()
};
setInterval( mainloop, ONE_FRAME_TIME );

</script>

</body>

</html>
