
<!DOCTYPE html>
<html>


<head>
<title> Visualizing snake </title>
</head>


<body>

<div class="panel">
<canvas id="canvas" width="1000" height="600" style="position:relative; top:50px; left:50px"></canvas>
</div>

<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
 
boardx = 10;
boardy = 10;
cellS = 40;
windx = 1000;
windy = 600;
marginx = (windx - boardx * cellS) / 2
marginy = (windy - boardy * cellS) / 2
border = 5
snakeWidth = 20
appleSize = 20
textSize = 20

framesPerMove = 7

dir = [[0,1], [1,0], [0,-1], [-1,0]];

pi = Math.PI;

space = "#fff"
cLine = "#000"
cShade = "#eee"
cSnake = "#00f"
cApple = "#f00"
cText = "#000"

cValue = "#d00"
cSearch = "#bb0"
cNetwork = "#0d0"

TIME_LIMIT = 1200

function randint(max){
    return Math.floor(Math.random()*max)
}

class Environment{
    constructor(){
        this.timer = 0
        this.score = 0;
        this.actionType = 0;
        this.snakeSize = 2;
        this.headx = boardx/2;
        this.heady = 2;
        this.tailx = this.headx;
        this.taily = 1;

        this.snake = []
        for(var i=0; i<boardx; i++){
            this.snake[i] = []
            for(var j=0; j<boardy; j++){
                this.snake[i][j] = -1;
            }
        }
        this.snake[this.headx][this.heady] = 4;
        this.snake[this.tailx][this.taily] = 0;
        this.applex = 0;
        this.appley = 0;
    }

    agentAction(actionIndex){
        this.timer ++
        var newHeadx = this.headx + dir[actionIndex][0];
        var newHeady = this.heady + dir[actionIndex][1];
        this.snake[this.headx][this.heady] = actionIndex;
        this.headx = newHeadx;
        this.heady = newHeady;
        this.snake[newHeadx][newHeady] = 4;

        if(this.headx == this.applex && this.heady == this.appley){
            this.score += 1;
            //score += 1 - timer*0.5/maxTime;
            this.snakeSize++;
            this.actionType = 1;
        }
        else{
            var tailDir = this.snake[this.tailx][this.taily];
            this.snake[this.tailx][this.taily] = -1;
            this.tailx += dir[tailDir][0];
            this.taily += dir[tailDir][1];
        }
    }

    chanceAction(actionIndex){
        this.applex = Math.floor(actionIndex / boardy);
        this.appley = actionIndex % boardy;
        this.actionType = 0
    }

    validAgentAction(d){
        var newHeadx = this.headx + dir[d][0];
        var newHeady = this.heady + dir[d][1];
        if(newHeadx == -1 || newHeadx == boardx){
            return false;
        }
        if(newHeady == -1 || newHeady == boardy){
            return false;
        }
        return this.snake[newHeadx][newHeady] == -1;
    }

    randomChanceAction(){
        while(true){
            this.applex = randint(boardx)
            this.appley = randint(boardy)
            if(this.snake[this.applex][this.appley] == -1){
                break
            }
        }
        this.actionType = 0
    }
}

env = new Environment();

//Agent game:
actions = [62,1,61,2,49,1,0,0,0,3,3,3,0,0,0,0,0,93,1,2,2,1,2,1,1,2,1,2,2,63,3,2,3,0,3,75,0,1,0,69,0,0,0,0,3,35,2,3,3,2,2,2,3,93,2,1,1,1,1,1,1,2,85,2,2,3,3,0,1,0,1,0,20,3,0,3,2,2,2,3,2,2,2,3,3,3,91,0,0,0,1,1,2,3,1,2,1,1,1,76,3,3,0,0,0,0,45,3,2,3,3,97,0,1,1,1,1,1,3,2,2,3,2,2,3,3,2,3,2,3,3,3,3,0,3,0,30,0,0,1,0,1,2,1,1,1,1,2,2,3,0,2,2,2,2,3,22,0,0,3,52,0,1,0,0,1,2,1,1,2,3,3,2,1,95,0,1,0,1,0,1,96,0,57,3,3,3,0,3,46,2,8,0,0,0,3,3,3,3,70,2,2,1,1,1,2,1,2,1,0,2,2,2,2,2,1,14,0,0,0,0,0,0,3,0,3,2,3,3,2,2,3,3,2,1,38,2,1,1,1,2,1,0,1,2,1,1,0,3,0,0,3,0,0,3,3,0,3,68,3,0,1,2,21,0,2,1,0,3,3,2,2,2,3,2,3,3,3,3,2,3,53,0,0,1,1,1,12,1,1,3,2,3,3,3,2,2,97,2,2,3,1,0,3,0,0,2,2,0,0,1,1,1,1,1,2,1,2,86,3,2,37,3,0,0,3,3,3,54,1,1,2,2,2,1,3,0,3,2,3,2,2,3,2,3,20,2,21,0,42,0,0,2,64,1,0,0,93,1,1,1,2,90,2,2,2,26,3,3,3,0,1,1,1,0]
values = [5.05758,5.214,4.214,4.34433,3.34433,3.44776,3.55439,3.66432,3.77765,3.89448,4.01493,4.1391,4.26712,4.39909,4.53515,4.67541,4.82001,3.82001,3.93815,4.05995,4.18552,4.31497,4.44842,4.586,4.72783,4.87405,5.0248,5.1802,5.34042,4.34042,4.47466,4.61305,4.75572,4.9028,5.05444,4.05444,4.17983,4.3091,4.44238,3.44238,3.54884,3.6586,3.77175,3.8884,4.00866,3.00866,3.10172,3.19764,3.29654,3.3985,3.5036,3.61196,3.72367,2.72367,2.80791,2.89475,2.98428,3.07658,3.17173,3.26983,3.37095,3.47521,2.47521,2.55176,2.63068,2.71205,2.79592,2.8824,3.15819,3.25587,3.35656,3.46037,2.46037,2.53647,2.61492,2.69579,2.77916,2.86512,2.95373,3.04508,3.13926,3.23635,3.33644,3.43963,3.54601,3.65568,2.65568,2.73782,2.82249,2.90979,2.99978,3.09256,3.1882,3.6013,3.71268,3.8275,3.94588,4.06792,4.32343,3.32343,3.42622,3.64143,3.75405,3.87015,3.98985,4.11325,3.11325,3.20953,3.3088,3.41113,3.51663,2.51663,2.59446,2.75743,2.84271,2.93063,3.02126,3.11471,2.11471,2.18011,2.24753,2.31705,2.38871,2.46259,2.53875,2.61727,2.69821,2.78166,2.86769,2.95638,3.04782,3.14208,3.23926,3.33944,3.44272,3.5492,2.5492,2.62804,2.70932,2.79311,2.8795,2.96856,3.06037,3.15502,3.25259,3.35319,3.4569,3.56381,3.67403,3.78766,4.02557,4.15008,4.27843,4.41075,4.54717,4.6878,3.6878,3.80186,3.91944,4.04066,3.04066,3.1347,3.43464,3.54086,3.65037,3.76327,3.99965,4.12335,4.25088,4.38235,4.51789,4.80166,4.95017,5.10327,4.10327,4.361,4.49588,4.63493,4.77827,4.92606,5.07841,4.07841,4.20455,3.20455,3.30365,3.40583,3.51116,3.61976,3.73171,2.73171,2.90329,1.90329,1.96216,2.02284,2.08541,2.1499,2.21639,2.28494,2.42847,1.42847,1.47264,1.51819,1.56514,1.61355,1.66345,1.7149,1.76794,1.82262,1.87899,1.99701,2.05877,2.12245,2.18809,2.25576,2.32553,2.39745,1.39745,1.44067,1.48523,1.53117,1.57852,1.62734,1.67767,1.72956,1.78305,1.8382,2.01408,2.07637,2.14059,2.20679,2.27504,2.3454,2.41794,2.49273,2.56982,1.56982,1.61837,1.66842,1.72002,1.77322,1.82806,1.8846,1.94289,2.00298,2.12879,2.19463,2.2625,2.33248,2.47898,2.55565,2.63469,2.71618,2.80019,2.88679,2.97607,3.06811,3.163,3.26083,2.26083,2.33075,2.40284,2.63275,2.79812,1.79812,1.91106,1.97016,2.0311,2.29427,2.36522,2.59153,2.67168,2.75431,2.8395,2.92732,3.01785,3.11119,3.20741,3.30661,3.40888,3.51431,3.623,2.623,2.70412,2.78775,2.87397,2.96286,3.05449,2.05449,2.18354,2.39247,2.46646,2.62138,2.70246,2.78604,2.8722,2.96104,3.05261,2.05261,2.1161,2.18154,2.61899,2.69999,2.78349,2.95833,3.04982,3.24139,3.34164,3.55153,3.66138,3.89135,4.01171,4.13578,4.26369,4.39556,4.5315,4.67165,4.81613,4.96509,3.96509,4.08772,4.21414,3.21414,3.31355,3.41603,3.6306,3.74289,3.85864,4.10101,3.10101,3.19692,3.2958,3.39773,3.50281,3.61115,2.61115,2.6919,2.77516,2.86099,2.94947,3.04069,3.13474,3.23169,3.33164,3.43468,3.5409,2.5409,2.78402,1.78402,1.8392,0.865154,0.891911,0.947934,0.977251,-0.0227485,-0.0234521,-0.0249252,-0.0256961,-1.0257,-1.05742,-1.09012,-1.12384,-1.1586,-2.1586,-2.22536,-2.29418,-2.36514,-3.46921,-3.57651,-3.68712,-3.80116,-3.91872,-4.03991,-4.16486,-4.42646,-5]
network_values = [4.11462,4.1722,4.04572,4.14061,2.70853,2.71409,2.80454,3.03044,3.36507,3.29295,3.37533,3.50334,3.51261,3.48316,3.84095,3.98341,4.29114,2.75051,3.02803,3.03874,3.19109,3.37072,3.40314,3.70124,3.78203,3.73507,4.03217,4.15337,3.95884,3.9152,3.74754,3.90251,3.97668,3.88642,4.27652,3.61583,3.72868,3.95879,4.37711,3.45265,3.38515,3.86605,3.96959,3.66854,3.61183,3.35638,3.06842,3.28219,3.63538,3.97597,4.07328,4.05129,4.10946,2.68209,2.91961,3.18194,3.41661,3.16122,3.65711,3.86693,3.33854,3.65823,3.34292,3.4454,3.10252,3.314,2.67104,3.00987,3.55119,3.66276,3.74743,4.35384,2.63385,3.00717,2.53729,2.71795,2.49554,2.78239,3.02468,2.91858,3.08548,3.42776,3.26708,3.24103,3.34176,3.58623,2.86737,2.83054,2.86593,2.67623,2.83131,2.6549,2.69931,2.90974,3.26016,3.02948,3.25761,3.33143,3.59981,3.42968,3.23519,3.68983,3.83721,4.36361,3.78966,3.97241,3.09076,3.88904,3.87228,4.02181,4.28203,3.13506,2.90555,3.17971,3.2014,3.28467,3.336,3.3045,2.5166,2.66113,2.29543,2.27375,2.33955,2.60674,2.63553,2.57525,3.0379,2.58765,2.87529,3.11041,2.83799,3.16598,3.38881,3.88215,3.29799,3.64153,2.57333,2.70353,2.93987,2.763,2.62052,2.29305,2.41913,2.46509,2.60065,3.05753,2.86026,2.39593,2.60332,2.88471,2.85537,2.90264,3.12254,3.25787,2.81377,3.1733,2.9733,3.61224,3.1015,3.68885,2.72798,2.65559,2.52035,2.68224,1.94445,2.01814,2.46754,2.95859,3.2618,2.65293,3.29902,3.24337,2.89874,3.59794,2.48529,2.36338,2.97147,3.24641,3.14571,3.38964,3.1263,2.94951,3.20021,2.76279,2.91147,2.71042,2.85881,2.71751,2.99024,2.529,3.11953,2.39274,2.40481,1.81721,2.83529,2.29842,2.49378,2.75615,3.25258,1.39308,1.61904,2.41671,2.14502,1.66301,2.25739,2.61107,2.4427,1.99616,2.44372,2.11147,2.39045,2.5567,2.37206,2.39565,2.33633,2.49011,2.23694,1.8594,2.36682,2.37533,2.55249,2.62859,2.43694,2.31305,2.211,2.12091,2.28183,2.6979,3.42907,3.19865,3.11889,3.2474,2.60651,3.30469,3.19713,1.90176,2.55318,1.35623,1.29933,1.95485,1.94661,1.53489,1.74589,1.70772,1.59843,1.93294,1.5607,1.60823,0.774596,1.97799,1.78567,2.46118,2.30955,2.70827,2.61981,3.19136,3.15059,3.29259,2.45069,2.76589,3.56895,2.87383,2.06587,2.35045,1.76244,1.78615,1.40604,1.68651,1.86411,1.74719,1.85926,2.66733,2.89784,2.41918,2.48655,2.68895,3.07248,1.77328,3.33181,2.11846,2.79571,1.97423,2.96633,1.27792,2.55001,1.68837,2.29827,2.03054,2.50109,2.48686,1.58632,2.5568,2.77461,3.29978,2.94745,2.89747,3.25618,1.7016,1.728,1.74098,2.0394,2.73153,2.6954,2.32244,2.50925,2.59459,2.61161,1.70897,2.99671,2.50078,2.38275,2.51576,3.22687,3.04924,3.49283,3.57536,3.54246,3.75354,2.82394,3.5153,3.1077,2.32557,2.44629,2.72561,2.46201,3.17885,3.47068,2.88833,1.04036,2.37851,2.14602,2.72176,2.62225,2.55148,1.645,2.5094,2.24759,2.32123,2.41759,2.67793,2.62164,2.71693,1.40024,2.72117,1.4639,3.27911,1.99605,1.83527,2.20758,2.85819,1.7832,2.55474,2.46674,1.85086,1.67813,2.86961,2.01356,0.778539,1.91485,2.09115,1.95263,1.74152,2.19961,1.70587,2.32891,1.39543,1.39444,0.719156,0.990852,0.13205,-0.208987,-0.12486,0.746714,-0.00540261,-0.0118462]
search_values = [1.391,1.52876,2.44887,2.63284,0.512663,0.950864,1.34197,1.54543,1.81459,2.21024,2.64591,2.89894,3.1521,3.37722,3.57509,3.76809,3.94588,2.50325,2.59063,2.6729,2.73183,2.81449,2.91729,3.11643,3.33164,3.48047,3.63594,3.80529,3.9603,3.44964,3.61294,3.52156,3.80948,3.96362,4.12606,3.5212,3.75255,3.89428,4.05599,2.92916,3.15098,3.36961,3.57416,3.67975,3.82356,2.99447,2.97228,3.0608,3.29948,3.51966,3.71043,3.82974,4.0215,2.55887,2.65582,2.73645,2.92249,3.12968,3.32293,3.47234,3.62176,3.76313,2.37783,2.33918,2.4282,2.70861,2.95434,3.10042,3.43068,3.54587,3.64551,3.7923,2.13254,2.23346,2.16868,2.32083,2.4468,2.49933,2.55943,2.66968,2.9123,3.1108,3.24711,3.43146,3.5651,3.71048,2.03448,1.98887,2.05281,2.11214,2.22251,2.34876,2.5675,2.97233,3.19057,3.391,3.51621,3.65268,3.9054,2.81975,2.86343,3.14437,3.36984,3.57809,3.75359,3.92969,3.23732,3.46713,3.56521,3.72463,3.90809,2.35318,2.54017,2.82576,3.03085,3.16917,3.31852,3.48535,1.72891,1.76,1.82218,1.81703,1.88298,2.02417,2.17991,2.28793,2.30717,2.42165,2.30444,2.47823,2.80524,2.9862,3.15596,3.28241,3.27412,3.43163,1.94404,1.89724,1.89588,1.9073,1.875,1.93668,2.00824,2.05303,2.12377,2.19385,2.21807,2.30954,2.36253,2.53514,2.62364,2.84231,2.98091,3.13687,3.26079,3.39083,2.8948,3.05202,3.16573,3.30794,1.73313,1.64759,1.7927,1.90261,1.95631,2.06204,2.28403,2.64052,2.84571,2.99175,3.10386,3.2592,3.33853,3.47956,2.35557,2.68593,2.83604,2.99131,3.10615,3.24214,3.42077,3.1187,3.2656,2.51387,2.73747,2.88804,3.02731,3.09279,3.2526,3.08591,3.3589,1.9659,2.14631,2.35942,2.56142,2.69086,2.83085,2.9705,3.1823,1.65009,1.48883,1.52258,1.58048,1.61408,1.5707,1.65041,1.71578,1.71862,1.80519,1.97606,2.1278,2.38586,2.60444,2.77687,2.94863,3.05453,1.36492,1.17412,1.124,1.17125,1.27851,1.43595,1.53972,1.72537,1.78822,1.91176,2.21989,2.44465,2.60127,2.72948,2.85288,2.95608,2.73919,2.81053,2.94278,1.32314,1.23678,1.20801,1.16888,1.13826,1.06057,1.03823,1.17013,1.10012,1.22713,1.35308,1.47922,1.63513,1.77796,1.93537,2.05736,2.12022,2.25914,2.50725,2.72348,2.83623,2.92693,3.10167,2.27478,2.21301,2.35214,2.47301,2.65956,1.00281,0.869419,0.80333,0.840856,1.0465,1.19113,1.40066,1.53407,1.61574,1.73486,1.83927,2.08309,2.33942,2.51299,2.64748,2.76275,2.89265,3.06061,2.19082,2.47117,2.61923,2.73559,2.81917,2.94268,1.72676,1.84562,2.04126,2.14758,2.38825,2.51104,2.62287,2.72951,2.85441,2.97615,1.46289,1.40177,1.32266,1.52217,1.53895,1.5887,1.58407,1.60394,1.70586,1.74414,1.87384,2.01293,2.27727,2.49897,2.73004,2.9091,3.05093,3.20327,3.34065,3.48423,3.59851,3.43778,3.508,3.65719,2.12737,2.37053,2.55732,2.73996,2.86034,2.98013,3.192,2.35852,2.59177,2.72257,2.86457,3.02712,3.19324,1.86207,1.86496,1.8354,1.75087,1.94836,2.06114,2.24104,2.37805,2.54845,2.65592,2.81549,2.4372,2.70483,2.61613,2.73488,2.41571,2.60968,2.66507,2.79353,2.03378,2.07351,2.15137,2.29679,1.94963,2.10781,2.21412,2.22948,2.33341,1.65589,1.68746,1.74837,1.82235,-1.59442,-3.26359,-3.77421,-4.05961,-4.30603,-4.46056,-4.6275,-4.89752,-5]

function updateEnvironment(index){
    env = new Environment()
    for(i=0; i<index; i++){
        if(i == 0 || env.actionType == 1){
            env.chanceAction(actions[i])
        }
        else{
            env.agentAction(actions[i])
        }
        while(env.actionType == 0){
            // Check if there is only one valid action
            numValidActions = 0
            validAction = -1
            for(d = 0; d < 4; d++){
                if(env.validAgentAction(d)){
                    numValidActions++
                    validAction = d
                }
            }
            if(numValidActions == 1){
                env.agentAction(validAction)
            }
            else{
                break
            }
        }
    }
}


updateEnvironment(1)
currAction = actions[1]
currActionIndex = 2

/*
updateEnvironment(203)
currAction = actions[203]
currActionIndex = 204
*/
tick = 0


/*
//Manual game:
currAction = 0
tick = -1
env.randomChanceAction()
*/

console.log(env)


function fillRect(color,sx,sy,l,w){
    ctx.fillStyle = color;
    ctx.fillRect(sx,sy,l,w);
}

function drawLine(color,p1x,p1y,p2x,p2y, width){
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(p1x,p1y);
    ctx.lineTo(p2x,p2y);
    ctx.stroke();
}

function fillCirc(color,x,y,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,2*pi);
    ctx.fillStyle = color;
    ctx.fill();
}

function fillText(text,color,size,x,y){
    ctx.font = String(size)+"px Arial";
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.fillText(text,x,y);
}

document.addEventListener("keydown",keyHandler);
document.addEventListener("click",clickHandler);

keyMove = ["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"]

paused = true

function keyHandler(event){
    key = event.code
    event.preventDefault()
    /*
    for(i=0; i<4; i++){
        if(keyMove[i] == key){
            if(env.timer != TIME_LIMIT && env.validAgentAction(i)){
                currAction = i
                tick = 0
            }
        }
    }
    */
    if(key == "Space"){
        paused = !paused
        if(paused){
            tick = 0
        }
    }
    if(key == "ArrowRight"){
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowLeft"){
        while(true){
            currActionIndex--
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowDown"){
        currActionIndex = 2
        currAction = actions[currActionIndex-1]
        updateEnvironment(currActionIndex-1)
    }
    if(key == "ArrowUp"){
        currActionIndex = actions.length - 15
        currAction = actions[currActionIndex-1]
        updateEnvironment(currActionIndex-1)
    }
}

function clickHandler(event){
    rect = canvas.getBoundingClientRect();
    x = event.clientX - rect.left;
    y = event.clientY - rect.top;
}

function draw(){
    fillRect(space, 0, 0, windx, windy)
    fillRect(cLine, marginx - border, marginy - border, boardx*cellS + 2*border, boardy*cellS + 2*border)
    fillRect(space, marginx, marginy, boardx*cellS, boardy*cellS)
    for(var i = 0; i < boardx; i++){
        for(var j = 0; j < boardy; j++){
            if((i + j) % 2 == 0){
                fillRect(cShade, marginx + j * cellS, marginy + i * cellS, cellS, cellS)
            }
        }
    }
    fillCirc(cApple, marginx + env.appley*cellS + cellS/2, marginy + env.applex*cellS + cellS/2, appleSize/2)
    for(i = 0; i < boardx; i++){
        for(j = 0; j < boardy; j++){
            type = env.snake[i][j]
            if(type != -1){
                centerx = marginx + j*cellS + cellS/2
                centery = marginy + i*cellS + cellS/2
                slideProp = tick / framesPerMove
                if(i == env.tailx && j == env.taily && (env.headx + dir[currAction][0] != env.applex || env.heady + dir[currAction][1] != env.appley)){
                    nextx = centerx + dir[type][1] * cellS * slideProp
                    nexty = centery + dir[type][0] * cellS * slideProp
                    fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    drawLine(cSnake, nextx, nexty, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                }
                else{
                    fillCirc(cSnake, centerx, centery, snakeWidth / 2)
                    if(type == 4){
                        nextDir = dir[currAction]
                        nextx = centerx + nextDir[1] * cellS * (tick / framesPerMove)
                        nexty = centery + nextDir[0] * cellS * (tick / framesPerMove)
                        drawLine(cSnake, centerx, centery, nextx, nexty, snakeWidth)
                        fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    }
                    else{
                        drawLine(cSnake, centerx, centery, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                    }
                }
            }
        }
    }
    fillText("Score: " + env.score.toString(), cText, textSize, windx/2, marginy/2)
    fillText("Timer: " + env.timer.toString(), cText, textSize, windx/2, marginy/2 + textSize * 1.5)


    fillText("Value", cValue, textSize, marginx/3, textSize)
    fillText(values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize)
    fillText("Search Value", cSearch, textSize, marginx/3, textSize*2)
    fillText(search_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*2)
    fillText("Network Value", cNetwork, textSize, marginx/3, textSize*3)
    fillText(network_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*3)

    drawLine(cValue, marginx/4, windy/2, marginx/4, windy/2 - values[currActionIndex-2] * 25, marginx/4)

    drawLine(cSearch, marginx*2/4, windy/2, marginx*2/4, windy/2 - search_values[currActionIndex-2] * 25, marginx/4)

    drawLine(cNetwork, marginx*3/4, windy/2, marginx*3/4, windy/2 - network_values[currActionIndex-2] * 25, marginx/4)

    //fillText("Reward", cText, textSize, marginx/4, 100)
    //fillText(values[currActionIndex-1].toString(), cText, textSize, marginx/4, 120)
    //drawLine(cText, marginx/4, windy/2, marginx/4, windy/2 + rewards[currActionIndex-1] * 100, 3)
}

endState = false

function update(){
    if(endState) return
    draw()
    if(!paused){
        tick++
    }
    if(tick >= framesPerMove){
        tick = 0

        env.agentAction(currAction)
        if(env.actionType == 1){
            env.chanceAction(actions[currActionIndex])
            currActionIndex++
        }
        if(env.timer == TIME_LIMIT){
            endState = true
            return
        }

        // Check if there is only one valid action
        numValidActions = 0
        validAction = -1
        for(i = 0; i < 4; i++){
            if(env.validAgentAction(i)){
                numValidActions++
                validAction = i
            }
        }
        if(numValidActions == 0){
            endState = true
            return
        }
        if(numValidActions == 1){
            currAction = validAction
        }
        else{
            currAction = actions[currActionIndex]
            currActionIndex++
        }
    }
}

function updateManual(){
    draw()
    if(tick == -1){
        
    }
    else if(tick < framesPerMove){
        tick++
    }
    else{
        env.agentAction(currAction)
        tick = -1
        if(env.actionType == 1){
            env.randomChanceAction()
        }
    }
}

var ONE_FRAME_TIME = 1000 / 60 ;
var mainloop = function() {
    update()
    //updateManual()
};
setInterval( mainloop, ONE_FRAME_TIME );

</script>

</body>

</html>
