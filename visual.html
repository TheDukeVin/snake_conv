
<!DOCTYPE html>
<html>


<head>
<title> Visualizing snake </title>
</head>


<body>

<div class="panel">
<canvas id="canvas" width="1000" height="600" style="position:relative; top:50px; left:50px"></canvas>
</div>

<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
 
boardx = 10;
boardy = 10;
cellS = 40;
windx = 1000;
windy = 600;
marginx = (windx - boardx * cellS) / 2
marginy = (windy - boardy * cellS) / 2
border = 5
snakeWidth = 20
appleSize = 20
textSize = 20

framesPerMove = 7

dir = [[0,1], [1,0], [0,-1], [-1,0]];

pi = Math.PI;

space = "#fff"
cLine = "#000"
cShade = "#eee"
cSnake = "#00f"
cApple = "#f00"
cText = "#000"

cValue = "#d00"
cSearch = "#bb0"
cNetwork = "#0d0"

TIME_LIMIT = 1200

function randint(max){
    return Math.floor(Math.random()*max)
}

class Environment{
    constructor(){
        this.timer = 0
        this.score = 0;
        this.actionType = 0;
        this.snakeSize = 2;
        this.headx = boardx/2;
        this.heady = 2;
        this.tailx = this.headx;
        this.taily = 1;

        this.snake = []
        for(var i=0; i<boardx; i++){
            this.snake[i] = []
            for(var j=0; j<boardy; j++){
                this.snake[i][j] = -1;
            }
        }
        this.snake[this.headx][this.heady] = 4;
        this.snake[this.tailx][this.taily] = 0;
        this.applex = 0;
        this.appley = 0;
    }

    agentAction(actionIndex){
        this.timer ++
        var newHeadx = this.headx + dir[actionIndex][0];
        var newHeady = this.heady + dir[actionIndex][1];
        this.snake[this.headx][this.heady] = actionIndex;
        this.headx = newHeadx;
        this.heady = newHeady;
        this.snake[newHeadx][newHeady] = 4;

        if(this.headx == this.applex && this.heady == this.appley){
            this.score += 1;
            //score += 1 - timer*0.5/maxTime;
            this.snakeSize++;
            this.actionType = 1;
        }
        else{
            var tailDir = this.snake[this.tailx][this.taily];
            this.snake[this.tailx][this.taily] = -1;
            this.tailx += dir[tailDir][0];
            this.taily += dir[tailDir][1];
        }
    }

    chanceAction(actionIndex){
        this.applex = Math.floor(actionIndex / boardy);
        this.appley = actionIndex % boardy;
        this.actionType = 0
    }

    validAgentAction(d){
        var newHeadx = this.headx + dir[d][0];
        var newHeady = this.heady + dir[d][1];
        if(newHeadx == -1 || newHeadx == boardx){
            return false;
        }
        if(newHeady == -1 || newHeady == boardy){
            return false;
        }
        return this.snake[newHeadx][newHeady] == -1;
    }

    randomChanceAction(){
        while(true){
            this.applex = randint(boardx)
            this.appley = randint(boardy)
            if(this.snake[this.applex][this.appley] == -1){
                break
            }
        }
        this.actionType = 0
    }
}

env = new Environment();

//Agent game:
actions = [99,3,0,1,0,0,0,0,1,1,0,1,1,0,90,2,2,1,2,2,2,2,2,2,2,60,3,3,77,0,0,0,0,0,0,0,1,13,0,3,3,3,2,2,2,3,2,2,3,3,82,2,1,1,1,1,1,1,1,0,2,3,3,2,3,3,3,3,3,3,91,1,1,1,1,1,1,1,1,1,44,2,0,0,0,0,16,3,3,0,3,0,29,1,0,0,0,65,1,1,1,1,2,2,2,2,7,3,3,3,3,3,0,0,3,98,0,0,1,1,1,1,1,1,1,1,43,2,3,2,3,3,2,3,2,2,3,74,2,1,1,0,0,49,2,2,1,0,0,0,3,0,0,3,3,0,3,37,2,3,2,30,2,2,2,2,2,2,2,54,1,0,0,0,0,1,55,0,92,1,2,1,1,2,2,1,20,0,3,3,3,3,3,2,2,2,2,3,2,2,39,3,3,1,3,0,0,0,0,0,0,1,1,27,2,3,3,1,13,2,3,2,2,91,2,2,1,2,1,1,1,1,1,1,54,3,3,3,0,0,0,3,35,3,3,3,94,1,1,1,1,2,2,2,0,1,0,32,3,1,3,3,3,3,3,3,3,3,2,2,2,2,1,1,43,1,0,33,3,40,0,1,2,2,2,3,2,20,3,0,2,29,3,0,0,0,1,82,1,1,1,1,1,1,1,2,2,2,2,2,2,3,76,0,0,0,0,3,36,3,3,3,3,32,2,2,2,2,57,1,2,3,3,0,0,0,0,0,0,1,1,1,65,1,1,1,3,0,1,3,0,0,0,2,3,82,2,1,2,1,51,1,2,0,2,3,0,5,1,0,0,0,3,3,3,3,3,9,0,0,0,0,2,1,1,2,2,3,0,0,0,1,0,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,0,66,1,1,1,1,1,0,1,0,0,0,76,1,61,2,2,2,2,3,7,1,0,2,3,3,3,3,3,3,3,0,0,2,0,2,1,1,1,3,3,3,3,3,0,0,61,1,2,2,1,1,1,1,65,0,0,0,0,16,3,3,3,0,3,3,56,2,2,3,1,1,1,2,78,1,1,0,0,59,3,3,3,0,1,25,1,3,2,2,1,2,2,2,3,3,2,1,1,3,3,1,0,3,0,0,53,2,2,2,3,1,1,3,3,1,38,0,3,0,3,0,0,75,3,0,1,2,2,2,2,1,58,0,3,0,3,99,1,1,9,3,3,1,3,1,2,2,2,2,3,3,3,0,0,0,0,0,0,0,0,17,24,1,3,2,1,23,2,11,3,2,44,0,0,0,1,81,1,2,3,1,2,1,1,1,31,3,0,1,3,0,1,0,0,0,1,2,2,1,2,0,46,1,1,1,1,2,2,2,0,16,0,0,3,3,2,12,2,2,2,2,35,2,0,0,0,0,0,71,2,2,1,2,1,82,1,43,3,3,3,3,88,0,0,0,0,0,2,1,86,0,2,3,90,0,1,1,2,2,80,74,0,2,3,2,2,2,0,0,47,2,3,0,0,0,68,0,0,1,2,66,3,2,2,2,78,0,76,0,1,3,1,3,3,90,80,31,0,30,0,4,6,8,9]
values = [1.47316,1.55069,1.63231,1.71822,1.80865,1.90384,2.00404,2.10952,2.22055,2.33742,2.46044,2.58994,2.72625,2.86974,1.96814,2.07173,2.18077,2.29555,2.41636,2.54354,2.67741,2.81833,2.96666,3.1228,3.28716,2.40754,2.53425,2.66763,1.66763,1.7554,1.84779,1.94504,2.04741,2.15517,2.2686,2.388,2.51368,1.51368,1.59335,1.67721,1.76549,1.85841,1.95622,2.05918,2.16755,2.28164,2.40172,2.52813,2.66119,2.80125,1.80125,1.89605,1.99585,2.10089,2.21146,2.32786,2.45037,2.57934,2.7151,1.7151,1.80536,1.90038,2.0004,2.10569,2.21651,2.33317,2.45597,2.58523,2.7213,2.86452,1.96266,2.06595,2.17469,2.28915,2.40963,2.53645,2.66995,2.81047,2.95839,3.11409,2.11409,2.87596,3.02733,3.18666,3.35438,3.53092,2.53092,2.66413,2.80435,2.95195,3.10731,3.27085,2.27085,2.39037,2.51618,2.64861,2.78801,1.78801,1.88212,1.98118,2.08545,2.19521,2.31075,2.43237,2.56039,2.69514,1.69514,1.78436,1.87827,1.97713,2.08119,2.19073,2.30603,2.4274,2.55516,1.55516,1.63701,1.81386,1.90932,2.00981,2.11559,2.22694,2.34415,2.46752,2.59739,2.878,1.878,1.97684,2.08089,2.19041,2.30569,2.42704,2.55478,2.68924,2.83078,2.97977,3.1366,2.1366,2.24905,2.36743,2.49203,2.62319,2.90658,1.90658,2.00692,2.11255,2.22374,2.34078,2.46398,2.59366,2.87386,3.02512,3.18433,3.35193,3.52835,3.71405,3.90952,2.90952,3.06266,3.22385,3.39353,2.39353,2.5195,2.65211,2.79169,2.93862,3.09329,3.25609,3.42747,2.42747,2.55523,2.68971,2.83128,2.98029,3.13715,3.30226,2.30226,2.42343,1.42343,1.49835,1.57721,1.66022,1.7476,1.83958,1.9364,2.03832,1.03832,1.21104,1.27478,1.4125,1.48684,1.5651,1.64747,1.82545,1.92153,2.02266,2.12912,2.24117,2.35913,2.4833,1.4833,1.56136,1.73004,1.91695,2.12404,2.23583,2.35351,2.47737,2.60776,2.74501,3.04157,3.20165,3.37016,2.37016,2.4949,2.62621,2.90993,3.06308,2.06308,2.17167,2.40628,2.53293,2.66624,1.75393,1.84625,1.94342,2.0457,2.15337,2.26671,2.38601,2.51159,2.64378,2.78292,3.08357,2.08357,2.19323,2.30866,2.43017,2.55808,2.69271,2.83443,2.98362,1.98362,2.08802,2.19791,2.56354,1.56354,1.64583,1.73245,1.82363,1.91961,2.02064,2.12699,2.35678,2.48082,2.61139,2.74883,1.74883,1.93776,2.14711,2.26011,2.37907,2.50428,2.63608,2.77482,2.92087,3.0746,3.23642,3.40676,3.58606,3.7748,3.97347,4.1826,4.40274,3.40274,3.58183,3.77035,2.77035,2.91616,1.91616,2.01701,2.23491,2.35254,2.47636,2.60669,2.74389,2.8883,1.8883,1.98769,2.20242,2.31834,1.38772,1.53765,2.09177,2.20187,2.43974,2.56815,1.56815,1.65068,1.73756,1.82901,1.92527,2.0266,2.13327,2.36373,2.48814,2.61909,2.75694,2.90204,3.05478,3.21556,3.3848,2.3848,2.51032,2.64244,2.78151,2.92791,3.08201,2.08201,2.19159,2.30694,2.42835,2.55616,1.55616,1.63806,1.72428,1.81503,1.91056,0.910558,0.958482,1.00893,1.06203,1.11793,1.17676,1.2387,1.30389,1.37252,1.44476,1.5208,1.60084,1.68509,1.77378,0.773783,0.814509,0.857377,1.05263,1.10804,1.16635,1.94802,2.05055,2.15848,2.27208,2.51754,2.65004,2.78952,1.78952,1.8837,2.08721,2.19706,2.31269,1.31269,1.45451,1.61164,1.78575,1.97867,2.08281,2.19244,1.19244,1.32126,1.464,1.54105,1.62216,1.70754,1.79741,1.89201,1.99159,2.09641,1.09641,1.15411,1.21486,1.2788,1.3461,0.364316,0.383491,0.403674,0.42492,0.447285,0.470826,0.67421,0.709695,0.747047,0.786365,0.827753,0.871319,0.917178,0.96545,1.06975,1.12605,1.18532,1.2477,1.31337,1.3825,1.45526,1.53185,1.69735,1.78668,1.9797,2.08389,2.19357,2.30902,2.43055,2.69313,2.83488,1.83488,1.93145,2.0331,2.14011,2.25275,2.37131,2.49612,2.62749,2.76578,2.91135,3.06458,2.06458,2.17324,1.17324,1.23499,1.29999,1.36841,1.44043,1.59605,0.596047,0.898445,0.995507,1.10306,1.16111,1.22222,1.28655,1.35426,1.42554,1.50057,0.500568,0.526913,0.583837,0.646911,0.716799,0.794237,0.836039,0.926359,2.10476,2.21553,2.33214,2.45488,2.58409,2.86326,3.01395,3.17258,2.17258,2.28693,2.40729,2.66736,2.80775,2.95553,3.11108,3.27482,2.27482,2.39455,2.52058,2.65324,2.79288,1.79288,1.88724,1.98657,2.09113,2.20119,2.31704,2.43899,1.43899,1.51473,1.59445,1.95757,2.0606,2.16905,2.40338,2.66302,1.66302,1.75055,1.84268,1.93967,2.04176,1.04176,1.09659,1.1543,1.21505,1.279,1.34632,0.403929,0.447567,0.495919,0.52202,0.549495,0.578416,0.608859,0.640904,0.674636,0.710143,0.747519,0.786862,0.828276,1.3142,1.38337,1.53282,1.6135,1.69842,2.08521,2.19496,2.31048,1.37946,1.45206,1.52848,1.60893,1.97534,2.07931,2.30394,2.4252,2.68721,2.82864,1.82864,1.92488,2.13283,2.24509,2.36325,2.48763,2.61856,1.61856,1.70375,1.79342,1.98717,2.09175,2.31773,2.43972,2.70329,2.84557,1.84557,1.9427,2.15258,2.26587,2.38513,1.61554,1.70057,1.79008,0.83166,0.875432,1.02106,1.13137,1.25359,1.38902,1.46213,1.53909,1.62009,1.79511,1.88959,2.57055,2.84826,2.99817,3.15597,3.32207,3.49692,3.68096,3.8747,4.07863,4.29329,3.84114,2.84114,3.14807,3.48817,3.67176,3.86501,2.86501,3.0158,2.0158,2.23357,2.35113,1.42224,1.57589,1.65883,1.74614,1.83804,0.83804,0.882147,0.928576,1.02889,1.08305,1.14005,1.20005,1.26321,1.3297,0.347048,0.365313,0.38454,0.448509,0.472115,0.496963,0.579633,0.61014,0.642253,0.676055,0.711637,0.749092,0.830019,0.873704,1.79157,1.98512,2.02003,2.12635,2.23826,2.35607,2.6106,2.748,2.89263,3.20513,3.37382,2.37382,2.49876,2.76871,2.91443,3.22929,3.39925,2.39925,2.52553,2.65845,2.79837,2.94565,1.94565,2.26931,2.38875,2.51447,2.64681,2.78612,3.42062,2.54802,2.68213,2.97189,3.1283,3.46626,3.6487,2.6487,2.93484,1.93484,2.03668,2.25671,2.37548,2.50051,1.75012,1.84223,1.93919,2.04125,2.14869,2.38081,2.50612,2.63802,1.63802,2.01106,2.11691,2.22832,1.22832,1.50806,1.58743,1.75892,1.8515,2.1595,1.22052,0.270745,0.68161,0.717484,1.71597,1.80629,1.90136,3.17561,3.34275,3.70388,2.84619,3.49437,3.87188,4.07566,4.29017,4.51597,3.51597,3.70102,4.10086,4.31669,4.54388,3.54388,3.92674,4.13341,4.35096,5.34184,4.8109,5.06411,4.06411,4.50317,4.98966,5.52871,6.12599,6.44841,6.7878,8.72418,8.13072,8.75465,9.70044,9.15836,9.51551,10.4548,10.4763,10.5,10]
network_values = [1.37683,1.6202,1.39646,1.38688,1.63029,1.82013,1.93888,1.95687,1.96281,2.41716,2.19177,2.40621,2.87162,3.14772,1.74803,1.42825,1.49423,1.82854,1.98904,2.28184,2.23794,2.39737,2.49616,2.92336,2.90301,2.81034,2.84629,3.04895,1.85083,1.58306,2.10297,2.41381,2.49139,2.51889,2.92492,2.78696,3.03172,1.58704,1.8987,1.31308,1.81473,1.55917,2.00394,2.02412,2.18273,2.63122,2.57752,2.74528,2.96711,2.9669,1.76214,1.70305,2.43729,2.1153,2.46496,2.45731,2.74255,2.94356,3.022,1.87077,1.69741,1.93179,1.95757,2.10072,2.02438,2.3672,2.42014,2.40949,2.74851,2.85775,1.63426,1.48895,2.0274,1.82159,1.86189,1.99876,2.24602,2.36251,2.77203,2.50501,2.36514,2.72373,2.61546,3.02473,2.91305,3.08398,2.19349,2.66204,2.67962,2.56692,2.72263,2.9368,2.39744,2.50516,2.5149,2.68558,2.70128,2.3728,2.3365,2.61261,2.63049,2.61295,2.30314,2.33946,2.95137,2.96967,1.8244,1.89392,1.83708,2.26627,2.29786,2.42308,2.4625,2.53674,2.74167,1.78008,1.60731,1.7644,2.35035,2.02978,2.20031,2.62358,2.64742,2.66313,2.83862,2.71471,1.98749,2.43092,1.84633,2.58642,2.27211,2.0847,2.30206,2.856,2.83221,2.7041,3.19542,2.03664,1.93617,2.13135,2.3633,2.44324,2.56431,1.7273,1.60265,1.61548,1.84395,1.8043,1.8224,1.88242,2.31379,2.15701,2.26796,2.47319,2.38996,2.73007,2.67093,2.72912,2.69559,2.62931,2.7213,1.8631,1.78779,2.00846,2.21705,2.47525,2.22025,2.75283,2.49008,2.12342,2.04589,2.21644,2.18011,2.44318,2.75827,2.35499,2.22564,2.26546,1.61199,1.81258,2.02177,2.02491,1.96683,2.18563,2.23046,2.07686,1.59217,1.26379,1.27704,1.47037,1.31196,1.61034,1.55493,1.88875,2.044,2.00568,2.22704,2.00692,2.34909,2.2956,1.63119,1.66285,1.08865,1.33034,1.85551,1.54905,2.04607,2.24363,2.15511,2.09686,2.54908,2.86908,2.43847,2.38839,2.57655,3.2255,2.73966,2.54567,2.6415,2.14027,2.48993,2.74572,2.77203,1.68525,1.94151,1.75473,1.5476,1.70235,1.70101,1.86582,2.22473,2.33484,2.03202,2.23633,1.87339,1.73087,1.70272,2.12527,2.23982,2.10995,2.37653,2.50535,2.03357,2.45291,2.28467,2.32753,1.67712,1.69012,1.63613,1.94324,1.86434,2.26216,2.33977,2.01852,1.37973,2.57675,2.40942,1.38878,1.45805,1.53224,1.6677,1.60128,1.53045,1.58819,1.64661,1.81316,1.92167,1.73475,1.84262,1.89313,2.08022,1.80196,2.4267,2.0429,2.14717,2.05022,2.46009,1.96727,2.17516,1.95843,-0.229773,-0.915717,1.47421,1.89363,1.6389,1.6619,1.68977,1.51816,1.96004,1.61922,1.13686,0.39051,0.684428,1.26067,1.7671,1.855,2.29544,0.939599,1.18745,1.5275,1.381,1.98081,1.81216,2.36301,1.84024,1.97008,2.12205,2.3014,2.26246,2.67921,2.40371,2.58052,1.58731,1.73172,2.57278,2.43676,2.71692,2.41228,1.80527,1.71407,2.12577,2.5014,2.4262,1.97226,1.58916,2.146,2.34544,2.46411,0.805585,1.57452,1.11588,1.21735,1.01991,1.48846,1.48863,1.24338,1.40922,1.72197,1.236,1.87183,2.29022,2.12346,1.45763,1.52093,1.56213,1.36048,2.0319,1.69285,1.85722,1.72209,1.94279,1.89475,2.28479,2.18687,2.28196,1.43412,1.54207,2.06872,2.14047,2.23136,1.52593,1.97739,1.55551,2.32512,2.23967,2.47249,2.63929,1.56451,1.47769,1.91899,1.6442,1.44987,1.5406,1.5991,1.73263,2.14809,2.28077,1.35213,1.59168,1.50729,2.2459,2.35564,1.24646,1.03063,0.914883,0.799259,1.15089,1.16175,1.36107,0.949206,0.703705,0.864054,1.24992,1.02363,0.966665,1.04891,0.794489,0.833734,0.92823,1.20544,1.28019,0.919763,1.36315,1.3144,1.45856,1.61516,1.80574,1.578,2.05514,2.04403,2.65497,2.66236,2.65426,1.02768,1.43341,1.69649,1.35597,1.66793,1.50359,2.08681,1.49825,1.74297,1.89717,2.00902,1.72351,1.87097,1.2215,1.26384,0.943231,-0.100726,1.65512,0.999447,0.8273,1.45531,1.39439,1.13725,1.10757,1.8383,1.7151,2.01196,2.06498,2.25351,1.24374,1.33675,0.542598,0.886613,-0.438595,0.261775,0.215146,-1.64168,1.56896,2.25244,1.79073,1.84012,1.95162,2.32152,2.42726,2.63734,1.42285,1.29024,1.50594,1.79394,1.88703,2.18149,2.56113,2.59816,1.49061,1.62298,1.92058,2.0777,2.13952,0.566187,1.22043,1.30479,1.22218,1.72314,1.80608,1.71831,0.910451,0.734952,1.15745,1.16093,0.966853,0.93404,1.84841,1.99074,1.30647,0.98795,1.33777,1.66993,1.84726,1.40484,1.63305,1.07761,1.71048,1.5154,1.46049,1.07191,0.983121,0.832046,0.498695,0.893201,0.956832,0.812381,0.703803,1.13433,0.954864,0.74836,0.692754,0.201026,1.46254,1.52287,1.66954,1.68517,2.22963,1.6633,1.97915,2.43748,1.19831,1.61888,1.42241,1.30851,1.60958,1.23085,1.8365,1.88536,1.85279,2.35502,0.770721,0.874354,1.39299,1.78719,1.77105,2.31042,2.02052,1.08924,1.39013,0.937772,1.60001,0.956146,1.48139,1.36783,1.62816,1.64826,1.1121,1.94765,1.77682,2.14505,2.29369,1.49665,1.58188,2.35355,1.15079,0.779858,0.717529,1.41855,1.118,0.959615,0.791699,0.841831,0.774968,1.22738,0.341765,1.02668,1.82248,1.66768,1.5869,1.66865,1.85479,1.69185,1.61619,1.7651,2.06973,2.36232,2.04965,2.34621,2.65239,2.92529,2.60026,2.50697,3.0293,2.35838,2.42001,2.68253,1.62104,2.03326,2.14527,2.10637,2.27094,0.968086,0.531459,0.449235,1.53999,-0.850041,0.605443,0.959806,1.50931,1.97366,0.896821,1.06598,1.51636,1.04318,0.922488,0.665273,0.815165,1.17263,1.02818,0.598072,0.988759,0.92842,0.595058,0.784348,1.66614,1.85938,1.64219,1.9808,1.8572,1.72937,1.30299,2.00702,2.19765,1.97127,1.98363,0.780888,0.992176,1.55309,1.89494,2.20824,2.22623,1.55721,1.6962,1.31429,2.10785,1.83799,1.33342,1.58202,1.17191,1.53562,1.5165,2.0061,2.11878,1.20259,1.38284,1.55809,1.8357,2.3979,2.60452,2.34116,2.97305,1.44886,1.71275,1.66078,1.87768,1.94053,1.39472,1.57947,1.59791,2.07696,2.19257,2.42282,2.44662,3.18181,1.78541,2.38822,2.47308,2.36948,1.03985,1.11616,0.971151,1.88186,0.401919,2.46228,2.76606,1.31208,1.5711,0.885618,1.10276,1.36036,1.07468,1.86795,1.77641,2.26764,0.907655,1.49068,1.83552,1.99176,3.70638,4.46694,1.91009,2.05276,3.15972,4.04302,2.47741,1.85633,1.89478,2.52902,2.0518,4.30287,2.99961,3.98058,1.52478,2.52141,3.19795,2.37768,2.5962,2.08659,2.70453,4.01904,5.46969,5.81421,5.03672,7.60383,6.91717,6.63841,6.58689,6.46262,7.65824]
search_values = [1.31887,1.20878,1.30352,1.36703,1.5384,1.64926,1.90559,2.07344,2.20993,2.32318,2.42824,2.56,2.66395,2.81496,1.36197,1.59869,1.76253,1.8829,1.99338,2.10205,2.21789,2.34046,2.46587,2.60226,2.7422,2.71509,2.81909,2.9809,1.58403,1.83157,2.04735,2.20531,2.3538,2.48545,2.60882,2.74761,2.91766,1.3857,1.41348,1.52556,1.61824,1.6728,1.83172,2.04552,2.20642,2.36368,2.50034,2.58771,2.73388,2.90443,1.53401,1.87343,2.0629,2.18545,2.30342,2.44226,2.57844,2.71942,2.87696,1.37906,1.63518,1.77237,1.88272,1.977,2.0799,2.19889,2.32183,2.44889,2.58364,2.72321,1.48197,1.69539,1.83475,1.94558,2.0637,2.19334,2.33149,2.47077,2.61792,2.77464,1.78254,2.4209,2.57187,2.72694,2.88112,3.04966,2.09218,2.31676,2.47556,2.61002,2.72429,2.89992,2.25446,2.33149,2.44971,2.58088,2.73447,1.77305,1.94278,2.09316,2.22689,2.34702,2.48394,2.63057,2.78807,2.95489,1.47422,1.69995,1.93961,2.0794,2.20662,2.31549,2.45057,2.58884,2.74828,1.35069,1.56919,1.75,1.85826,1.95483,2.05939,2.17414,2.29373,2.4215,2.55492,2.83407,1.57576,1.59563,1.60407,1.72792,2.01116,2.17046,2.3172,2.44689,2.56351,2.70342,2.87215,1.90991,2.0519,2.17255,2.2815,2.38595,2.64703,1.18393,1.16999,1.16131,1.34984,1.5605,1.70696,1.8316,2.06034,2.18146,2.29013,2.40443,2.5024,2.63123,2.77559,2.41118,2.50668,2.62029,2.79204,1.42389,1.73943,1.89813,2.02626,2.15489,2.28733,2.42766,2.5764,1.94721,2.05072,2.16203,2.26786,2.39168,2.51926,2.6676,2.42228,2.59046,1.39899,1.57313,1.7426,1.86182,1.98942,2.09558,2.21268,2.35008,0.682042,0.847917,1.0675,1.25283,1.38355,1.47871,1.58012,1.76015,1.8631,1.96808,2.06339,2.16672,2.29225,2.43999,1.08397,1.2252,1.38401,1.54761,1.72657,1.82324,1.91678,2.02434,2.13878,2.26295,2.50845,2.64916,2.79634,2.20974,2.31158,2.42166,2.63833,2.79369,1.99553,2.11308,2.34845,2.47345,2.61098,1.19228,1.29945,1.51908,1.644,1.76212,1.8696,1.98672,2.10258,2.2235,2.35055,2.60991,1.62073,1.84483,1.98493,2.10394,2.21379,2.33736,2.43587,2.58882,1.921,2.05839,2.18199,2.55552,1.17794,1.33362,1.50886,1.61507,1.69811,1.80144,1.89448,2.00234,2.06924,2.1238,2.24148,0.688986,0.784231,0.764406,0.730047,0.775698,1.01762,1.21347,1.33661,1.4584,1.55209,1.6401,1.73646,1.83601,1.93992,2.04426,2.17358,2.32677,1.86341,1.95738,2.08527,1.93924,2.08884,1.0526,1.25731,1.44603,1.60648,1.69828,1.80023,1.90327,2.01554,0.558237,0.485616,1.18339,1.26545,1.34323,1.49168,2.03642,2.15752,2.38549,2.52518,0.950833,0.953393,1.04816,1.22868,1.37579,1.49703,1.60024,1.77989,1.87947,1.98224,2.09502,2.21687,2.35321,2.49445,2.63001,2.04098,2.17256,2.294,2.42275,2.57044,2.71774,1.89584,2.02053,2.15771,2.28808,2.42647,1.82287,1.97578,2.10378,2.23927,2.378,0.756957,0.545498,0.800502,0.957608,1.02684,1.11512,1.22568,1.32536,1.41664,1.51143,1.60355,1.72804,1.83248,1.93345,0.566479,0.578742,0.662497,0.841723,0.90341,0.92765,1.55611,1.65412,1.73494,1.84094,1.99762,2.09308,2.21999,1.68688,1.75652,1.88961,2.01078,2.131,1.63563,1.8171,2.01484,2.1888,2.40861,2.49884,2.64522,1.06511,1.06366,1.26467,1.49205,1.59754,1.70917,1.82532,1.93816,2.05103,2.17689,1.79498,1.88605,1.99356,2.09627,2.21367,0.379187,0.247151,0.253933,0.27386,0.257822,0.252904,0.318806,0.306079,0.317853,0.309372,0.296105,0.463053,0.615486,0.723961,0.8491,0.926888,0.995433,1.0599,1.12288,1.18667,1.24983,1.32144,1.46652,1.55331,1.72169,1.81531,1.91197,2.0202,2.13188,2.36245,2.4938,0.935966,0.941986,0.910263,0.999856,1.09967,1.19862,1.1963,1.27592,1.44424,1.62618,1.74762,1.2146,1.30862,1.02646,1.26832,1.38766,1.48268,1.59027,1.78364,0.649044,1.02704,1.15487,1.25476,1.30517,1.36819,1.43105,1.49254,1.52962,1.63035,0.251572,0.326963,0.402522,0.465596,0.534005,0.60428,0.650276,0.738605,1.70327,1.8107,1.92152,2.03672,2.15512,2.39555,2.53463,2.67311,1.55063,1.69514,1.83439,2.0514,2.18065,2.29747,2.43247,2.56498,1.65947,1.87175,2.01816,2.1616,2.29937,1.12207,1.2368,1.35384,1.41454,1.40057,1.25737,1.35054,0.951594,1.03894,1.10919,1.36129,1.43797,1.49835,1.6619,1.84735,1.35439,1.4633,1.50269,1.53944,1.65837,1.29048,1.36945,1.39365,1.46222,1.46624,1.54769,0.0282639,-0.00936602,0.100873,0.194176,0.255619,0.296165,0.338152,0.388926,0.430749,0.49095,0.536024,0.565079,0.602968,0.962101,1.02957,1.15506,1.23777,1.32298,1.63545,1.74128,1.83641,0.87479,1.04515,1.14054,1.22982,1.51847,1.59886,1.78511,1.88656,2.13881,2.26165,1.31269,1.40046,1.57261,1.66817,1.7638,1.84109,1.98996,0.794006,0.981561,1.11076,1.22834,1.31617,1.47154,1.57877,1.75878,1.87156,1.4874,1.54303,1.6462,1.70527,1.80818,1.65293,1.72891,1.83332,0.076612,-0.0142957,0.100774,0.317328,0.48003,0.628019,0.702964,0.768181,0.863541,0.967788,1.03536,1.41559,1.57561,1.67168,1.76277,1.85869,1.95998,2.06789,2.1807,2.29694,2.41916,2.52794,1.95874,2.17786,2.35852,2.42847,2.57401,2.46526,2.64724,2.19558,2.42216,2.5617,1.53749,1.64901,1.74043,1.79951,1.90308,1.16392,1.27972,1.34098,1.47146,1.53562,1.62634,1.7217,1.83377,1.9355,0.0149631,0.0215186,-0.0250323,0.175949,0.285986,0.337567,0.444842,0.496914,0.531293,0.56972,0.602877,0.63206,0.707378,0.756288,1.55405,1.72528,1.24009,1.32222,1.44346,1.56451,1.7482,1.85719,1.98491,2.21056,2.33291,1.57652,1.7464,1.96021,2.06926,2.30548,2.43373,1.61187,1.74743,1.88046,1.98875,2.10384,1.35941,1.62773,1.73082,1.83978,1.93996,2.04601,2.51301,1.64057,1.76223,1.95796,2.0829,2.32719,2.46013,2.24231,2.50075,1.99019,2.1862,2.46564,2.6162,2.75697,1.69188,1.82478,1.97679,2.10332,2.24379,2.504,2.6527,2.79708,1.7092,2.15133,2.39442,2.52891,1.24456,1.62735,1.7293,1.9309,2.05309,2.40033,2.49736,0.17172,0.498762,0.556458,1.36064,1.45508,1.54546,2.60707,2.76832,3.0698,2.14961,2.75607,3.11817,3.33278,3.54502,3.73446,2.09158,2.09994,2.27028,2.36709,2.50649,1.52788,1.76738,1.93248,2.06139,2.53664,3.69932,3.90728,2.16943,2.50175,3.0909,3.62257,4.63654,4.93887,5.20331,5.37838,5.76802,6.52283,7.23861,7.61111,7.82879,7.62006,7.78808,8.85239,10]

function updateEnvironment(index){
    env = new Environment()
    for(i=0; i<index; i++){
        if(i == 0 || env.actionType == 1){
            env.chanceAction(actions[i])
        }
        else{
            env.agentAction(actions[i])
        }
        while(env.actionType == 0){
            // Check if there is only one valid action
            numValidActions = 0
            validAction = -1
            for(d = 0; d < 4; d++){
                if(env.validAgentAction(d)){
                    numValidActions++
                    validAction = d
                }
            }
            if(numValidActions == 1){
                env.agentAction(validAction)
            }
            else{
                break
            }
        }
    }
}


updateEnvironment(1)
currAction = actions[1]
currActionIndex = 2

/*
updateEnvironment(203)
currAction = actions[203]
currActionIndex = 204
*/
tick = 0


/*
//Manual game:
currAction = 0
tick = -1
env.randomChanceAction()
*/

console.log(env)


function fillRect(color,sx,sy,l,w){
    ctx.fillStyle = color;
    ctx.fillRect(sx,sy,l,w);
}

function drawLine(color,p1x,p1y,p2x,p2y, width){
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(p1x,p1y);
    ctx.lineTo(p2x,p2y);
    ctx.stroke();
}

function fillCirc(color,x,y,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,2*pi);
    ctx.fillStyle = color;
    ctx.fill();
}

function fillText(text,color,size,x,y){
    ctx.font = String(size)+"px Arial";
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.fillText(text,x,y);
}

document.addEventListener("keydown",keyHandler);
document.addEventListener("click",clickHandler);

keyMove = ["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"]

paused = true

function keyHandler(event){
    key = event.code
    event.preventDefault()
    /*
    for(i=0; i<4; i++){
        if(keyMove[i] == key){
            if(env.timer != TIME_LIMIT && env.validAgentAction(i)){
                currAction = i
                tick = 0
            }
        }
    }
    */
    if(key == "Space"){
        paused = !paused
        if(paused){
            tick = 0
        }
    }
    if(key == "ArrowRight"){
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowLeft"){
        while(true){
            currActionIndex--
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowDown"){
        currActionIndex = 2
        currAction = actions[currActionIndex-1]
        updateEnvironment(currActionIndex-1)
    }
    if(key == "ArrowUp"){
        currActionIndex = actions.length - 15
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
}

function clickHandler(event){
    rect = canvas.getBoundingClientRect();
    x = event.clientX - rect.left;
    y = event.clientY - rect.top;
}

function draw(){
    fillRect(space, 0, 0, windx, windy)
    fillRect(cLine, marginx - border, marginy - border, boardx*cellS + 2*border, boardy*cellS + 2*border)
    fillRect(space, marginx, marginy, boardx*cellS, boardy*cellS)
    for(var i = 0; i < boardx; i++){
        for(var j = 0; j < boardy; j++){
            if((i + j) % 2 == 0){
                fillRect(cShade, marginx + j * cellS, marginy + i * cellS, cellS, cellS)
            }
        }
    }
    fillCirc(cApple, marginx + env.appley*cellS + cellS/2, marginy + env.applex*cellS + cellS/2, appleSize/2)
    for(i = 0; i < boardx; i++){
        for(j = 0; j < boardy; j++){
            type = env.snake[i][j]
            if(type != -1){
                centerx = marginx + j*cellS + cellS/2
                centery = marginy + i*cellS + cellS/2
                slideProp = tick / framesPerMove
                if(i == env.tailx && j == env.taily && (env.headx + dir[currAction][0] != env.applex || env.heady + dir[currAction][1] != env.appley)){
                    nextx = centerx + dir[type][1] * cellS * slideProp
                    nexty = centery + dir[type][0] * cellS * slideProp
                    fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    drawLine(cSnake, nextx, nexty, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                }
                else{
                    fillCirc(cSnake, centerx, centery, snakeWidth / 2)
                    if(type == 4){
                        nextDir = dir[currAction]
                        nextx = centerx + nextDir[1] * cellS * (tick / framesPerMove)
                        nexty = centery + nextDir[0] * cellS * (tick / framesPerMove)
                        drawLine(cSnake, centerx, centery, nextx, nexty, snakeWidth)
                        fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    }
                    else{
                        drawLine(cSnake, centerx, centery, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                    }
                }
            }
        }
    }
    fillText("Score: " + env.score.toString(), cText, textSize, windx/2, marginy/2)
    fillText("Timer: " + env.timer.toString(), cText, textSize, windx/2, marginy/2 + textSize * 1.5)


    fillText("Value", cValue, textSize, marginx/3, textSize)
    fillText(values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize)
    fillText("Search Value", cSearch, textSize, marginx/3, textSize*2)
    fillText(search_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*2)
    fillText("Network Value", cNetwork, textSize, marginx/3, textSize*3)
    fillText(network_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*3)

    drawLine(cValue, marginx/4, windy/2, marginx/4, windy/2 - values[currActionIndex-2] * 25, marginx/4)

    drawLine(cSearch, marginx*2/4, windy/2, marginx*2/4, windy/2 - search_values[currActionIndex-2] * 25, marginx/4)

    drawLine(cNetwork, marginx*3/4, windy/2, marginx*3/4, windy/2 - network_values[currActionIndex-2] * 25, marginx/4)

    //fillText("Reward", cText, textSize, marginx/4, 100)
    //fillText(values[currActionIndex-1].toString(), cText, textSize, marginx/4, 120)
    //drawLine(cText, marginx/4, windy/2, marginx/4, windy/2 + rewards[currActionIndex-1] * 100, 3)
}

endState = false

function update(){
    if(endState) return
    draw()
    if(!paused){
        tick++
    }
    if(tick >= framesPerMove){
        tick = 0

        env.agentAction(currAction)
        if(env.actionType == 1){
            env.chanceAction(actions[currActionIndex])
            currActionIndex++
        }
        if(env.timer == TIME_LIMIT){
            endState = true
            return
        }

        // Check if there is only one valid action
        numValidActions = 0
        validAction = -1
        for(i = 0; i < 4; i++){
            if(env.validAgentAction(i)){
                numValidActions++
                validAction = i
            }
        }
        if(numValidActions == 0){
            endState = true
            return
        }
        if(numValidActions == 1){
            currAction = validAction
        }
        else{
            currAction = actions[currActionIndex]
            currActionIndex++
        }
    }
}

function updateManual(){
    draw()
    if(tick == -1){
        
    }
    else if(tick < framesPerMove){
        tick++
    }
    else{
        env.agentAction(currAction)
        tick = -1
        if(env.actionType == 1){
            env.randomChanceAction()
        }
    }
}

var ONE_FRAME_TIME = 1000 / 60 ;
var mainloop = function() {
    update()
    //updateManual()
};
setInterval( mainloop, ONE_FRAME_TIME );

</script>

</body>

</html>
