
<!DOCTYPE html>
<html>


<head>
<title> Visualizing snake </title>
</head>


<body>

<div class="panel">
<canvas id="canvas" width="1000" height="600" style="position:relative; top:50px; left:50px"></canvas>
</div>

<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
 
boardx = 10;
boardy = 10;
cellS = 40;
windx = 1000;
windy = 600;
marginx = (windx - boardx * cellS) / 2
marginy = (windy - boardy * cellS) / 2
border = 5
snakeWidth = 20
appleSize = 20
textSize = 20

framesPerMove = 7

dir = [[0,1], [1,0], [0,-1], [-1,0]];

pi = Math.PI;

space = "#fff"
cLine = "#000"
cShade = "#eee"
cSnake = "#00f"
cApple = "#f00"
cText = "#000"

cValue = "#d00"
cSearch = "#bb0"
cNetwork = "#0d0"

TIME_LIMIT = 1200

function randint(max){
    return Math.floor(Math.random()*max)
}

class Environment{
    constructor(){
        this.timer = 0
        this.score = 0;
        this.actionType = 0;
        this.snakeSize = 2;
        this.headx = boardx/2;
        this.heady = 2;
        this.tailx = this.headx;
        this.taily = 1;

        this.snake = []
        for(var i=0; i<boardx; i++){
            this.snake[i] = []
            for(var j=0; j<boardy; j++){
                this.snake[i][j] = -1;
            }
        }
        this.snake[this.headx][this.heady] = 4;
        this.snake[this.tailx][this.taily] = 0;
        this.applex = 0;
        this.appley = 0;
    }

    agentAction(actionIndex){
        this.timer ++
        var newHeadx = this.headx + dir[actionIndex][0];
        var newHeady = this.heady + dir[actionIndex][1];
        this.snake[this.headx][this.heady] = actionIndex;
        this.headx = newHeadx;
        this.heady = newHeady;
        this.snake[newHeadx][newHeady] = 4;

        if(this.headx == this.applex && this.heady == this.appley){
            this.score += 1;
            //score += 1 - timer*0.5/maxTime;
            this.snakeSize++;
            this.actionType = 1;
        }
        else{
            var tailDir = this.snake[this.tailx][this.taily];
            this.snake[this.tailx][this.taily] = -1;
            this.tailx += dir[tailDir][0];
            this.taily += dir[tailDir][1];
        }
    }

    chanceAction(actionIndex){
        this.applex = Math.floor(actionIndex / boardy);
        this.appley = actionIndex % boardy;
        this.actionType = 0
    }

    validAgentAction(d){
        var newHeadx = this.headx + dir[d][0];
        var newHeady = this.heady + dir[d][1];
        if(newHeadx == -1 || newHeadx == boardx){
            return false;
        }
        if(newHeady == -1 || newHeady == boardy){
            return false;
        }
        return this.snake[newHeadx][newHeady] == -1;
    }

    randomChanceAction(){
        while(true){
            this.applex = randint(boardx)
            this.appley = randint(boardy)
            if(this.snake[this.applex][this.appley] == -1){
                break
            }
        }
        this.actionType = 0
    }
}

env = new Environment();

//Agent game:
actions = [86,1,0,0,1,0,0,1,45,2,3,3,3,3,22,0,3,2,2,2,3,2,2,3,3,3,0,78,0,0,0,1,0,1,1,1,1,0,0,1,1,2,24,3,2,3,3,3,2,2,3,43,2,1,1,6,2,3,3,3,0,0,0,3,0,95,1,0,1,1,1,2,1,1,1,1,1,2,80,2,2,2,2,2,38,3,0,1,0,3,0,0,3,0,3,0,3,3,0,78,1,1,1,1,59,0,3,88,3,3,1,1,1,0,1,1,1,1,53,2,2,2,2,3,2,3,3,12,2,3,3,3,3,57,0,0,0,0,0,1,1,1,1,75,1,2,2,1,91,1,1,2,2,2,2,39,2,3,3,3,3,3,3,0,3,2,0,0,0,0,0,0,0,1,1,83,1,1,1,1,1,1,2,2,2,2,2,3,91,2,1,44,3,3,0,0,3,3,3,0,6,0,3,0,3,3,3,74,0,1,1,1,1,2,2,2,1,10,1,0,1,2,2,2,2,3,3,3,3,3,3,3,88,3,1,1,1,1,0,1,2,1,1,0,0,0,0,0,0,78,3,6,2,3,0,3,3,3,3,3,3,2,2,76,1,0,1,1,1,1,1,94,3,3,2,1,1,1,0,1,62,2,3,3,3,11,2,2,3,3,3,3,3,3,1,96,0,3,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,73,2,2,2,3,3,23,3,3,3,3,3,22,2,41,2,1,70,1,1,1,2,81,3,0,0,3,0,1,1,0,0,1,2,2,0,0,1,1,0,1,2,2,2,1,2,2,2,48,1,0,3,0,0,3,3,3,2,0,32,0,3,3,3,3,2,2,2,2,2,1,2,1,1,18,1,1,1,0,3,3,3,3,3,0,0,0,77,1,3,1,1,1,1,0,44,2,2,3,3,3,3,2,94,1,1,40,2,2,2,2,3,3,3,3,57,3,3,3,3,0,0,0,1,2,2,79,0,2,2,1,0,0,98,1,1,32,2,2,2,3,3,3,3,2,2,2,3,12,3,3,53,2,0,0,35,1,2,2,2,3,1,1,1,0,82,0,0,0,3,2,3,0,1,1,1,1,1,1,2,2,2,2,2,2,3,5,2,1,1,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,25,1,1,23,2,2,37,1,0,0,0,0,13,0,3,3,0,1,1,1,1,3,3,3,2,2,2,2,2,3,3,3,2,1,2,3,1,67,3,1,1,2,2,0,0,0,1,0,0,3,3,0,0,0,0,0,83,2,2,2,2,1,9,3,0,0,1,0,3,3,3,3,0,0,0,0,0,0,0,27,2,1,2,40,2,1,0,1,3,2,2,3,3,3,3,53,0,1,0,0,10,0,0,1,0,2,2,2,2,2,3,61,3,1,1,3,3,0,0,0,0,0,0,1,1,1,1,3,1,2,2,0,3,2,3,3,1,63,1,0,66,0,0,0,0,2,16,1,0,1,3,3,3,2,25,2,1,27,0,0,42,2,1,2,2,2,2,13,3,3,3,3,0,1,82,1,1,3,3,1,2,3,2,10,1,2,0,3,3,3,3,3,84,3,1,3,1,0,3,1,1,0,0,1,2,2,0,2,2,2,2,3,1,0,0,0,0,2,3,0,3,0,3,1,3,91,2,1,2,5,2,3,3,0,3,1,0,3,1,2,0,3,0,0,33,1,2,2,1,38,0,0,0,0,27,2,24,2,3,0,3,0,0,1,2,3,2,2,1,2,2,2,3,3,3,1,1,1,3,3,1,1,3,3,3,3,1,0,3,0,1,1,34,3,78,0,3,1,2,88,1,99,0,85,2,3,2,83,1,3,90,80,60,40,30]
values = [2.76104,2.90636,3.05932,3.22034,3.38983,3.56824,3.75604,3.95373,2.95373,3.10919,3.27283,3.44509,3.62641,3.81727,2.81727,2.96555,3.12163,3.28592,3.45887,3.64091,3.83254,4.03425,3.03425,3.19395,3.36205,2.36205,2.48637,1.48637,1.5646,1.64695,1.73363,1.82488,1.92092,2.02202,2.12845,2.24047,2.35839,2.48251,2.61317,2.75071,2.89548,3.04788,2.04788,2.26911,2.38854,2.51425,2.64658,2.78588,2.9325,3.08684,3.24931,2.24931,2.36769,2.49231,2.62348,1.62348,1.70893,1.79887,1.89355,1.99321,2.09812,2.20855,2.32479,2.44714,2.57594,1.57594,1.65888,1.74619,1.8381,1.93484,2.03667,2.14387,2.2567,2.37548,2.5005,2.63211,2.77064,2.91646,1.91646,2.01733,2.1235,2.23527,2.35291,2.60711,1.60711,1.69169,1.78073,1.9731,2.07695,2.18626,2.30133,2.42245,2.54995,2.68416,2.82543,2.97414,3.13067,3.29544,3.46889,2.46889,2.59883,2.73561,2.87959,3.03115,2.03115,2.13805,2.36903,1.59677,1.68081,1.86239,1.96041,2.1722,2.28653,2.53355,2.6669,2.80726,2.95501,3.11054,2.11054,2.22162,2.33854,2.46163,2.59118,2.72756,2.87112,3.02223,3.18129,2.18129,2.2961,2.41695,2.54415,2.67806,2.81901,1.81901,1.91475,2.01552,2.1216,2.23326,2.35081,2.47453,2.60477,2.74186,2.88617,1.88617,1.98544,2.08994,2.19994,2.31572,1.31572,1.38497,1.45787,1.5346,1.61536,1.70038,1.78988,0.789877,0.87521,0.921274,0.969762,1.0208,1.07453,1.13108,1.19061,1.25328,1.31924,1.61968,1.70493,1.79466,1.88911,1.98854,2.0932,2.20337,2.44141,2.5699,2.70516,1.70516,1.79491,1.88938,1.98882,2.09349,2.20367,2.44174,2.57026,2.70553,2.84793,2.99782,3.1556,3.32169,2.32169,2.44388,2.7079,1.7079,1.79779,1.89241,1.99201,2.09685,2.20721,2.32338,2.44567,2.57439,1.57439,1.65725,1.74447,1.83629,1.93293,2.03467,2.14175,1.14175,1.20185,1.2651,1.33168,1.40177,1.47555,1.63496,1.72101,1.90694,2.0073,1.0073,1.06032,1.11612,1.17487,1.30179,1.37031,1.44243,1.59826,1.68238,1.77092,1.86413,1.96224,2.06552,2.17423,2.28866,1.28866,1.42788,1.50303,1.58214,1.66541,1.75306,1.84533,1.94245,2.1523,2.26558,2.51034,2.64246,2.78154,2.92794,3.08204,3.24425,3.415,2.415,2.54211,1.54211,1.62327,1.70871,1.79864,1.8933,1.99295,2.09784,2.20826,2.32448,2.44682,2.5756,2.71116,1.71116,1.80122,1.99581,2.10085,2.21142,2.45033,2.5793,2.71505,1.80531,1.90033,2.00035,2.10563,2.21645,2.4559,2.58516,2.72122,2.86445,1.86445,2.06587,2.1746,2.28905,2.40953,1.40953,1.48371,1.5618,1.644,1.73053,1.82161,1.91748,2.0184,2.23646,2.35417,1.35417,1.42544,1.57943,1.66256,1.75006,1.84217,1.93913,2.04119,2.2617,2.38074,2.50604,2.63794,2.77678,2.92293,3.07676,3.2387,3.58859,3.77746,3.97627,2.97627,3.13292,3.29781,3.47138,3.65408,3.8464,2.8464,2.99621,3.15391,3.3199,3.49463,3.67856,2.67856,2.81954,1.81954,2.01611,2.12222,1.12222,1.18129,1.24346,1.3089,1.37779,0.377794,0.513942,0.540991,0.569464,0.599436,0.630985,0.699153,0.73595,0.774685,0.815457,0.858376,0.903554,1.00117,1.05386,1.10933,1.16771,1.22917,1.29386,1.36196,1.43364,1.5091,1.58853,1.67213,1.76014,1.85278,1.95029,0.950294,1.00031,1.22812,1.36079,1.43242,1.50781,1.58716,1.6707,1.75863,1.94862,2.05118,1.05118,1.1065,1.16474,1.22604,1.29057,1.43,1.50526,1.58448,1.66788,1.75566,1.84807,1.94533,2.04772,2.15549,2.26894,1.26894,1.33573,1.40603,1.48003,1.55792,1.63992,1.72623,1.81709,2.01339,2.23091,2.34832,2.47192,2.60202,1.68633,1.86851,2.07038,2.17934,2.29405,2.41479,2.54188,2.81649,1.81649,1.91209,2.01273,2.11866,2.23017,2.34755,2.4711,2.73806,2.02719,2.13389,2.24619,1.24619,1.31178,1.38083,1.4535,1.61053,1.69529,1.78452,1.87844,1.9773,0.977304,1.02874,1.08289,1.13988,1.26302,1.3295,1.39947,2.33738,2.4604,2.58989,2.7262,1.81705,2.01335,2.11932,2.23086,2.73892,2.88307,3.19454,2.19454,2.31004,2.5596,1.5596,1.64168,1.72809,1.91478,2.01556,2.12164,2.2333,2.35084,2.47457,2.60481,2.74191,2.88622,1.88622,1.9855,2.09,1.09,1.40866,1.4828,1.56084,0.560844,0.590362,0.621434,0.654141,0.688569,1.09253,1.15004,1.21056,1.34135,1.41194,0.433624,0.456446,0.48047,0.505758,0.532376,0.560396,0.589891,0.762349,0.802472,0.844708,0.889166,0.935964,0.985225,1.09166,1.14912,1.2096,1.27326,1.34027,1.41082,1.48507,1.56323,0.563231,0.592875,0.84898,0.940698,0.990209,1.04232,1.09718,1.21572,1.2797,1.34705,1.41795,1.57114,1.65383,1.74087,1.8325,2.03047,2.13734,2.24983,2.36824,2.49288,2.7622,2.90758,3.06061,3.22169,3.39125,2.39125,2.51711,2.64959,1.64959,1.73641,1.8278,0.827798,0.871366,0.917228,0.965503,1.01632,1.06981,0.0698095,0.0734836,0.0773512,0.0814223,0.0857077,0.0999652,0.105227,0.110765,0.420328,0.44245,0.465737,0.516052,0.543213,0.571803,0.601898,0.633577,0.666923,0.702024,0.738973,0.777866,0.818806,0.861901,0.907265,1.17251,1.23422,0.246547,0.273182,0.28756,0.302695,0.318626,0.411778,0.43345,0.456264,0.480278,1.27275,1.33974,1.41025,1.48448,1.56261,1.64485,1.73142,1.82255,1.91847,2.12573,1.12573,1.18498,1.24734,1.31299,1.45484,1.53141,0.55938,0.619812,0.652434,0.686772,0.722918,1.27095,1.33785,1.40826,1.48238,1.5604,1.64252,1.72897,1.81997,1.91576,2.01659,2.12272,2.23445,1.29942,1.36781,1.4398,1.51558,0.515576,0.542711,0.571275,0.666307,1.05721,1.4382,1.5139,1.67745,1.76574,1.85867,1.95649,2.05947,1.05947,1.11523,1.17393,1.23571,1.30075,0.33324,0.350779,0.453331,0.47719,0.883097,0.929575,0.9785,1.08421,1.14127,1.26457,1.33113,0.331127,0.366899,0.38621,0.427933,0.450456,0.49912,0.52539,0.553042,0.582149,0.612789,0.645041,0.714727,0.752344,0.791941,1.3923,1.54272,1.70938,1.89405,1.99374,2.20913,2.3254,2.44779,2.71223,2.85498,3.32991,3.50516,2.63701,2.7758,3.07568,2.18493,2.29993,2.42098,2.5484,2.82371,2.97232,1.97232,2.07613,2.1854,2.97296,3.12943,3.29414,3.65002,3.84212,2.84212,2.99171,3.14917,2.14917,2.26228,2.38135,1.45405,1.53058,1.61114,1.69593,1.78519,1.87915,1.97805,0.978051,1.02953,1.08371,1.14075,1.20079,1.26399,1.33052,0.330516,0.347911,0.385497,1.07535,1.19152,1.32025,1.38973,1.46288,1.53987,0.539871,0.598195,0.662819,0.813768,0.856598,0.901682,0.949139,0.999094,1.05168,0.051678,0.0740014,0.081996,0.0908543,0.0956361,0.10067,0.111545,0.117416,0.123596,0.130101,0.136948,0.168137,0.176986,0.206428,0.228729,0.240767,0.253439,0.266778,0.362918,0.445568,0.493704,0.519688,0.54704,0.575832,0.638041,0.671622,0.706971,0.74418,0.783347,1.52597,1.69083,1.8735,1.9721,0.972102,1.02327,1.13381,1.19349,0.193486,0.214389,0.225673,0.462752,0.487107,0.568138,0.59804,0.662648,0.901449,1.16499,1.35879,2.38887,2.64695,2.78626,2.93291,1.93291,2.03464,2.14173,2.3731,2.498,1.57685,1.65984,1.7472,1.83916,1.93595,0.985215,1.03707,0.037068,0.039019,0.0410726,0.0432343,0.0455098,0.0479051,0.0530804,0.09332,0.0982316,0.103402,0.108844,0.114572,0.120603,0.12695,0.133632,0.148068,0.155861,0.21203,0.303621,0.319601,0.336422,0.392386,0.413038,0.45766,0.481747,0.533792,0.561886,0.726157,0.764376,0.846954,0.89153,0.938453,1.92434,2.02562,2.13223,2.36259,1.36259,1.76095,0.887529,0.983412,1.08965,2.23438,2.35198,1.35198,1.42314,0.423139,0.468852,-0.588529,-0.619504,-0.65211,-0.686432,-1.68643,-1.86862,-2.0705,-3.76976,-5.0208,-6.67125,-8.5,-10]
network_values = [2.43561,2.31504,2.71636,2.98939,3.04548,3.33351,3.81127,3.28475,2.82345,2.63153,2.85534,3.0609,3.33834,3.35359,2.62129,2.46372,2.67626,2.51742,3.03865,3.13089,3.30836,3.41268,2.77812,2.74054,2.67584,2.7832,2.55961,1.80204,1.83214,1.6715,1.96807,2.14766,1.90978,2.18144,2.22551,2.60814,2.83461,2.91791,3.04195,3.22445,3.59952,3.11483,2.22175,2.2475,2.37608,2.47458,2.60487,2.8489,2.94133,3.09599,3.05784,2.3683,2.66219,2.88105,3.20869,1.97342,2.12824,2.10599,2.00102,1.92423,2.46653,2.7284,2.85934,2.69615,2.62212,1.69018,1.67397,1.61936,1.55257,1.92582,2.05276,2.32303,2.02739,2.21674,2.55933,2.67905,2.53165,2.2734,1.91985,2.11791,2.36633,2.62405,2.29554,2.79189,1.59064,1.77417,1.30819,2.12822,1.73122,1.59695,1.95825,2.10877,1.8227,2.11486,2.48207,2.58554,2.55997,2.54204,2.93039,2.26315,2.12583,2.40068,2.66734,2.81756,2.25527,2.24295,2.46802,2.26429,2.0343,2.19836,2.24513,1.64261,2.20013,2.15802,2.67379,2.87576,2.60736,2.60644,1.91224,1.73466,2.01662,2.30169,2.34558,2.53149,2.66795,3.02406,3.27426,1.84443,1.97397,2.35116,2.40136,2.78325,2.25365,2.0189,2.10131,1.94554,2.1003,2.04877,2.26113,1.9724,2.80138,2.69407,2.8681,2.41195,2.14626,2.69685,2.88884,2.9292,1.37404,1.71608,1.6658,1.882,2.14156,2.39079,2.331,1.65889,1.24817,1.33089,1.39391,1.80371,1.2936,1.73218,1.36179,1.23491,1.58645,1.88542,2.37897,2.50088,2.04734,2.42856,2.41088,2.28118,2.44679,2.69066,2.80435,1.80754,1.54982,1.64941,1.89806,2.1326,2.04289,2.31433,2.20609,2.63783,2.44573,2.71013,3.09179,2.8131,2.28627,2.57449,3.13021,2.17187,1.83616,2.36497,2.33949,2.1904,2.12153,2.85341,3.08282,3.12069,1.89055,1.96314,2.2269,2.04365,2.14891,2.23165,2.19726,1.24611,1.16664,1.37959,1.66775,1.49389,1.96911,2.13251,2.03809,2.06582,2.21657,1.13817,1.18557,0.866357,1.33226,1.20912,1.46198,1.40604,1.67162,1.66427,1.57933,2.3041,2.20924,2.45287,2.69755,2.69881,1.35991,1.46587,1.64451,1.70271,1.13247,1.52948,1.56533,1.41464,1.59267,1.72428,2.21803,1.75072,1.74776,2.15612,2.71091,2.91814,2.4651,2.69625,2.797,1.25042,1.63902,1.76025,1.47175,1.82871,1.9506,1.66812,2.19237,2.2061,2.05338,2.46438,2.36164,1.57063,1.39677,1.2829,1.64216,1.78966,2.08682,2.20933,1.4588,1.48106,1.63799,1.67625,1.42729,1.38677,1.72341,2.34277,2.23186,2.34041,1.60559,1.78815,2.04801,2.3103,2.24114,1.60036,1.44434,1.14695,-0.0304432,1.99925,1.44505,2.22125,0.840905,2.18692,0.699917,1.46591,0.894812,1.34122,0.835668,1.40891,1.64289,1.15806,1.56747,1.68285,1.90176,1.73112,2.15618,1.44907,2.18648,1.82571,2.24351,2.21976,2.28535,2.38663,1.98198,1.94883,2.12953,1.96529,2.52114,2.47262,1.44719,1.54558,2.08894,2.31271,2.39371,2.31774,2.09181,2.07771,1.17026,2.21123,2.03707,1.27067,1.57477,1.71932,-0.0119775,1.28598,1.35063,-0.0334888,1.47433,0.998702,1.42538,1.32071,1.39077,1.25947,1.43024,1.18365,0.752238,0.188051,-0.415963,1.10201,-0.290296,0.40333,1.0766,0.757029,1.57888,1.33167,1.62302,1.65536,1.5745,1.66393,2.25252,1.3657,1.11013,1.04028,1.02993,0.991835,1.45287,1.34894,1.79158,1.34039,1.99712,2.17451,1.72249,0.835231,-0.0102283,0.828207,0.746568,0.951427,1.08285,1.22865,1.56783,1.82292,1.77187,2.19155,2.2096,1.8576,2.44629,2.04211,1.37776,1.01916,1.15312,0.843589,0.983047,1.50812,0.992768,1.75571,1.74449,1.39093,2.04583,2.01478,2.10592,0.942577,1.1551,1.2767,0.878827,1.5616,1.64931,1.48377,1.55264,-0.0062108,1.37601,1.0886,1.68141,1.57434,1.56463,1.20595,1.40983,1.26824,1.62185,1.56362,1.06137,1.16934,1.21981,1.0441,0.851561,1.19453,1.06959,1.863,1.94031,0.910432,1.17716,1.0418,0.946393,0.899348,1.05432,1.23242,1.70857,1.69509,1.8304,1.68337,0.814355,1.15009,0.861486,1.0103,1.45524,2.03081,2.14077,1.8629,2.16613,1.37294,1.34157,1.34968,1.61186,1.15922,1.54417,1.19197,1.64503,1.11567,1.55415,2.18471,2.16828,1.61179,1.44046,1.44387,1.86484,0.801544,0.697087,1.96791,1.2788,0.81698,0.189187,0.835305,0.5244,-0.0351967,1.2575,1.48974,1.09036,0.878296,1.10621,0.487541,0.531519,0.21756,0.413944,0.935579,0.284339,0.889598,0.619848,0.617388,0.669956,0.685775,0.70454,1.5776,1.24737,1.1338,1.3573,1.95362,2.00543,2.21654,2.07045,2.44461,0.91174,1.04552,0.76088,0.867956,1.05266,1.22495,1.05487,1.07787,0.970094,0.897634,0.804808,0.845881,0.687237,0.843994,0.0688804,1.06166,0.962707,1.62453,1.57478,1.39042,1.82698,1.83407,2.42529,2.22105,2.12954,2.04074,2.59235,2.91193,1.82439,2.41931,2.55033,1.62701,1.43386,1.59582,1.80797,2.07109,1.37356,0.759334,1.29844,1.03903,1.66059,1.38337,1.39822,0.220347,-0.00325749,1.34237,0.701279,0.737458,1.31647,0.899348,1.43895,1.443,1.39222,1.27577,1.3189,1.27654,1.06216,1.15186,1.43071,1.36334,1.72233,1.7543,1.4163,0.845723,0.530204,0.955316,1.10239,0.543696,1.00785,0.30322,-0.0677242,0.971824,0.412887,1.0642,1.60862,0.610942,0.817114,0.0900895,1.00266,1.37517,1.14261,1.34606,1.14589,0.920343,1.419,-0.464722,2.27296,0.562403,-0.0872059,-0.0363335,0.232652,0.310192,0.603109,0.561321,0.903515,0.809501,1.62084,0.771379,0.972785,1.40952,1.35978,1.92364,1.4706,1.12699,1.9731,1.85214,1.72488,2.23955,0.995418,0.606309,0.398232,0.815969,0.718789,0.872915,1.53046,1.17837,1.39126,1.78713,1.84437,1.63514,1.00243,1.85094,1.17669,1.38127,-0.0448067,1.01819,-0.180693,1.36091,0.406807,0.195256,1.01997,0.349018,1.30991,1.24006,1.24833,1.13984,1.31093,1.73886,1.90025,1.11144,1.1735,1.02393,0.73779,1.27205,1.35864,1.22806,1.61625,1.16294,1.09229,1.26104,1.27392,1.43526,1.03155,1.28776,1.52639,1.86397,1.83793,1.90334,2.19926,1.0395,2.05913,1.58081,1.23429,-1.19075,1.43519,-0.0463422,1.01915,1.90924,1.61501,-0.0233804,1.32828,0.259702,1.22947,1.0417,1.3855,1.6404,1.54491,1.92066,3.06658,2.27657,1.93021,1.74552,1.40324,1.18387,2.53861,0.260036,-0.000859447,0.678786,0.176068,1.12782,0.900415,-0.062004,-0.0523924,-0.226846,1.41711,1.46109,0.591847,-0.112883,1.46743,-0.259721,-1.1272,-1.86129,0.63145,0.734989,1.60031,2.08352,-0.119703,1.15711,0.779987,0.375918,0.708189,1.28818,1.39465,0.825602,1.21779,1.21387,2.33149,0.960928,1.85711,1.39251,1.22076,1.52757,2.11132,1.72196,1.65612,1.54656,1.83888,1.35681,1.43419,0.343724,1.4466,1.62702,0.944015,0.405025,1.08161,-0.00254255,1.18157,1.13421,1.13481,0.72917,0.731339,1.04275,0.936707,0.723946,0.582115,0.962219,1.31644,1.55641,1.37017,2.21993,0.916696,1.43209,1.25684,1.18497,1.38704,0.691561,0.40681,1.08595,1.49616,0.879288,0.610223,1.07527,1.20825,0.997713,1.13213,1.13325,2.09135,1.70913,1.69013,1.41775,0.879948,1.74484,1.48755,0.949394,1.66397,0.742391,1.15832,1.5747,1.55922,1.21725,2.14252,1.90853,2.12102,1.94295,1.64849,1.52283,1.48616,1.34028,1.69809,1.33859,1.3091,0.753481,1.42133,1.65553,0.906707,0.597514,0.924203,1.03522,0.224243,1.1743,1.13079,1.6298,0.628467,1.77346,1.60624,1.48331,1.95211,1.9125,1.81976,1.78633,1.46644,1.96963,-0.00797234,2.10568,2.34039,1.72232,2.5924,1.76395,2.11845,1.66177,1.55412,1.34567,2.18854,3.25353,2.34269,2.02944,1.48303,3.29416,2.43408,2.40927,2.40286,2.92696,2.51471,2.72374,2.95242,2.24868,3.58637,2.81233,2.42124,2.46912]
search_values = [1.99237,2.04482,2.17626,2.38527,2.55914,2.7552,2.87567,3.10407,2.05869,2.33054,2.57886,2.81259,3.01893,3.24123,2.0525,1.8552,2.07117,2.28245,2.46022,2.65372,2.80297,3.02043,2.46246,2.71157,2.93427,2.85536,3.05883,1.38784,1.39024,1.46718,1.53511,1.61869,1.66419,1.80234,1.93186,2.15139,2.3299,2.46548,2.47785,2.62269,2.75711,2.93516,1.51468,1.74421,1.85609,2.00247,2.24034,2.41837,2.61617,2.7645,2.97848,2.44626,2.64608,2.84002,3.0271,1.45847,1.52103,1.79389,1.99883,2.14255,2.31129,2.4457,2.51236,2.70238,2.86979,1.31365,1.36251,1.33597,1.45465,1.54317,1.61057,1.63764,1.85438,2.08804,2.2978,2.48922,2.66596,2.82976,1.92693,2.13443,2.28546,2.43711,2.58331,2.88331,1.25728,1.24027,1.26645,1.39044,1.41113,1.48012,1.55652,1.63867,1.71238,1.86954,2.07221,2.2215,2.41332,2.53279,2.74123,1.91032,2.15305,2.29828,2.37761,2.59929,2.07753,2.25655,2.5266,1.07718,1.07759,1.2131,1.35485,1.54711,1.72705,1.9877,2.12205,2.26421,2.42415,2.60481,1.5707,1.71257,1.76538,1.9962,2.2191,2.41,2.56339,2.75529,2.97098,1.67171,1.8684,2.08729,2.28646,2.45059,2.64261,1.32252,1.45186,1.4558,1.57931,1.73776,1.97311,2.18399,2.37481,2.55096,2.7437,2.0155,2.26177,2.43205,2.54242,2.75995,1.49371,1.74829,1.9824,2.11637,2.19285,2.23129,2.36727,0.868556,0.956083,0.975769,0.9853,1.05834,1.08675,1.11097,1.14516,1.19792,1.22693,1.29822,1.52778,1.73855,1.89594,2.02895,2.15287,2.28442,2.53717,2.68262,2.8466,1.30373,1.32202,1.37218,1.50848,1.67052,1.80796,2.04244,2.17467,2.3103,2.4484,2.59717,2.73621,2.91198,2.28985,2.43945,2.74271,1.44875,1.61365,1.84617,2.10511,2.25698,2.39683,2.57318,2.69311,2.89073,1.44787,1.5826,1.82231,1.94152,2.11578,2.27692,2.46862,0.854867,1.06949,1.26137,1.40429,1.51331,1.65432,1.87513,2.02969,2.24474,2.39019,0.702884,0.732011,0.728026,0.82107,1.11875,1.28797,1.43378,1.57535,1.64606,1.74501,1.84099,1.94109,2.06055,2.19451,2.33912,0.873025,0.970252,0.990707,1.02924,1.04464,1.07118,1.11993,1.09081,1.21384,1.29437,1.54455,1.69382,1.81297,1.94571,2.09361,2.26779,2.45456,2.42344,2.65641,1.15191,1.15545,1.18528,1.08536,1.18937,1.41601,1.70448,1.90258,2.09248,2.24836,2.38036,2.5398,0.991946,1.36864,1.68635,1.83022,1.95686,2.18374,2.3337,2.47056,1.1008,1.1617,1.25571,1.40318,1.54481,1.7318,1.87697,2.0422,2.18673,1.69776,1.91907,2.04388,2.13168,2.27607,1.09264,1.15533,1.41193,1.56848,1.70522,1.80713,1.89424,2.00074,2.20523,2.35434,0.633665,0.667419,0.692621,0.711908,0.754601,0.846374,0.89714,0.937197,1.00884,1.19783,1.43569,1.60261,1.73924,1.86121,1.98285,2.10808,2.34729,2.49642,2.64758,1.6914,1.92925,2.11295,2.26803,2.41344,2.60135,1.44671,1.65551,1.81644,1.98662,2.11446,2.28879,2.07567,2.25446,1.83238,1.78568,1.94569,1.03575,1.27006,1.39622,1.51676,1.63579,0.145811,0.305177,0.334435,0.366489,0.295182,0.298453,0.326745,0.379364,0.312194,0.376496,0.457475,0.557615,0.658434,0.686632,0.757913,0.789105,0.812901,0.787738,0.876943,0.954979,1.11142,1.18267,1.26421,1.27382,1.33769,1.47585,0.318019,0.567716,0.720356,0.82677,0.916459,0.968709,1.05226,1.12203,1.16395,1.2734,1.37226,0.571309,0.733766,0.783988,0.854897,0.93432,1.11104,1.26144,1.3914,1.51116,1.63334,1.76107,1.86311,2.00583,2.14076,2.32588,0.849426,0.667043,0.639207,0.599246,0.693317,0.864106,0.989817,1.07028,1.19665,1.33993,1.43626,1.5076,1.59711,1.04369,1.25008,1.43522,1.55354,1.65119,1.7552,1.86846,2.10505,0.761531,1.1116,1.32177,1.47391,1.57846,1.68902,1.81206,2.01287,1.65836,1.78961,1.96375,0.782735,0.999421,1.12699,1.21561,1.36465,1.45555,1.56586,1.67302,1.79008,0.324734,0.492832,0.612275,0.697527,0.810241,0.875669,0.922048,1.5288,1.59772,1.64463,1.77937,0.9956,1.17458,1.28351,1.36687,1.67513,1.73614,1.9464,1.75147,1.87669,2.11349,0.636924,0.726626,0.871748,1.08482,1.22411,1.31525,1.42485,1.51598,1.60081,1.70839,1.78579,1.94473,1.42654,1.54128,1.70764,0.930049,1.1862,1.24579,1.335,0.225088,0.430047,0.568435,0.643736,0.704993,1.12488,1.21051,1.304,1.4575,1.54866,0.1656,0.173079,0.0744279,0.173456,0.253448,0.347112,0.359167,0.599979,0.77637,0.906824,0.997952,1.08155,1.16127,1.29285,1.37716,1.46366,1.55599,1.63994,1.73239,1.85518,1.98288,0.286378,0.349181,0.412669,0.396871,0.354369,0.318581,0.275786,0.306546,0.307033,0.37989,0.439739,0.605841,0.878383,1.03256,1.13982,1.30136,1.38927,1.47927,1.57883,1.66377,1.84691,1.97471,2.10838,2.27472,2.42203,2.241,2.23211,2.41307,1.96815,1.90676,2.06003,1.20303,1.40038,1.55686,1.67597,1.8088,1.96668,0.252936,0.0727016,0.0334682,0.0168837,0.0133396,0.0116868,0.0373691,0.0778235,0.344781,0.321462,0.323773,0.337104,0.402297,0.532294,0.715864,0.837427,0.949408,1.07776,1.16741,1.19726,1.25071,1.31403,1.30344,1.64831,1.7705,0.080838,0.0982645,0.021788,-0.0012198,-0.0157087,0.0133584,0.0995459,0.175598,0.261526,0.755774,0.877299,0.949751,1.03236,1.12729,1.19161,1.27623,1.36613,1.45532,1.63118,0.801563,0.864373,0.951479,1.00982,1.15919,1.2351,0.120138,0.202835,0.233806,0.271531,0.288931,0.684576,0.857242,1.01082,1.10996,1.20317,1.2617,1.32819,1.40562,1.49394,1.597,1.70363,1.80212,1.57956,1.6507,1.56283,1.68613,0.0723013,0.31229,0.433847,0.524874,0.832267,1.11661,1.19152,1.32972,1.43103,1.525,1.64585,1.7567,1.02419,1.12497,1.20741,1.327,1.41162,0.163435,0.39686,0.596193,0.656264,1.27294,1.35305,1.43826,1.59966,1.71487,1.90446,2.03537,0.294835,0.310342,0.256889,0.255551,0.249768,0.210282,0.135649,0.128087,0.233068,0.322488,0.410765,0.503842,0.557934,0.611164,1.09233,1.18781,1.33786,1.42487,1.46651,1.51487,1.40217,1.29902,1.16652,1.12472,1.35749,1.45232,0.786428,1.20592,1.34724,1.02217,1.02416,1.12977,1.27659,1.51945,1.6278,0.850859,0.990986,1.07752,1.4903,1.57985,1.69346,1.88142,2.00488,1.63239,1.7394,1.86281,1.42819,1.52695,1.62701,0.554269,0.543695,0.803939,0.949248,1.1101,1.24795,1.32983,0.500905,0.523091,0.592649,0.704172,0.874977,0.947346,1.01589,0.183122,0.274099,0.311316,0.881049,0.899915,0.971796,1.0563,1.32837,1.40881,0.875533,1.11736,1.30714,1.67651,1.81292,1.93497,2.0538,2.1863,2.30873,0.273337,0.282679,0.208656,0.23688,0.179923,0.0472186,0.0877604,0.0899482,0.139716,0.132169,0.0590564,0.0583887,0.00735899,-0.0246044,-0.0201785,-0.00960855,0.0155445,0.0462174,0.101259,0.148665,0.264254,0.320501,0.409038,0.484499,0.562005,0.588202,0.656367,0.710942,0.717571,1.37218,1.51999,1.64385,1.76558,1.17368,1.14967,1.27641,1.37452,-0.0610813,0.0372357,0.094637,0.228607,0.284743,0.362459,0.373099,0.409831,0.594595,0.804028,0.988161,1.75562,1.98448,2.13126,2.26301,1.66714,1.85878,2.03226,2.27232,2.40142,1.65399,1.71396,1.79906,1.89712,2.01373,1.80184,1.94287,-0.0547534,-0.0165902,0.010794,-0.0092838,-0.0419831,-0.0453828,-0.085372,-0.148694,-0.164605,-0.151469,-0.139352,-0.109324,-0.0909185,-0.0842948,-0.0572763,-0.00579971,-0.0475925,0.00624365,-0.0796582,-0.0929321,-0.10485,-0.0385395,0.0816125,0.199853,0.284303,0.355914,0.397499,0.550956,0.630439,0.716196,0.786276,0.790447,1.63337,1.74912,1.83611,2.05305,1.71806,2.26249,1.08489,1.30515,1.48174,3.0472,3.22931,2.68382,2.91624,2.50804,2.85199,2.12681,2.35439,2.52163,2.66307,2.12332,2.30448,2.57219,2.54607,2.50057,1.94806,2.73396,-10]

function updateEnvironment(index){
    env = new Environment()
    for(i=0; i<index; i++){
        if(i == 0 || env.actionType == 1){
            env.chanceAction(actions[i])
        }
        else{
            env.agentAction(actions[i])
        }
        while(env.actionType == 0){
            // Check if there is only one valid action
            numValidActions = 0
            validAction = -1
            for(d = 0; d < 4; d++){
                if(env.validAgentAction(d)){
                    numValidActions++
                    validAction = d
                }
            }
            if(numValidActions == 1){
                env.agentAction(validAction)
            }
            else{
                break
            }
        }
    }
}


updateEnvironment(1)
currAction = actions[1]
currActionIndex = 2

/*
updateEnvironment(203)
currAction = actions[203]
currActionIndex = 204
*/
tick = 0


/*
//Manual game:
currAction = 0
tick = -1
env.randomChanceAction()
*/

console.log(env)


function fillRect(color,sx,sy,l,w){
    ctx.fillStyle = color;
    ctx.fillRect(sx,sy,l,w);
}

function drawLine(color,p1x,p1y,p2x,p2y, width){
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(p1x,p1y);
    ctx.lineTo(p2x,p2y);
    ctx.stroke();
}

function fillCirc(color,x,y,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,2*pi);
    ctx.fillStyle = color;
    ctx.fill();
}

function fillText(text,color,size,x,y){
    ctx.font = String(size)+"px Arial";
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.fillText(text,x,y);
}

document.addEventListener("keydown",keyHandler);
document.addEventListener("click",clickHandler);

keyMove = ["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"]

paused = true

function keyHandler(event){
    key = event.code
    event.preventDefault()
    /*
    for(i=0; i<4; i++){
        if(keyMove[i] == key){
            if(env.timer != TIME_LIMIT && env.validAgentAction(i)){
                currAction = i
                tick = 0
            }
        }
    }
    */
    if(key == "Space"){
        paused = !paused
        if(paused){
            tick = 0
        }
    }
    if(key == "ArrowRight"){
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowLeft"){
        while(true){
            currActionIndex--
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowDown"){
        currActionIndex = 2
        currAction = actions[currActionIndex-1]
        updateEnvironment(currActionIndex-1)
    }
    if(key == "ArrowUp"){
        currActionIndex = actions.length - 15
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
}

function clickHandler(event){
    rect = canvas.getBoundingClientRect();
    x = event.clientX - rect.left;
    y = event.clientY - rect.top;
}

function draw(){
    fillRect(space, 0, 0, windx, windy)
    fillRect(cLine, marginx - border, marginy - border, boardx*cellS + 2*border, boardy*cellS + 2*border)
    fillRect(space, marginx, marginy, boardx*cellS, boardy*cellS)
    for(var i = 0; i < boardx; i++){
        for(var j = 0; j < boardy; j++){
            if((i + j) % 2 == 0){
                fillRect(cShade, marginx + j * cellS, marginy + i * cellS, cellS, cellS)
            }
        }
    }
    fillCirc(cApple, marginx + env.appley*cellS + cellS/2, marginy + env.applex*cellS + cellS/2, appleSize/2)
    for(i = 0; i < boardx; i++){
        for(j = 0; j < boardy; j++){
            type = env.snake[i][j]
            if(type != -1){
                centerx = marginx + j*cellS + cellS/2
                centery = marginy + i*cellS + cellS/2
                slideProp = tick / framesPerMove
                if(i == env.tailx && j == env.taily && (env.headx + dir[currAction][0] != env.applex || env.heady + dir[currAction][1] != env.appley)){
                    nextx = centerx + dir[type][1] * cellS * slideProp
                    nexty = centery + dir[type][0] * cellS * slideProp
                    fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    drawLine(cSnake, nextx, nexty, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                }
                else{
                    fillCirc(cSnake, centerx, centery, snakeWidth / 2)
                    if(type == 4){
                        nextDir = dir[currAction]
                        nextx = centerx + nextDir[1] * cellS * (tick / framesPerMove)
                        nexty = centery + nextDir[0] * cellS * (tick / framesPerMove)
                        drawLine(cSnake, centerx, centery, nextx, nexty, snakeWidth)
                        fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    }
                    else{
                        drawLine(cSnake, centerx, centery, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                    }
                }
            }
        }
    }
    fillText("Score: " + env.score.toString(), cText, textSize, windx/2, marginy/2)
    fillText("Timer: " + env.timer.toString(), cText, textSize, windx/2, marginy/2 + textSize * 1.5)


    fillText("Value", cValue, textSize, marginx/3, textSize)
    fillText(values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize)
    fillText("Search Value", cSearch, textSize, marginx/3, textSize*2)
    fillText(search_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*2)
    fillText("Network Value", cNetwork, textSize, marginx/3, textSize*3)
    fillText(network_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*3)

    drawLine(cValue, marginx/4, windy/2, marginx/4, windy/2 - values[currActionIndex-2] * 25, marginx/4)

    drawLine(cSearch, marginx*2/4, windy/2, marginx*2/4, windy/2 - search_values[currActionIndex-2] * 25, marginx/4)

    drawLine(cNetwork, marginx*3/4, windy/2, marginx*3/4, windy/2 - network_values[currActionIndex-2] * 25, marginx/4)

    //fillText("Reward", cText, textSize, marginx/4, 100)
    //fillText(values[currActionIndex-1].toString(), cText, textSize, marginx/4, 120)
    //drawLine(cText, marginx/4, windy/2, marginx/4, windy/2 + rewards[currActionIndex-1] * 100, 3)
}

endState = false

function update(){
    if(endState) return
    draw()
    if(!paused){
        tick++
    }
    if(tick >= framesPerMove){
        tick = 0

        env.agentAction(currAction)
        if(env.actionType == 1){
            env.chanceAction(actions[currActionIndex])
            currActionIndex++
        }
        if(env.timer == TIME_LIMIT){
            endState = true
            return
        }

        // Check if there is only one valid action
        numValidActions = 0
        validAction = -1
        for(i = 0; i < 4; i++){
            if(env.validAgentAction(i)){
                numValidActions++
                validAction = i
            }
        }
        if(numValidActions == 0){
            endState = true
            return
        }
        if(numValidActions == 1){
            currAction = validAction
        }
        else{
            currAction = actions[currActionIndex]
            currActionIndex++
        }
    }
}

function updateManual(){
    draw()
    if(tick == -1){
        
    }
    else if(tick < framesPerMove){
        tick++
    }
    else{
        env.agentAction(currAction)
        tick = -1
        if(env.actionType == 1){
            env.randomChanceAction()
        }
    }
}

var ONE_FRAME_TIME = 1000 / 60 ;
var mainloop = function() {
    update()
    //updateManual()
};
setInterval( mainloop, ONE_FRAME_TIME );

</script>

</body>

</html>
