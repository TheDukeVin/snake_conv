
<!DOCTYPE html>
<html>


<head>
<title> Visualizing snake </title>
</head>


<body>

<div class="panel">
<canvas id="canvas" width="1000" height="600" style="position:relative; top:50px; left:50px"></canvas>
</div>

<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
 
boardx = 10;
boardy = 10;
cellS = 40;
windx = 1000;
windy = 600;
marginx = (windx - boardx * cellS) / 2
marginy = (windy - boardy * cellS) / 2
border = 5
snakeWidth = 20
appleSize = 20
textSize = 20

framesPerMove = 7

dir = [[0,1], [1,0], [0,-1], [-1,0]];

pi = Math.PI;

space = "#fff"
cLine = "#000"
cShade = "#eee"
cSnake = "#00f"
cApple = "#f00"
cText = "#000"

cValue = "#d00"
cSearch = "#bb0"
cNetwork = "#0d0"

TIME_LIMIT = 1200

function randint(max){
    return Math.floor(Math.random()*max)
}

class Environment{
    constructor(){
        this.timer = 0
        this.score = 0;
        this.actionType = 0;
        this.snakeSize = 2;
        this.headx = boardx/2;
        this.heady = 2;
        this.tailx = this.headx;
        this.taily = 1;

        this.snake = []
        for(var i=0; i<boardx; i++){
            this.snake[i] = []
            for(var j=0; j<boardy; j++){
                this.snake[i][j] = -1;
            }
        }
        this.snake[this.headx][this.heady] = 4;
        this.snake[this.tailx][this.taily] = 0;
        this.applex = 0;
        this.appley = 0;
    }

    agentAction(actionIndex){
        this.timer ++
        var newHeadx = this.headx + dir[actionIndex][0];
        var newHeady = this.heady + dir[actionIndex][1];
        this.snake[this.headx][this.heady] = actionIndex;
        this.headx = newHeadx;
        this.heady = newHeady;
        this.snake[newHeadx][newHeady] = 4;

        if(this.headx == this.applex && this.heady == this.appley){
            this.score += 1;
            //score += 1 - timer*0.5/maxTime;
            this.snakeSize++;
            this.actionType = 1;
        }
        else{
            var tailDir = this.snake[this.tailx][this.taily];
            this.snake[this.tailx][this.taily] = -1;
            this.tailx += dir[tailDir][0];
            this.taily += dir[tailDir][1];
        }
    }

    chanceAction(actionIndex){
        this.applex = Math.floor(actionIndex / boardy);
        this.appley = actionIndex % boardy;
        this.actionType = 0
    }

    validAgentAction(d){
        var newHeadx = this.headx + dir[d][0];
        var newHeady = this.heady + dir[d][1];
        if(newHeadx == -1 || newHeadx == boardx){
            return false;
        }
        if(newHeady == -1 || newHeady == boardy){
            return false;
        }
        return this.snake[newHeadx][newHeady] == -1;
    }

    randomChanceAction(){
        while(true){
            this.applex = randint(boardx)
            this.appley = randint(boardy)
            if(this.snake[this.applex][this.appley] == -1){
                break
            }
        }
        this.actionType = 0
    }
}

env = new Environment();

//Agent game:
actions = [27,0,0,3,0,0,0,3,3,70,2,2,2,2,1,2,1,1,2,2,1,1,88,0,0,0,3,0,1,0,0,0,1,0,59,0,3,3,3,33,3,2,2,3,2,2,2,2,9,3,3,0,3,0,0,0,0,0,0,2,2,2,2,2,3,2,2,2,2,67,0,0,1,1,0,0,0,1,0,0,1,1,17,0,3,3,3,2,3,3,4,3,2,2,2,28,1,0,0,1,1,0,3,3,0,95,0,1,2,0,1,1,1,1,2,2,2,70,2,2,2,2,2,3,63,3,0,0,0,65,0,0,74,1,2,13,1,0,3,3,3,2,2,3,3,3,3,2,68,2,3,0,1,0,1,2,1,1,0,1,0,76,1,2,2,94,1,1,2,2,97,2,2,2,2,3,0,1,0,3,3,3,0,1,0,1,2,1,0,11,3,3,2,3,2,2,3,3,2,3,2,2,99,3,0,1,3,0,0,0,1,1,1,1,1,1,1,1,41,2,2,2,2,2,2,2,2,3,3,3,0,3,22,3,3,0,61,1,1,1,1,2,24,0,0,3,3,3,3,3,0,27,0,0,0,30,3,2,2,2,2,2,2,2,1,68,1,1,1,0,0,0,0,0,0,0,0,3,3,2,43,1,1,2,2,2,2,3,3,3,3,18,0,3,2,2,3,0,0,0,0,0,0,3,58,3,0,1,1,62,3,3,1,1,2,3,3,2,2,2,31,3,2,1,2,3,0,3,6,2,3,3,0,0,0,0,0,80,0,0,0,1,1,2,1,0,1,1,1,2,2,2,2,2,2,2,2,35,0,3,2,0,0,3,3,0,0,0,3,37,0,0,75,1,2,2,2,2,0,1,0,30,3,0,0,1,1,3,3,2,3,3,3,62,0,1,1,1,29,0,3,0,0,3,0,3,0,0,0,1,32,1,2,3,1,1,1,2,1,2,2,1,0,1,2,2,2,3,2,3,0,0,1,63,1,0,13,3,3,3,3,3,69,2,2,2,0,0,0,0,0,1,1,1,1,1,47,2,3,2,3,36,0,2,2,75,1,1,1,1,2,97,1,0,0,0,3,0,54,3,3,3,0,2,70,2,1,1,1,1,2,2,3,26,0,1,3,3,0,0,0,3,0,24,3,2,2,1,21,1,2,2,3,1,2,3,3,38,1,1,0,0,0,1,1,2,77,1,1,2,1,1,79,0,3,1,97,1,3,1,30,2,3,0,2,2,2,1,1,2,3,3,2,1,1,0,0,0,3,2,3,2,1,66,3,0,1,1,1,0,16,2,0,3,3,3,5,2,3,59,0,1,0,3,1,1,1,57,2,3,3,3,0,1,1,0,3,3,2,3,3,2,2,2,2,3,0,3,3,3,31,1,1,1,22,3,94,3,3,0,1,1,2,1,1,1,0,3,2,0,2,3,3,0,0,0,2,2,2,1,0,3,1,1,1,1,1,2,2,2,2,67,3,0,0,0,0,3,2,72,1,2,92,1,0,58,2,0,2,0,0,3,2,2,3,3,0,1,1,0,1,1,0,0,0,34,2,1,25,0,3,15,3,13,2,2,5,2,2,2,38,0,1,1,1,0,24,3,3,3,2,3,0,3,1,2,3,2,1,0,2,2,2,0,0,3,2,1,0,0,0,1,2,3,20,1,2,1,11,0,0,2,1,2,15,1,3,1,96,1,1,0,0,3,2,1,1,1,1,2,2,77,2,0,0,0,3,93,1,1,72,3,3,81,3,1,90,0,50,42,3,53,65,56,57]
values = [3.16422,3.26208,3.36297,3.46698,3.57421,3.68475,3.79871,3.9162,4.03731,3.03731,3.13125,3.2281,3.32793,3.43086,3.53697,3.64636,3.75913,3.87539,3.99525,4.11882,4.2462,4.37753,3.37753,3.48199,3.58968,3.7007,3.81515,3.93315,4.05479,4.1802,4.30948,4.44277,4.58017,4.72183,3.72183,3.83693,3.9556,4.07794,4.20406,3.20406,3.30316,3.40532,3.51064,3.61921,3.73115,3.84654,3.96551,4.08815,3.08815,3.18366,3.28213,3.38363,3.48828,3.59617,3.70739,3.82205,3.94026,4.06212,3.15683,3.25446,3.35512,3.45888,3.56586,3.67614,3.78984,3.90705,4.02788,4.15246,4.28089,3.38236,3.48696,3.59481,3.70599,3.82061,3.93877,4.06059,4.18617,4.31564,4.44912,4.58672,4.72857,4.87482,3.87482,3.99466,4.1182,4.24557,4.37688,4.51225,4.6518,4.79567,3.79567,3.91306,4.03408,4.15885,4.28747,3.28747,3.38915,3.49397,3.71343,3.82828,3.94668,4.06874,4.19458,4.32431,4.45805,3.45805,3.565,3.67526,3.90611,4.15146,4.27986,4.41222,4.54868,4.8344,4.98391,5.13806,5.29696,4.29696,4.42986,4.56687,4.70811,4.85372,5.15859,5.31814,4.31814,4.45169,4.58937,4.73131,4.87764,3.87764,3.99757,4.1212,3.1212,3.21773,3.31725,2.31725,2.38892,2.53897,2.6175,2.69845,2.78191,2.86795,2.95664,3.04809,3.14236,3.23954,3.33974,3.44303,2.44303,2.51858,2.59648,2.84492,2.9329,3.02361,3.11713,3.31292,3.52101,3.62991,3.74217,3.85791,3.97723,2.97723,3.06931,3.16423,3.2621,2.2621,2.33206,2.40419,2.47854,2.5552,1.5552,1.6033,1.65288,1.704,1.81103,1.86705,1.92479,2.04569,2.10896,2.17418,2.24143,2.31075,2.38222,2.45589,2.53185,2.61015,2.94835,3.03954,3.13354,2.13354,2.19953,2.26755,2.40999,2.48452,2.64058,2.72225,2.80644,2.89324,2.98272,3.07497,3.17007,3.26811,2.26811,2.33826,2.56199,2.72292,2.89395,2.98345,3.07572,3.26892,3.37002,3.47424,3.58169,3.69247,3.80667,3.9244,4.04577,4.1709,3.26897,3.37007,3.4743,3.58175,3.69253,3.80673,3.92447,4.04584,4.29997,4.43296,4.57006,4.7114,4.85712,5.00734,4.00734,4.13127,4.25905,4.39077,3.39077,3.49564,3.60375,3.71521,3.83011,3.94857,3.03976,3.13377,3.23069,3.33061,3.43362,3.53981,3.64929,3.76216,3.87851,2.87851,2.96754,3.05932,3.15394,2.15394,2.22055,2.28923,2.36003,2.43302,2.50827,2.58585,2.66582,2.74827,2.92089,1.9803,2.04155,2.23689,2.37739,2.45092,2.52672,2.60487,2.68543,2.76849,2.85411,2.94238,3.1272,3.22392,3.32363,3.42642,2.42642,2.50146,2.65859,2.74081,2.82558,2.91297,3.00306,3.09594,3.19169,3.2904,3.39216,2.39216,2.46615,2.54242,2.62105,2.70212,2.78569,2.87184,2.96066,3.05223,3.14663,3.24395,3.34427,3.4477,2.4477,2.52341,2.85036,2.93852,3.12309,2.12309,2.18876,2.32624,2.39818,2.47235,2.54882,2.62765,2.96811,3.15454,3.25211,3.35269,2.35269,2.42545,2.50047,2.5778,2.65753,2.82445,2.91181,3.00186,2.00186,2.1276,2.1934,2.33118,2.40328,2.4776,2.55423,2.63323,2.71467,1.71467,1.7677,1.82237,1.93684,1.99674,2.12216,2.18779,2.25546,2.39713,2.47126,2.54769,2.70772,2.79146,2.8778,2.9668,3.05856,3.15315,3.25067,3.35121,3.56171,2.56171,2.64094,2.72261,2.89363,2.98312,3.07538,3.1705,3.26855,3.36964,3.47386,3.5813,3.69206,2.69206,2.77532,2.86115,1.86115,1.91872,2.03923,2.1023,2.16732,2.30346,2.3747,2.44814,2.52386,1.52386,1.61958,1.66967,1.7213,1.77454,1.886,2.26419,2.55756,3.16536,3.26326,3.36418,3.46823,2.46823,2.54457,2.62327,2.7044,2.87427,1.99199,2.0536,2.11711,2.18259,2.25009,2.31969,2.39143,2.46539,2.54164,2.62025,2.70129,2.78483,1.78483,1.84003,1.89694,2.07844,2.14273,2.20899,2.27731,2.34775,2.42036,2.49521,2.57239,2.65194,2.73396,2.81852,2.99556,3.0882,3.48834,3.59623,4.18782,4.31734,4.45087,4.58853,4.73044,4.08738,4.34411,4.47847,3.47847,3.58605,3.69696,3.8113,3.92917,4.05069,3.05069,3.14504,3.24231,3.89246,4.01285,4.13696,4.26491,4.39681,4.67298,4.81751,4.9665,5.12011,5.27846,5.44171,4.44171,4.57908,4.72071,4.86671,5.01722,4.01722,4.26955,4.4016,4.53773,3.53773,3.64715,3.75995,3.87623,3.99612,4.11971,3.11971,3.21619,3.31566,3.41821,3.52393,3.63292,4.23055,3.53966,3.64913,3.76199,3.87834,4.12195,4.24943,3.24943,3.34993,3.45353,3.56034,3.67046,3.90101,4.02166,4.27427,4.40646,3.40646,3.51181,3.96684,4.08952,4.216,4.3464,4.48082,4.76227,4.90956,5.0614,4.0614,4.18701,4.31651,4.45001,4.58763,3.58763,3.81298,3.93091,4.05248,4.17782,3.17782,3.2761,3.37742,3.58957,2.58957,2.75222,3.10883,3.51164,3.62025,3.84764,3.96664,4.08932,4.2158,3.2158,3.31525,3.41779,3.52349,3.63246,3.74481,2.74481,2.8297,3.00744,3.10045,2.16542,2.30143,2.44599,2.52164,1.5687,1.61722,1.66723,1.77195,1.82676,1.88325,1.9415,2.00155,2.06345,2.12727,2.19306,2.26089,2.33081,2.4029,2.79819,2.88473,2.97395,3.06592,3.16075,3.2585,3.35928,3.46317,3.9119,2.9119,3.00196,3.39092,3.60391,3.71537,3.94874,4.07087,3.16584,3.3647,3.46876,3.57604,3.68664,3.80066,2.80066,2.88728,2.97658,1.97658,2.10073,2.1657,2.23268,2.52197,2.59997,2.68038,2.76328,1.76328,1.81781,1.87403,1.93199,2.24981,1.28847,1.32832,1.3694,1.41175,1.45541,1.857,1.91444,1.97365,2.03469,2.09762,2.16249,2.22937,2.29832,2.3694,3.02319,3.31245,3.4149,3.52052,2.59847,2.67884,2.76169,2.8471,1.90423,1.96312,0.96312,0.992907,1.05527,1.12156,1.15624,1.19201,1.22887,1.30606,1.34645,1.43103,1.47529,1.52091,1.61644,1.71798,1.82589,1.88236,2.00059,2.06247,2.12625,2.25981,2.3297,2.40175,2.63156,2.71295,2.79685,3.15924,3.25695,3.35768,3.46152,3.56858,3.79273,3.91003,4.03096,4.15563,4.28416,3.28416,3.38573,3.49044,3.59839,3.70968,3.9427,4.06464,4.19035,3.19035,3.71517,3.83008,2.83008,2.9176,3.19677,2.26471,2.40696,2.55815,2.71883,2.80292,2.88961,2.97898,3.07111,3.26401,3.36496,3.46903,3.57632,3.68693,3.91851,4.0397,4.16464,4.42623,4.84975,4.99974,5.15437,4.55187,4.69265,5.30068,4.30068,4.43369,4.57081,3.57081,3.68125,2.68125,2.76418,2.84967,1.84967,1.90687,1.96585,2.43303,1.47735,1.52304,1.57015,1.61871,1.66877,1.72038,0.720383,0.742663,0.765631,1.10347,1.13759,1.17278,1.24644,1.40794,1.45149,1.49638,1.59037,1.63956,1.69026,1.79643,1.90927,1.96832,2.09196,2.15666,2.29212,2.36301,2.43609,2.75174,2.83684,3.01503,3.10828,4.34541,5.06025,5.21676,4.34717,4.62023,4.76312,5.38028,4.38028,4.51575,4.79939,4.94783,3.94783,4.32557,3.53445,3.75646,3.99241,4.11589,3.11589,3.21226,3.41402,3.51961,3.74069,3.85638,3.97565,5.90711,6.08981,6.27815,6.6725,6.87886,7.09161,6.09161,6.47424,6.67447,6.8809,7.31311,8.01284,7.68385,7.9215,8.41906,7.41906,7.64852,8.12894,7.12894,7.81105,8.05263,7.05263,7.96644,7.86908,7.30054,7.52633,6.93627,6.50426,5.85,5]
network_values = [3.66035,3.585,3.9772,3.95815,4.4094,4.36828,4.63774,4.63781,5.0492,2.85191,2.95177,3.26123,3.48308,3.68416,3.7305,4.07818,4.17457,4.05857,4.41241,4.46682,4.54104,4.70352,3.16054,3.34946,3.54302,3.68342,3.4966,3.61811,3.84712,4.0168,4.24472,4.56849,4.51274,4.98947,4.01661,3.96858,4.42444,4.22911,4.74782,3.4428,3.38775,3.78086,3.71935,3.78173,3.87939,4.42049,4.76962,4.90517,3.25135,3.19645,3.46092,3.43307,3.40407,3.55804,3.68689,4.10951,4.15859,4.23035,3.36941,3.25556,3.49457,3.44985,3.82794,3.69441,3.55941,3.37013,3.81983,4.32478,4.16309,3.29001,3.2971,3.0925,3.52429,3.44483,3.69935,3.55225,3.67395,4.01958,4.18306,4.1053,4.32156,4.40723,3.31997,3.30818,3.601,3.78882,3.77999,4.10929,4.44092,4.47112,3.9768,4.04056,4.00484,4.05964,4.28295,3.27922,3.42597,3.50936,3.95834,4.08332,4.16303,4.05999,4.58354,4.47261,4.49394,3.276,3.11652,3.16283,3.62216,3.46327,3.61291,3.50785,3.91949,3.76807,4.11237,4.0427,4.48054,3.70984,3.96526,3.89298,4.02366,4.28484,4.26524,4.60874,4.17214,3.84117,4.29509,4.1598,4.38976,3.88712,4.14532,4.48181,3.86846,3.24528,4.06053,2.93854,2.53743,2.79939,2.79835,2.86442,3.04636,3.19331,3.29497,3.61876,3.66438,3.92029,4.00349,4.09262,2.88879,2.70926,2.9279,3.22086,2.96594,3.32122,3.04544,2.72488,3.45586,3.45402,4.01247,4.08602,4.00161,3.25315,3.42661,4.24531,4.10368,3.34553,3.79076,3.66254,3.60619,3.70984,2.69868,2.69187,2.85803,2.46671,2.7803,2.49111,2.84063,3.06679,2.54896,2.51202,3.08041,2.9306,3.08711,3.08958,3.05306,3.26941,3.87437,3.62148,3.53903,2.34828,2.27079,2.59305,2.46721,2.75924,2.78794,3.02236,3.20649,3.42683,3.36919,3.65744,3.26277,3.85824,2.55444,2.54661,1.83963,2.24929,2.19361,2.54696,3.02972,2.64041,3.39682,3.02538,3.36749,3.18588,3.46888,3.45704,3.5383,3.84722,2.8531,2.77959,3.23669,3.22056,3.28828,3.5636,3.51986,3.75075,3.67947,3.78414,3.82304,4.18448,4.14163,4.35581,4.1089,4.19904,4.15412,4.45975,3.42166,3.5403,3.96275,3.7602,3.87395,3.65547,3.44905,3.18822,2.9979,3.42145,3.36596,3.5733,3.59864,3.94414,3.98038,3.15783,3.19752,3.55898,4.13846,1.99511,2.09996,2.15102,2.06866,1.86518,2.71798,2.26136,2.82852,2.00565,3.36188,2.84165,2.3455,2.46755,2.04653,2.49424,2.89109,3.09225,3.2495,3.09555,3.36433,3.39035,3.08109,4.01887,4.01248,3.99908,3.0468,2.95254,3.22584,3.19569,3.52899,3.40252,3.50287,3.35508,4.32797,4.11102,4.23755,2.85634,3.25549,2.99098,2.73329,2.43724,2.60753,2.5377,2.56557,2.84694,2.75843,3.35063,3.50722,3.5243,2.38598,2.14252,2.4193,1.84786,2.56418,1.85177,1.85207,2.12375,2.40874,2.05774,1.26025,1.88978,2.31716,3.01715,3.29004,3.302,2.70978,2.88949,2.59849,2.42375,2.47944,2.5888,3.2823,3.72947,2.08032,2.21976,2.54389,2.63546,2.83036,2.88936,3.22088,3.34397,3.46411,2.07917,2.25359,1.99515,1.79582,2.03265,2.03899,2.11467,2.29745,2.52058,2.49258,2.70584,2.91752,2.93724,3.14601,3.41762,3.53908,3.11124,3.6202,3.70889,3.58776,2.79693,2.9278,3.00753,3.2983,2.91864,3.34896,3.37841,3.20519,3.25083,3.03097,3.17838,3.67353,3.20323,3.35276,3.00857,1.47227,2.70355,2.23201,2.45242,2.30255,1.51692,2.27276,2.57611,2.90715,1.42856,2.10994,1.64415,1.91262,1.85929,1.42385,1.83623,2.31805,2.75815,2.98346,2.83568,3.69087,2.2814,2.39766,2.45778,2.38989,2.48967,2.15849,2.4197,2.00313,2.20467,2.62793,2.25303,2.34148,2.52346,2.01392,2.64407,2.79885,3.23011,2.00741,1.54803,1.81696,2.05178,1.26525,2.28677,2.24663,1.96672,1.73405,2.00331,1.25207,0.93056,1.89701,1.50022,1.6107,1.63838,2.24738,2.02414,2.62747,1.92748,2.22421,2.33913,2.62722,2.19669,2.9057,2.93871,2.45994,1.88687,2.22575,2.8351,3.08255,2.72352,1.69716,1.70402,1.0652,1.85945,2.18152,2.2599,2.68121,2.92774,3.03656,2.85929,3.57164,3.3032,3.44351,3.46606,2.82101,3.25801,3.06439,2.58733,3.24713,2.85764,3.01395,3.02984,3.08647,2.56994,2.05454,2.48638,2.3088,2.22668,2.30397,2.42025,1.74345,1.85158,1.29933,1.23577,-0.0167924,0.634652,1.07362,0.917589,2.1156,1.97885,2.71325,1.91624,2.24533,2.45371,2.09931,2.56675,2.13552,2.55853,2.44765,2.12435,2.9137,1.20992,1.20001,1.68709,2.59899,1.44164,2.66424,1.99235,2.31793,2.47963,2.36969,2.69998,1.7241,2.97036,2.67434,1.60547,1.46767,2.51134,3.08325,2.74279,3.14323,2.78607,2.71986,3.14881,2.61545,1.42924,1.34729,1.23859,2.74803,2.15313,2.87364,2.94573,2.87912,2.47631,2.89332,2.94066,1.77215,2.53991,2.88195,2.87301,2.85064,3.00745,2.48944,2.80772,0.9472,1.64821,1.95673,2.19956,1.81111,1.05926,0.960787,0.460108,1.47428,-0.0214202,1.40993,1.16328,1.25892,1.59208,1.93966,2.13988,2.31538,2.03277,1.86523,1.50728,1.85433,1.48385,1.82276,2.29537,2.28369,2.54945,2.31868,1.19085,1.06083,1.16092,1.48296,1.77222,1.95066,2.27236,2.19895,2.56315,1.85226,2.14218,2.24064,2.35355,1.44506,2.32678,1.38016,1.52574,1.42122,1.49449,1.37359,2.67717,1.90376,2.46655,1.78624,2.5055,1.33899,1.93565,2.19172,2.18138,1.45847,1.30039,1.42791,0.882275,1.34147,2.31409,1.17014,2.16646,0.503287,1.20005,1.84525,1.76952,2.38555,0.540434,1.43852,2.12271,2.53002,2.21844,2.06514,1.9327,2.82293,2.42822,2.28747,2.76562,1.48271,1.26934,1.89419,1.82406,1.64196,1.95952,1.78595,0.800495,1.79122,1.86938,1.65784,1.64771,1.47251,1.22222,1.41983,0.825438,1.56918,2.10335,1.67305,2.47379,2.06375,1.51171,1.2741,0.734651,1.00791,0.728116,0.684354,2.33462,1.92919,1.97406,1.45691,2.1584,2.77619,2.60173,3.30565,2.98078,1.3328,1.83841,1.88094,2.00693,2.92432,0.918183,1.859,1.94285,3.18866,3.20542,2.7804,1.80523,3.13232,1.36101,1.89291,2.02615,1.817,1.51047,2.03442,1.48416,2.01832,1.55855,1.53548,1.35072,1.69243,2.37713,2.41911,0.907117,1.95928,1.47722,2.00871,1.92949,1.94729,1.79314,2.22341,2.46418,2.37298,1.43468,2.21016,1.97356,2.6665,2.19525,2.19194,1.64395,1.51304,0.938575,1.22576,1.69987,2.54836,2.41998,2.84726,2.47422,1.72806,2.5327,2.11223,1.9543,0.914345,1.919,1.24747,1.648,1.71328,1.49547,1.39118,1.94437,1.5922,1.98874,1.74875,1.06646,1.53817,2.80465,2.8723,2.61833,1.68602,1.97609,1.15738,2.03696,2.57001,2.63432,0.718619,2.35817,2.76556,3.28697,1.97335,2.48997,2.46593,2.63204,3.08209,3.17087,2.96215,3.75902,1.91722,3.3069,3.10239,2.25296,2.87749,1.90086,1.25856,2.01914,0.722763,1.90581,2.52141,1.68842,1.64265,2.60503,3.10397,2.97322,2.2589,3.09874,2.27918,2.4986,3.19478,2.24724,2.35209,2.17344,2.58618,2.79545,2.5699,2.60353,2.78827,3.02499,3.10145,2.78342,3.79679,4.21306,1.76537,3.62864,2.92997,2.7694,3.84823,2.60334,2.81492,2.94327,2.80968]
search_values = [3.34953,3.46512,3.57724,3.66952,3.87562,4.03064,4.17528,4.37419,4.5884,2.76255,2.93158,3.06752,3.16841,3.24835,3.35077,3.45563,3.60992,3.76505,3.95744,4.08724,4.21622,4.38225,2.97461,3.05071,3.19741,3.33143,3.24782,3.41689,3.50046,3.66791,3.83412,4.02487,4.1596,4.36767,3.84004,4.01533,4.17857,4.32604,4.49281,3.19437,3.22407,3.33059,3.53984,3.67393,3.88015,4.10363,4.29191,4.48948,2.82102,2.95933,2.98259,3.28456,3.55789,3.71892,3.86285,3.99944,4.13288,4.27342,2.60485,2.69684,2.8023,3.10839,3.35197,3.55034,3.73805,3.86395,3.99717,4.13419,4.27298,2.82669,2.85784,2.9347,2.98492,3.05488,3.16885,3.2473,3.38696,3.60731,3.78459,3.9116,4.1334,4.33853,2.94595,3.22601,3.44812,3.64696,3.79118,3.89007,4.02105,4.21735,3.58297,3.7877,3.92339,4.07365,4.22359,2.82561,2.81012,2.95606,3.22463,3.3663,3.52225,3.67169,3.8106,3.91251,4.07483,2.70128,2.72343,2.80059,2.94937,3.19965,3.37862,3.5242,3.67323,3.90873,4.04712,4.18508,4.33649,3.27989,3.47094,3.63198,3.78056,3.91835,4.14878,4.3078,3.55409,3.71856,3.88194,4.05528,4.23783,3.74528,3.95338,4.16126,3.50253,3.66248,3.85033,2.13604,2.24755,2.42774,2.56904,2.67772,2.80623,2.95108,3.13159,3.31694,3.50748,3.65486,3.78967,3.97908,2.37863,2.35579,2.44399,2.67776,2.74731,2.76069,2.8329,2.9948,3.24244,3.41505,3.57655,3.65915,3.84352,3.31559,3.50619,3.65985,3.80623,3.05342,3.30183,3.46404,3.59016,3.7364,1.9677,2.00729,2.05977,2.07278,2.13802,2.12165,2.10726,2.18737,2.24639,2.28849,2.33766,2.3874,2.53167,2.73795,2.84272,3.01839,3.41843,3.56659,3.70585,1.89508,2.03993,2.17211,2.36369,2.44561,2.62176,2.75332,2.91091,3.06379,3.22973,3.30543,3.46219,3.65319,1.84638,1.77968,1.94445,1.98366,2.25803,2.58233,2.78745,3.03043,3.15895,3.28151,3.40304,3.52529,3.649,3.77195,3.90193,4.03068,2.53508,2.53519,2.59771,2.7211,2.92922,3.09588,3.23636,3.35987,3.58946,3.71539,3.84591,3.97941,4.04513,4.22214,3.59604,3.83269,3.98652,4.16795,2.83216,3.06577,3.19986,3.23475,3.32448,3.46004,2.47632,2.68554,2.86575,3.0388,3.15701,3.27107,3.38552,3.50985,3.65123,2.98612,3.19784,3.37716,3.55566,1.80103,1.90043,2.29221,2.44161,2.52523,2.62065,2.72567,2.81399,2.89459,3.09813,1.92069,2.03611,2.2897,2.40353,2.52528,2.72831,2.89944,3.03733,3.16754,3.29728,3.42126,3.62077,3.75282,3.8626,4.02048,2.60925,2.57751,2.6463,2.70909,2.85333,3.02256,3.12369,3.30664,3.45971,3.62048,3.79358,2.28445,2.29375,2.31153,2.1707,2.09152,2.16773,2.28958,2.43345,2.5651,2.69815,2.79562,2.90326,3.06974,2.15966,2.21006,2.52906,2.63097,2.82705,1.55521,1.67492,1.848,2.03735,2.16356,2.2895,2.41562,2.73959,2.92276,3.04888,3.20138,2.32004,2.52833,2.66765,2.5558,2.70568,2.87493,2.95458,3.07924,1.88791,2.21247,2.3222,2.52158,2.62682,2.74033,2.85099,2.96474,3.07593,1.35769,1.43046,1.50668,1.61596,1.70608,1.99758,1.81407,1.99421,2.33012,2.52572,2.67642,2.88397,2.99866,3.10775,3.21689,3.3316,3.44568,3.5726,3.70046,3.94779,2.53636,2.48824,2.47707,2.4915,2.44527,2.48654,2.70249,2.91016,3.05437,3.18762,3.27592,3.43818,2.76794,2.91999,3.09662,1.71982,1.90955,2.0587,2.16155,2.27355,2.44999,2.54183,2.58778,2.74206,1.07379,1.22007,1.27698,1.49515,1.60775,1.74356,2.10053,2.3743,2.94463,3.04935,3.15611,3.28105,2.53514,2.65252,2.78677,2.87534,3.07901,1.75347,1.73609,1.74939,1.768,1.83756,1.98447,2.14621,2.28156,2.36411,2.5528,2.69116,2.78968,1.28565,1.26467,1.25765,1.34476,1.32739,1.34294,1.35104,1.24105,1.13669,1.03734,1.03126,1.12631,1.17968,1.33844,1.50777,1.62308,1.85622,1.95832,2.30277,2.40303,2.46026,2.58814,2.70831,2.46948,2.65166,2.77045,1.82366,1.966,2.0289,2.15479,2.2947,2.3954,1.3913,1.51206,1.68705,2.22132,2.42813,2.56188,2.67648,2.77426,2.95031,3.05923,3.16572,3.27762,3.3923,3.52048,2.80984,2.90114,3.02675,2.98194,3.14311,2.66211,2.62441,2.69713,2.82024,1.82713,2.01521,2.10163,2.17494,2.2483,2.38891,1.35106,1.80286,2.02496,2.15402,2.29313,2.42245,2.8285,2.11958,2.26419,2.36605,2.45225,2.63648,2.75837,1.80329,2.0488,2.22773,2.3372,2.45248,2.61252,2.72015,2.91216,3.03402,1.37917,1.44038,1.91666,2.13567,2.26903,2.39388,2.48509,2.66438,2.77278,2.88913,2.12087,2.29141,2.39593,2.50197,2.63618,2.25732,2.41064,2.48191,2.55931,2.70621,2.31293,2.35306,2.29205,2.47007,1.61958,1.81512,2.09219,2.39249,2.48977,2.67262,2.77608,2.82627,2.94952,2.01059,2.21013,2.38065,2.44738,2.5575,2.71679,2.14702,2.22447,2.15417,2.23348,2.12406,2.04283,2.12508,2.21595,0.911026,0.937286,0.915622,0.980672,1.01362,1.04603,1.02371,1.06169,0.986522,0.995228,0.962187,0.968081,1.20117,1.39488,1.60571,1.75762,1.85258,2.00674,2.13202,2.22683,2.28918,2.39143,2.72776,1.72027,1.88536,2.19132,2.36032,2.49253,2.66933,2.76131,1.93045,2.14324,2.24194,2.34876,2.49976,2.64379,2.08471,2.32433,2.46049,1.28617,1.41544,1.55011,1.64571,1.90874,2.01392,2.11118,2.20867,1.81886,1.96706,2.10711,2.18743,2.55756,0.879795,0.784515,0.790359,0.904626,0.988551,1.21447,1.17787,1.18796,1.24105,1.40175,1.52973,1.6329,1.7108,1.80035,2.27844,2.48019,2.56239,2.6516,2.23981,2.40743,2.49084,2.58591,2.49069,2.60928,0.670024,0.648132,0.702116,0.640359,0.528263,0.444228,0.462221,0.450871,0.45479,0.501233,0.571828,0.644036,0.733735,0.707619,0.731808,0.678459,0.649926,0.652456,0.739045,0.852783,1.02198,1.19773,1.4506,1.67877,1.82832,2.11173,2.20806,2.30215,2.39926,2.49278,2.66419,2.76485,2.86496,2.97315,3.0798,1.7135,2.03393,2.24678,2.39531,2.55479,2.75556,2.88665,3.01002,2.45289,2.83924,3.0093,2.33091,2.43751,2.72644,0.810542,0.840456,0.890328,0.929768,0.916937,0.956535,0.947445,0.947992,1.00538,1.02088,1.06674,1.27836,1.70781,1.97159,2.13109,2.2451,2.42391,2.67758,2.78149,2.87533,2.50192,2.51912,2.77064,2.52776,2.87366,2.97237,2.68189,2.81913,2.2271,2.59603,2.77111,2.36448,2.54546,2.62628,3.26701,1.89328,1.9933,2.03991,2.14582,2.33481,2.41432,0.489475,0.519308,0.563699,0.797461,0.823779,0.830488,0.866246,0.96454,0.921748,0.837381,0.807467,0.734484,0.753145,0.848252,0.889616,0.905094,0.924844,0.937314,0.909625,0.85945,1.01228,1.26807,1.38095,1.52385,1.6175,2.28434,2.67291,2.80564,2.42724,2.6027,2.652,3.01356,2.63941,2.79186,3.10212,3.24318,3.06388,3.40576,3.02057,3.08205,3.35595,3.48951,0.988583,1.00426,1.34009,1.64996,1.90154,2.03946,2.16893,3.27778,3.41086,3.54495,3.80904,3.96227,4.09183,2.93415,3.31764,3.54305,3.72089,4.01712,4.41302,3.86159,4.15719,4.44092,3.76874,4.05625,4.33463,4.1735,4.87148,5.03807,4.64284,5.28536,4.67635,7.1781,7.42295,6.93361,6.33337,5.65622,5]

function updateEnvironment(index){
    env = new Environment()
    for(i=0; i<index; i++){
        if(i == 0 || env.actionType == 1){
            env.chanceAction(actions[i])
        }
        else{
            env.agentAction(actions[i])
        }
        while(env.actionType == 0){
            // Check if there is only one valid action
            numValidActions = 0
            validAction = -1
            for(d = 0; d < 4; d++){
                if(env.validAgentAction(d)){
                    numValidActions++
                    validAction = d
                }
            }
            if(numValidActions == 1){
                env.agentAction(validAction)
            }
            else{
                break
            }
        }
    }
}


updateEnvironment(1)
currAction = actions[1]
currActionIndex = 2

/*
updateEnvironment(203)
currAction = actions[203]
currActionIndex = 204
*/
tick = 0


/*
//Manual game:
currAction = 0
tick = -1
env.randomChanceAction()
*/

console.log(env)


function fillRect(color,sx,sy,l,w){
    ctx.fillStyle = color;
    ctx.fillRect(sx,sy,l,w);
}

function drawLine(color,p1x,p1y,p2x,p2y, width){
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(p1x,p1y);
    ctx.lineTo(p2x,p2y);
    ctx.stroke();
}

function fillCirc(color,x,y,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,2*pi);
    ctx.fillStyle = color;
    ctx.fill();
}

function fillText(text,color,size,x,y){
    ctx.font = String(size)+"px Arial";
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.fillText(text,x,y);
}

document.addEventListener("keydown",keyHandler);
document.addEventListener("click",clickHandler);

keyMove = ["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"]

paused = true

function keyHandler(event){
    key = event.code
    event.preventDefault()
    /*
    for(i=0; i<4; i++){
        if(keyMove[i] == key){
            if(env.timer != TIME_LIMIT && env.validAgentAction(i)){
                currAction = i
                tick = 0
            }
        }
    }
    */
    if(key == "Space"){
        paused = !paused
        if(paused){
            tick = 0
        }
    }
    if(key == "ArrowRight"){
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowLeft"){
        while(true){
            currActionIndex--
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowDown"){
        currActionIndex = 2
        currAction = actions[currActionIndex-1]
        updateEnvironment(currActionIndex-1)
    }
    if(key == "ArrowUp"){
        currActionIndex = actions.length - 15
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
}

function clickHandler(event){
    rect = canvas.getBoundingClientRect();
    x = event.clientX - rect.left;
    y = event.clientY - rect.top;
}

function draw(){
    fillRect(space, 0, 0, windx, windy)
    fillRect(cLine, marginx - border, marginy - border, boardx*cellS + 2*border, boardy*cellS + 2*border)
    fillRect(space, marginx, marginy, boardx*cellS, boardy*cellS)
    for(var i = 0; i < boardx; i++){
        for(var j = 0; j < boardy; j++){
            if((i + j) % 2 == 0){
                fillRect(cShade, marginx + j * cellS, marginy + i * cellS, cellS, cellS)
            }
        }
    }
    fillCirc(cApple, marginx + env.appley*cellS + cellS/2, marginy + env.applex*cellS + cellS/2, appleSize/2)
    for(i = 0; i < boardx; i++){
        for(j = 0; j < boardy; j++){
            type = env.snake[i][j]
            if(type != -1){
                centerx = marginx + j*cellS + cellS/2
                centery = marginy + i*cellS + cellS/2
                slideProp = tick / framesPerMove
                if(i == env.tailx && j == env.taily && (env.headx + dir[currAction][0] != env.applex || env.heady + dir[currAction][1] != env.appley)){
                    nextx = centerx + dir[type][1] * cellS * slideProp
                    nexty = centery + dir[type][0] * cellS * slideProp
                    fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    drawLine(cSnake, nextx, nexty, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                }
                else{
                    fillCirc(cSnake, centerx, centery, snakeWidth / 2)
                    if(type == 4){
                        nextDir = dir[currAction]
                        nextx = centerx + nextDir[1] * cellS * (tick / framesPerMove)
                        nexty = centery + nextDir[0] * cellS * (tick / framesPerMove)
                        drawLine(cSnake, centerx, centery, nextx, nexty, snakeWidth)
                        fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    }
                    else{
                        drawLine(cSnake, centerx, centery, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                    }
                }
            }
        }
    }
    fillText("Score: " + env.score.toString(), cText, textSize, windx/2, marginy/2)
    fillText("Timer: " + env.timer.toString(), cText, textSize, windx/2, marginy/2 + textSize * 1.5)


    fillText("Value", cValue, textSize, marginx/3, textSize)
    fillText(values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize)
    fillText("Search Value", cSearch, textSize, marginx/3, textSize*2)
    fillText(search_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*2)
    fillText("Network Value", cNetwork, textSize, marginx/3, textSize*3)
    fillText(network_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*3)

    drawLine(cValue, marginx/4, windy/2, marginx/4, windy/2 - values[currActionIndex-2] * 25, marginx/4)

    drawLine(cSearch, marginx*2/4, windy/2, marginx*2/4, windy/2 - search_values[currActionIndex-2] * 25, marginx/4)

    drawLine(cNetwork, marginx*3/4, windy/2, marginx*3/4, windy/2 - network_values[currActionIndex-2] * 25, marginx/4)

    //fillText("Reward", cText, textSize, marginx/4, 100)
    //fillText(values[currActionIndex-1].toString(), cText, textSize, marginx/4, 120)
    //drawLine(cText, marginx/4, windy/2, marginx/4, windy/2 + rewards[currActionIndex-1] * 100, 3)
}

endState = false

function update(){
    if(endState) return
    draw()
    if(!paused){
        tick++
    }
    if(tick >= framesPerMove){
        tick = 0

        env.agentAction(currAction)
        if(env.actionType == 1){
            env.chanceAction(actions[currActionIndex])
            currActionIndex++
        }
        if(env.timer == TIME_LIMIT){
            endState = true
            return
        }

        // Check if there is only one valid action
        numValidActions = 0
        validAction = -1
        for(i = 0; i < 4; i++){
            if(env.validAgentAction(i)){
                numValidActions++
                validAction = i
            }
        }
        if(numValidActions == 0){
            endState = true
            return
        }
        if(numValidActions == 1){
            currAction = validAction
        }
        else{
            currAction = actions[currActionIndex]
            currActionIndex++
        }
    }
}

function updateManual(){
    draw()
    if(tick == -1){
        
    }
    else if(tick < framesPerMove){
        tick++
    }
    else{
        env.agentAction(currAction)
        tick = -1
        if(env.actionType == 1){
            env.randomChanceAction()
        }
    }
}

var ONE_FRAME_TIME = 1000 / 60 ;
var mainloop = function() {
    update()
    //updateManual()
};
setInterval( mainloop, ONE_FRAME_TIME );

</script>

</body>

</html>
