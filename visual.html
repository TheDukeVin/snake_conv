
<!DOCTYPE html>
<html>


<head>
<title> Visualizing snake </title>
</head>


<body>

<div class="panel">
<canvas id="canvas" width="1000" height="600" style="position:relative; top:50px; left:50px"></canvas>
</div>

<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
 
boardx = 10;
boardy = 10;
cellS = 40;
windx = 1000;
windy = 600;
marginx = (windx - boardx * cellS) / 2
marginy = (windy - boardy * cellS) / 2
border = 5
snakeWidth = 20
appleSize = 20
textSize = 20

framesPerMove = 7

dir = [[0,1], [1,0], [0,-1], [-1,0]];

pi = Math.PI;

space = "#fff"
cLine = "#000"
cShade = "#eee"
cSnake = "#00f"
cApple = "#f00"
cText = "#000"

cValue = "#d00"
cSearch = "#bb0"
cNetwork = "#0d0"

TIME_LIMIT = 1200

function randint(max){
    return Math.floor(Math.random()*max)
}

class Environment{
    constructor(){
        this.timer = 0
        this.score = 0;
        this.actionType = 0;
        this.snakeSize = 2;
        this.headx = boardx/2;
        this.heady = 2;
        this.tailx = this.headx;
        this.taily = 1;

        this.snake = []
        for(var i=0; i<boardx; i++){
            this.snake[i] = []
            for(var j=0; j<boardy; j++){
                this.snake[i][j] = -1;
            }
        }
        this.snake[this.headx][this.heady] = 4;
        this.snake[this.tailx][this.taily] = 0;
        this.applex = 0;
        this.appley = 0;
    }

    agentAction(actionIndex){
        this.timer ++
        var newHeadx = this.headx + dir[actionIndex][0];
        var newHeady = this.heady + dir[actionIndex][1];
        this.snake[this.headx][this.heady] = actionIndex;
        this.headx = newHeadx;
        this.heady = newHeady;
        this.snake[newHeadx][newHeady] = 4;

        if(this.headx == this.applex && this.heady == this.appley){
            this.score += 1;
            //score += 1 - timer*0.5/maxTime;
            this.snakeSize++;
            this.actionType = 1;
        }
        else{
            var tailDir = this.snake[this.tailx][this.taily];
            this.snake[this.tailx][this.taily] = -1;
            this.tailx += dir[tailDir][0];
            this.taily += dir[tailDir][1];
        }
    }

    chanceAction(actionIndex){
        this.applex = Math.floor(actionIndex / boardy);
        this.appley = actionIndex % boardy;
        this.actionType = 0
    }

    validAgentAction(d){
        var newHeadx = this.headx + dir[d][0];
        var newHeady = this.heady + dir[d][1];
        if(newHeadx == -1 || newHeadx == boardx){
            return false;
        }
        if(newHeady == -1 || newHeady == boardy){
            return false;
        }
        return this.snake[newHeadx][newHeady] == -1;
    }

    randomChanceAction(){
        while(true){
            this.applex = randint(boardx)
            this.appley = randint(boardy)
            if(this.snake[this.applex][this.appley] == -1){
                break
            }
        }
        this.actionType = 0
    }
}

env = new Environment();

//Agent game:
actions = [82,1,1,1,4,2,1,2,3,3,3,0,3,3,3,3,0,0,3,0,75,1,0,1,1,1,1,1,1,76,0,81,1,2,2,1,2,2,2,3,23,2,3,3,3,0,3,0,3,0,3,27,0,0,0,0,74,1,1,2,1,2,1,2,1,12,2,3,2,3,3,3,3,3,69,0,1,1,0,0,1,0,0,1,0,0,1,51,2,2,2,3,2,2,2,2,50,2,91,1,1,1,1,35,3,0,0,3,3,0,3,0,3,3,95,0,1,1,1,2,1,1,22,2,3,3,3,3,3,2,3,3,89,0,1,1,1,1,1,1,1,0,0,0,0,82,2,2,2,3,3,2,2,1,1,2,2,1,1,75,0,0,3,0,50,1,2,2,3,3,0,3,2,21,0,3,2,0,79,0,0,0,1,0,1,1,0,1,0,0,0,1,5,2,1,0,2,2,2,3,2,2,2,2,3,3,3,3,3,3,3,3,0,0,0,0,72,1,1,1,1,2,1,2,2,1,1,48,0,3,0,3,0,3,0,16,3,2,2,3,3,6,3,59,0,0,2,2,94,1,1,1,1,2,2,2,2,84,3,4,2,3,3,3,3,3,3,3,3,0,15,1,0,55,1,2,1,1,0,70,3,3,1,1,0,1,0,0,1,1,1,2,2,2,2,2,2,2,2,3,17,3,3,3,3,3,3,3,0,0,0,0,0,0,1,38,0,3,2,1,35,2,2,2,23,2,3,2,43,1,1,27,0,1,0,0,1,2,2,2,3,2,3,0,3,3,2,1,1,3,0,0,0,0,0,0,2,2,1,90,0,0,1,2,1,0,1,1,1,2,2,2,2,2,2,2,2,14,0,3,2,3,3,3,3,3,3,0,0,0,1,75,2,2,2,1,1,1,1,0,1,0,0,19,0,3,3,2,3,0,3,3,3,3,0,0,0,69,1,1,1,1,1,99,1,1,1,5,3,2,1,2,2,2,2,2,2,3,3,3,3,0,0,0,0,61,2,2,2,2,1,1,1,1,71,1,56,0,1,0,0,0,0,3,3,24,3,2,2,3,3,18,0,0,3,3,0,0,2,62,1,0,1,1,1,1,1,1,3,3,3,3,3,2,1,2,3,0,0,2,3,2,2,3,3,3,3,0,76,1,2,0,0,3,0,1,1,2,2,2,1,1,1,2,2,0,0,99,2,3,0,0,1,1,1,1,0,0,89,74,2,0,2,0,3,3,3,3,1,2,3,2,2,2,2,0,0,1,2,1,0,0,0,1,0,1,42,2,1,3,1,3,0,3,3,3,2,2,2,45,3,0,0,0,1,67,1,1,0,79,0,1,0,48,3,3,2,95,1,3,2,3,0,0,1,1,1,2,3,2,1,0,2,2,1,0,2,1,1,1,1,0,0,0,0,89,0,0,0,0,54,3,1,3,3,3,2,56,3,0,3,0,66,67,0,0,3,3,1,3,2,2,2,33,1,0,3,62,1,1,1,2,32,3,3,3,34,1,2,1,0,2,0,1,2,0,3,2,3,3,0,3,2,65,2,84,1,2,67,0,3,2,3,16,3,3,3,3,2,99,1,1,1,1,1,1,1,1,89,39,7,25,1,1,2,3,3,2,21,2,2,1,0,30,3,0,2,2,2,42,0,0,51,1,1,2,3,60,70,90,0,2,43,0,2,0,2,3,33,3,44,1,55,1,45,35,36]
values = [3.89188,4.01224,4.13633,4.26426,3.26426,3.36522,3.4693,3.68721,3.80125,3.91881,4.04001,4.16496,4.29378,4.42657,4.56348,4.70462,4.85012,5.00012,5.15477,5.31419,4.31419,4.44762,4.58518,4.72699,4.87318,5.0239,5.17928,5.33946,5.5046,4.5046,4.64392,3.64392,3.75661,3.8728,3.99257,4.11606,4.24336,4.37459,4.50989,4.64937,3.64937,3.76224,3.8786,3.99855,4.12222,4.24971,4.38115,4.51665,4.65634,4.80035,4.94881,3.94881,4.07094,4.19684,4.32664,4.46046,3.46046,3.56748,3.67782,3.79156,3.90883,4.02972,4.15435,4.28284,4.41529,3.41529,3.52092,3.62982,3.74208,3.85781,3.97713,4.10013,4.22694,4.35767,3.35767,3.46151,3.56857,3.67894,3.79272,3.91002,4.03095,4.15562,4.28414,4.41664,4.55324,4.69406,4.83924,3.83924,3.95798,4.08039,4.20659,4.47081,4.60909,4.75163,4.89859,5.0501,4.0501,4.17536,3.17536,3.27356,3.37481,3.47918,3.69772,2.69772,2.78115,2.86717,2.95584,3.04726,3.14151,3.23867,3.33883,3.44209,3.54855,3.6583,2.6583,2.74051,2.82527,2.91265,3.00273,3.19134,3.29004,3.3918,2.3918,2.46577,2.54203,2.7017,2.78526,2.8714,2.96021,3.05176,3.14615,3.24345,2.24345,2.31283,2.45811,2.53413,2.61251,2.77661,2.86248,2.95101,3.04228,3.13637,3.23337,3.33337,3.54275,2.54275,2.62139,2.70246,2.87221,2.96104,3.05262,3.24436,3.3447,3.44815,3.55479,3.66474,3.77808,3.89493,4.01539,3.01539,3.10865,3.20479,3.30391,3.40609,2.40609,2.55722,2.88856,3.07,3.16495,3.26283,3.36374,3.46778,3.57503,2.65467,2.73677,2.82141,2.99863,3.09137,2.09137,2.15605,2.22274,2.29148,2.36235,2.43541,2.51074,2.58839,2.66844,2.75097,2.83605,2.92376,3.01419,3.10741,2.10741,2.17259,2.23978,2.52999,2.60824,2.68891,2.77207,2.8578,2.94619,3.03731,3.13124,3.22809,3.32792,3.43085,3.53696,3.64635,3.75912,3.87538,3.99524,4.24619,4.37752,4.5129,4.65248,4.79637,3.79637,3.91378,4.03483,4.15962,4.28826,4.42089,4.55762,4.69858,4.84389,4.9937,5.14815,4.14815,4.27644,4.54505,4.68562,4.97994,5.13396,5.29274,5.45643,4.45643,4.59426,4.73635,4.88283,5.03385,5.18954,4.18954,4.31911,3.42176,3.52759,3.74917,3.86512,4.78366,3.78366,3.90069,4.02133,4.1457,4.4061,4.54237,4.68285,4.82768,4.97699,3.97699,4.09999,3.09999,3.19587,3.29471,3.39661,3.50166,3.60996,3.72161,3.83671,3.95537,4.0777,4.20381,3.20381,3.3029,3.40505,2.40505,2.47943,2.63517,2.71667,2.80069,2.88731,1.88731,1.94568,2.0679,2.13185,2.19779,2.26576,2.33583,2.40808,2.48255,2.55933,2.63849,2.80422,2.89094,2.98036,3.07253,3.16756,3.26552,3.36652,3.47064,3.68864,3.80272,2.80272,2.8894,2.97876,3.07089,3.16587,3.26378,3.36472,3.57607,3.68667,3.80069,3.91823,4.03942,4.16435,4.29314,4.42592,3.42592,3.53187,3.9895,4.11289,4.24009,3.24009,3.3403,3.44361,3.55011,2.55011,2.62898,2.71029,2.79411,1.79411,1.8496,1.9068,0.906802,0.934847,0.96376,0.993567,1.0243,1.05598,1.08863,1.1223,1.15701,1.22969,1.26772,1.30693,1.38902,1.43198,1.47627,1.52192,1.56899,1.66755,2.00192,2.06384,2.12767,2.19347,2.26131,2.33125,2.47768,2.55431,2.63331,2.71475,1.71475,1.76778,1.87882,1.93693,1.99684,2.05859,2.1879,2.25557,2.32533,2.47138,2.54782,2.62662,2.70785,2.7916,2.87794,2.96695,3.05871,3.15331,2.2199,2.28856,2.35934,2.50754,2.58509,2.66504,2.74747,2.83244,2.92004,3.10345,3.19944,3.29839,3.4004,3.50557,2.50557,2.58306,2.66295,2.83021,2.91775,3.00799,3.10102,3.2958,3.39773,3.50281,3.61115,3.72283,2.72283,2.80704,2.89386,2.98336,3.07563,3.17075,3.26882,3.36991,3.47414,3.58159,3.69236,3.80655,3.92428,4.17078,3.17078,3.26884,3.36994,3.47416,3.58161,3.69238,2.69238,2.77565,2.8615,2.95,2.01031,2.07248,2.13658,2.27078,2.34101,2.41341,2.48806,2.56501,2.64434,2.81043,2.89735,3.37398,3.47833,3.69681,3.81115,3.92902,4.05054,4.17581,3.27403,3.37529,3.47968,3.5873,3.81263,3.93054,4.05211,4.17743,4.30663,3.30663,3.40889,2.40889,2.4834,2.5602,2.63938,2.72101,2.80517,2.98137,3.07357,3.16863,2.16863,2.2357,2.30485,2.37613,2.44962,2.52538,1.52538,1.57256,1.6212,1.67134,1.77632,1.83126,1.94628,2.00647,1.00647,1.0376,1.10278,1.13688,1.17204,1.20829,1.24566,1.28419,1.36485,1.40706,1.45058,1.49544,1.5417,1.58938,1.63853,2.29069,2.43457,2.58749,2.66752,2.75002,1.75002,1.80414,1.85994,1.97677,2.0379,2.10093,2.16591,2.30196,2.37315,1.37315,1.41562,1.50454,1.55107,1.59904,1.6485,1.69948,1.75204,1.80623,1.86209,1.91968,2.16841,2.23548,2.30462,2.37589,2.44937,2.85231,2.94052,3.12522,2.12522,2.19095,2.25871,2.40059,2.47483,2.55138,2.63028,2.71163,2.7955,2.88196,2.97109,2.03205,1.03205,1.09688,1.16577,1.239,1.31682,1.35755,1.39954,1.44282,1.53345,1.58087,1.62977,1.73214,1.78571,1.95657,2.01708,2.14378,2.21008,2.27843,2.3489,2.73531,2.8199,2.90712,3.08972,3.18528,3.28379,3.38535,3.49005,2.72831,2.89968,3.08181,3.27539,3.48112,3.69978,3.81421,3.93217,4.05379,4.17916,4.44166,4.57903,4.72065,3.72065,3.83572,3.95436,4.07666,4.20274,4.33272,3.43579,3.54205,3.6516,3.76454,2.76454,2.85004,2.93819,3.02906,2.02906,2.15651,2.2232,2.29196,1.29196,1.45936,1.5045,1.55103,1.599,1.64845,1.69943,1.75199,2.30455,2.37583,2.44931,2.60315,2.68366,2.76666,2.94044,3.12514,3.22179,3.32144,3.53006,3.75179,3.86783,3.98745,4.11077,4.36898,4.5041,4.64341,4.78702,4.93507,3.93507,4.05677,4.18224,4.31159,4.58241,3.80743,4.04658,4.30075,4.43377,4.57089,4.71226,4.858,3.858,3.97732,4.10033,4.22715,4.63161,3.74393,2.82879,1.88535,1.94366,2.55667,3.91625,4.16224,4.5605,4.70154,4.84695,4.99686,4.24791,4.37929,4.51473,5.0997,4.0997,4.2265,4.35721,4.49197,4.6309,3.6309,3.7432,3.85896,3.97831,3.07043,3.16539,3.26329,3.36421,3.57553,3.80011,3.91764,4.03881,4.56211,4.70321,4.84867,5.47691,5.6463,5.82093,6.00096,6.18655,6.57514,6.49228,6.69308,5.86915,6.05067,6.2378,5.73897,5.91647,6.09945,6.68306,6.88975,5.88975,6.07191,6.2597,6.4533,6.65289,7.07077,6.45209,6.65164,6.85736,7.06944,7.28808,7.51349,7.74587,7.98543,8.48701,7.71857,7.8238,7.94635,7.38267,7.611,7.84639,7.05814,7.27643,7.73348,7.97266,6.97266,7.18831,7.63982,7.8761,8.11969,7.11969,7.5669,8.04219,8.54734,8.81169,9.08421,8.33424,8.592,8.85773,7.85773,8.10076,8.3513,8.60958,8.87586,8.37056,7.59851,6.59851,7.01298,7.45348,6.85884,7.28966,7.98715,8.48884,9.02205,9.30108,8.30108,8.55781,7.79156,8.03254,7.03254,7.47426,6.6745,5.85,5]
network_values = [3.80328,4.2576,4.59773,4.65652,2.89328,2.80383,3.0029,2.75008,3.06659,3.43047,3.36956,3.45968,3.66552,4.00365,4.01492,3.90385,4.43552,4.29795,4.31133,4.57403,3.25462,3.61825,3.51372,3.79957,3.53036,3.72942,4.35841,4.6095,4.58445,4.56036,4.41349,3.01289,3.27683,3.94672,3.87873,4.00514,4.05729,4.28618,4.25424,4.91239,3.40072,3.2235,3.7913,3.69791,3.83181,3.70037,4.05928,3.97321,4.05939,4.35852,4.7181,3.51248,3.85854,3.9206,4.10166,4.20129,3.35338,3.31464,3.57725,3.6577,3.56001,3.67896,4.19582,4.21328,4.62408,3.04139,3.14249,3.15952,3.30704,3.34147,3.77973,4.16286,4.25537,4.34342,2.79247,2.79554,2.78907,2.74286,2.95545,3.24321,3.45788,3.25449,3.58856,3.61754,3.72506,3.57028,4.07516,2.74904,2.74281,2.86538,3.12304,3.53347,3.53701,4.11814,4.35119,4.30396,4.05029,3.67812,3.15944,3.26437,3.47605,3.55688,3.95312,3.0326,2.90099,2.8144,3.16163,3.55163,3.59522,3.93257,4.1829,4.0671,4.33751,4.27303,3.13402,3.06272,3.17428,3.10042,3.15564,3.83491,3.72662,3.8211,2.84891,2.89983,2.84238,2.80151,3.53076,3.48679,3.59501,3.45938,3.60903,3.89998,1.86897,2.11132,2.77057,3.0693,3.02485,3.04116,3.25204,3.16043,3.19315,3.01908,3.31371,3.3822,3.74287,2.57229,2.83447,3.1249,3.02054,2.98345,2.95822,2.76451,3.23255,3.60163,3.57771,3.77788,4.07991,3.58414,3.75222,3.31813,2.85231,3.60838,3.31457,3.54994,2.29768,2.3447,3.15059,2.79561,3.01275,3.57028,3.03536,3.46452,3.53823,3.22572,3.85287,3.64968,3.61563,4.10079,2.04898,2.47276,2.15959,2.52676,2.73336,2.54977,2.54951,2.60028,2.69121,3.00796,2.75861,3.13053,2.47692,3.39514,2.4545,2.40459,2.26955,1.93376,1.95598,2.26486,2.09762,2.38854,2.36721,2.27309,2.32001,2.29286,2.41124,2.68317,2.79561,2.78511,3.12991,3.18321,3.39624,3.21132,3.37555,3.69675,3.65849,4.23312,3.04376,2.98076,2.88878,2.68567,2.89415,2.6614,3.24973,2.89211,3.11866,3.42983,3.23623,2.03105,2.01706,2.7947,2.59791,2.53281,3.02045,3.04187,4.0276,2.95526,2.93961,2.2911,1.91052,2.82478,2.42918,2.3661,2.7529,1.67651,2.48436,2.78289,2.52527,3.23578,2.34111,2.78056,2.99568,2.95038,3.40029,3.27489,3.72563,3.44864,3.6544,4.02522,3.84085,2.20189,2.22701,2.63677,2.30916,2.50169,2.37154,2.53561,2.63498,2.85396,2.97985,2.98623,2.87559,2.91961,3.02862,2.4245,2.06062,2.58295,2.94475,2.92985,3.09733,2.06288,2.06714,2.20823,1.41426,1.80366,1.74783,2.41226,2.08967,1.49912,2.27994,1.92652,2.56038,2.66123,2.05223,2.77974,1.83776,3.02887,3.44263,3.27283,3.03625,3.29105,2.17578,2.26016,1.75117,2.61177,2.58466,2.66817,2.91303,3.01306,2.64462,2.66683,3.12772,3.25927,3.34317,3.31524,3.39671,3.15207,3.32323,3.42598,3.90159,3.63981,3.22368,3.32775,2.94817,3.78538,2.75141,3.51378,3.30574,3.66369,2.90829,3.52579,2.84388,2.75279,2.05496,2.08975,2.02448,2.03571,2.10466,1.86235,1.3997,1.48412,1.17013,1.51502,1.00055,1.34239,1.04628,0.896026,1.33182,0.912575,1.61035,2.52241,2.32644,2.27365,2.42378,2.96543,2.96467,3.28489,3.45863,3.09942,3.78915,2.18197,2.11806,1.94683,1.96327,2.24053,2.06266,1.84297,2.36666,2.50523,3.02329,2.80406,3.35445,3.10438,3.35021,2.45646,3.47144,3.81454,3.25045,2.51474,2.77657,2.08879,2.73085,2.61439,2.73322,2.74965,3.12507,3.07422,2.84054,3.33168,3.53945,3.51419,3.42726,2.55252,2.77673,2.79044,2.29615,2.42012,2.66959,3.20515,3.26241,2.81372,3.14168,3.28778,3.60356,2.25056,2.08084,2.66142,2.81902,2.24194,2.02066,2.85758,2.51203,2.86646,2.17561,1.26977,2.76326,2.23837,3.10954,1.92842,1.85454,2.4805,2.45433,2.83604,2.50947,1.43383,2.31699,2.41549,2.49708,1.32214,0.429579,1.1235,0.811801,1.3308,1.29248,0.139877,0.501225,0.500833,0.205717,1.21825,2.34907,2.1543,1.89067,2.52265,2.63458,2.50315,2.52983,2.25521,2.03433,2.39155,2.32742,2.39792,3.00246,3.08949,3.02239,3.11462,3.50388,3.33365,2.53102,2.55671,2.83962,2.3264,2.90785,2.91897,2.81585,2.84789,3.35476,2.57034,2.89588,1.7351,2.22432,2.21828,2.06035,1.26896,1.08029,1.81041,1.89914,2.17873,1.48379,2.55242,2.44397,1.92082,0.757865,1.84748,1.76136,1.44102,1.45145,-0.0424142,0.35196,-0.0658549,0.0891312,0.546206,0.1156,0.467227,-0.000986102,-0.0454739,2.0178,2.27271,3.09436,3.33486,3.33064,2.07703,2.60203,1.47495,1.69061,1.93419,2.57302,2.10025,2.80075,2.08433,1.53396,1.2447,1.86408,2.10338,2.09093,2.07135,1.97002,2.24051,2.3899,1.70324,1.4408,2.05271,1.69466,2.03215,1.51379,1.48738,1.7531,2.98592,2.80005,2.46923,1.74431,2.31033,1.72124,2.29197,1.4402,1.97084,2.53356,1.72932,2.4129,2.41732,2.42071,0.713126,1.14744,1.0405,1.76571,0.90233,0.941515,0.87305,-0.0707948,-0.02126,1.23504,0.869143,1.60589,1.01398,0.610413,1.50737,1.12423,1.34407,1.04142,0.868637,1.95184,1.0233,1.808,2.18559,2.47975,1.96295,2.39299,2.09779,1.96556,0.173289,2.25602,2.31743,1.77041,1.69198,2.05087,2.15247,1.57725,2.06683,1.64896,2.49358,2.68965,0.62069,1.91281,2.34123,2.35096,2.52248,2.26802,2.12274,2.29103,1.49796,2.53627,1.69531,2.06605,1.88811,1.88359,1.81313,1.29026,2.08765,1.69733,1.13671,0.625778,1.5736,1.08993,1.20131,2.21095,1.20303,0.944637,1.51923,1.77763,1.60554,1.14991,1.84358,1.6841,1.47841,1.4794,1.66367,1.23061,1.69451,1.18773,2.27365,2.00426,1.4822,2.50403,1.94264,3.0293,2.33012,2.73958,2.11322,1.62774,1.99703,2.3002,2.37447,2.18081,1.43962,1.94331,2.04341,2.62128,2.16733,2.50313,1.8994,1.67039,1.96698,0.895133,1.35755,1.43046,2.75174,1.46268,0.147388,1.37908,1.4501,0.829474,1.78914,2.85394,2.46548,2.34711,2.14399,2.21468,2.49625,2.81007,2.19347,2.76841,2.39694,2.68061,2.52323,2.192,2.0913,2.61895,1.31132,0.769105,2.01586,1.17623,1.29361,0.344256,1.91856,2.03249,1.24595,1.68011,1.73836,1.69353,1.64384,1.42168,1.37636,-0.00111971,2.94611,1.08083,1.86179,2.19443,1.59392,2.53974,1.99017,2.96304,1.347,1.9166,2.64991,1.58499,0.763486,0.615431,0.557022,0.789632,1.71358,1.66962,1.68386,1.60771,2.01654,1.01506,1.68997,1.38403,1.38411,1.78499,2.18249,1.8007,2.31746,1.20856,2.79626,2.17949,2.01341,2.44516,3.3591,2.75875,3.61513,1.55427,1.94478,2.39918,2.98735,3.63302,3.51568,2.63882,1.43853,2.34009,2.83775,2.98305,2.37146,2.69225,2.48006,2.0658,1.67596,1.57502,1.56529,0.540592,2.8934,2.95047,1.9182,2.05362,2.07368,2.30184,2.36886,2.9642,2.02429,1.66063,2.53764,1.93094,3.42519,1.20403,1.50773,1.81105,1.96173,3.30469,2.81509,2.63896]
search_values = [3.68035,3.88989,4.08392,4.29211,2.73085,2.81127,2.67606,2.82444,2.9263,3.02176,3.12142,3.14754,3.25994,3.35725,3.52324,3.72567,3.91333,4.04812,4.20078,4.36317,3.0397,3.13651,3.14728,3.35897,3.57568,3.78903,4.00378,4.18387,4.38027,4.14094,4.36964,3.03368,3.18378,3.38354,3.55565,3.6465,3.78645,3.9304,3.99392,4.18413,3.04568,2.99897,3.07923,3.17544,3.29819,3.3847,3.56558,3.74581,3.95395,4.04175,4.24685,3.2603,3.52473,3.73512,3.94162,4.13634,2.96237,3.08148,3.15515,3.29878,3.5461,3.70021,3.88098,3.97354,4.17,2.69518,2.85199,3.00126,3.02788,3.24694,3.42998,3.62282,3.78726,3.97112,2.49026,2.59013,2.63111,2.65844,2.72189,2.77572,2.92641,3.19454,3.39783,3.49696,3.69573,3.84611,3.98797,2.56447,2.72581,2.88906,3.05798,3.32069,3.46545,3.63282,3.798,3.97363,3.74308,3.96088,3.21914,3.39313,3.53835,3.67806,3.9316,2.68446,2.69529,2.73892,2.83349,3.05157,3.28879,3.46292,3.64504,3.72357,3.88498,4.07827,2.37015,2.56031,2.83473,3.01002,3.15173,3.41981,3.60562,3.78977,2.44378,2.48328,2.52488,2.6875,2.84539,3.073,3.26129,3.38167,3.575,3.7622,2.07839,2.20525,2.33542,2.38918,2.44365,2.62833,2.83893,3.00178,3.1253,3.25186,3.38481,3.51188,3.75414,2.03193,2.05616,2.13696,2.26183,2.33353,2.41117,2.55738,2.73494,2.92256,3.08957,3.22168,3.27575,3.41344,3.59625,2.87703,2.87395,2.38531,2.7531,2.8543,2.54883,2.74683,3.12658,3.33126,3.42337,3.45468,3.4899,3.61031,3.76614,3.46556,3.40188,3.50613,3.57929,3.74147,1.95078,2.00692,2.02341,2.09713,2.12937,2.17889,2.20063,2.3335,2.61113,2.69312,2.89215,3.07818,3.22495,3.34692,1.59753,1.63151,1.55329,1.71391,1.75304,1.81676,1.86942,1.85462,1.92912,2.04649,2.1364,2.16538,2.3534,2.58624,2.74941,2.87688,2.99542,3.1103,3.22559,3.43476,3.55958,3.67839,3.80855,3.94482,2.19089,2.2042,2.20804,2.25115,2.31705,2.48316,2.65933,2.70802,2.84985,3.03504,3.20763,2.01596,2.2032,2.43875,2.55582,2.78732,2.91149,3.06149,3.2186,2.12055,2.3759,2.64601,2.7931,2.85911,2.9852,2.77285,2.90681,2.32191,2.47117,2.63467,2.67114,3.29799,2.43844,2.78977,2.94192,3.06419,3.27032,3.39213,3.51502,3.64345,3.78254,3.65051,3.82025,1.96097,1.9904,2.01919,2.04439,2.1243,2.42779,2.59997,2.72324,2.82259,2.91374,3.02603,2.79478,2.76436,2.89977,2.06453,2.27314,2.43819,2.5096,2.57253,2.69627,1.13768,1.21194,1.26022,1.29763,1.36658,1.41954,1.43462,1.53556,1.63379,1.70539,1.90567,2.17421,2.34227,2.46922,2.57359,2.68166,2.7878,2.8881,2.99878,3.19415,3.32257,1.76904,1.84001,1.91846,2.11664,2.31863,2.47805,2.61672,2.81661,2.943,3.06649,3.18335,3.30285,3.42588,3.53885,3.67732,3.06314,3.26321,3.60669,3.69322,3.84834,3.08796,3.26631,3.4145,3.58858,2.80712,2.86768,2.9523,3.11214,2.77208,2.90118,3.02483,1.3167,1.1923,1.08872,0.978247,0.874036,0.926059,0.965943,1.0312,1.04599,1.08843,1.05413,1.16073,1.35098,1.46914,1.56857,1.64832,1.75639,1.90806,2.30359,2.43339,2.54083,2.659,2.72323,2.8112,2.93701,3.05014,3.14847,3.28239,1.54104,1.65797,1.75182,1.79996,1.71992,1.77489,2.0502,2.37101,2.58015,2.7998,2.9233,3.03422,3.14828,3.2631,3.37876,3.49512,3.62082,3.74044,2.0869,2.04671,2.07157,2.18452,2.39951,2.53893,2.66967,2.79809,2.92266,3.08803,3.1931,3.29494,3.39035,3.53092,1.97006,2.00491,2.03557,2.13771,2.33125,2.49045,2.64643,2.84094,2.95244,3.00677,3.16644,3.34906,1.80589,1.80743,1.82624,1.77064,1.68305,1.69628,1.71929,1.90199,2.08346,2.17598,2.25215,2.31568,2.38421,2.56252,1.90534,2.04053,2.09344,2.17097,2.23734,2.34046,2.00986,2.04621,2.07071,2.15593,0.190565,0.479436,0.790501,1.1386,1.46365,1.58612,1.69552,1.78131,1.866,1.99487,2.07313,2.41218,2.49969,2.67417,2.78335,2.88054,2.98354,3.08235,2.43119,2.62023,2.74753,2.86569,3.06242,3.18177,3.2801,3.39163,3.51539,3.46016,3.61454,2.16163,2.12585,2.24879,2.3584,2.47647,2.58101,2.7789,2.92475,3.07803,1.68776,1.88869,2.05531,2.1972,2.33119,2.44681,1.86483,1.97782,2.0729,2.14928,2.17064,2.12301,2.07083,2.17416,0.304254,0.239463,0.176689,0.105107,0.436117,0.697921,0.857551,0.965506,1.08367,1.1671,1.25657,1.34783,1.45929,1.53356,1.59138,2.22956,2.3789,2.51067,2.60346,2.7467,1.44346,1.84234,2.1579,2.36564,2.47656,2.57001,2.66387,2.82288,2.941,1.26876,1.20007,1.28177,1.25292,1.17144,1.13101,0.991984,0.971962,1.02472,1.16395,1.50564,1.86333,1.98229,2.06248,2.12917,2.21437,2.56943,2.66641,2.85422,1.19045,1.2482,1.23536,1.52453,1.74917,1.88751,1.9789,2.01818,1.92431,2.0152,2.094,2.68991,0.337803,0.380743,0.382881,0.421153,0.446611,0.470552,0.493073,0.500825,0.559375,0.624427,0.588873,0.725114,0.791363,0.944868,1.00841,1.1021,1.19694,1.3609,1.52027,1.80421,1.90586,1.96145,1.98501,2.05874,2.14782,2.13482,2.22066,0.740689,0.742401,0.782861,0.86049,0.974297,1.15928,1.33658,1.4768,1.73687,1.94896,2.24582,2.42076,2.5116,1.98018,2.1234,2.22258,2.33593,2.42731,2.53058,2.17403,2.33133,2.44203,2.5606,1.86287,2.12441,2.31075,2.44981,2.16846,2.28498,2.32524,2.44002,0.726946,0.663921,0.566208,0.604905,0.567757,0.641436,0.67065,0.670351,0.798962,0.739708,0.6821,0.658605,0.780814,0.98104,1.2513,1.41982,1.62407,1.71633,1.86499,2.02399,2.11503,2.19894,2.29287,2.46564,2.55942,2.65847,2.75843,2.85795,2.33852,2.40034,2.51232,2.59907,2.78242,1.99442,2.12754,2.08732,2.14678,2.18921,2.22772,2.35466,1.44769,1.60794,1.5827,1.38519,1.56148,1.86662,1.38403,0.919861,1.05686,1.41617,2.18454,2.31405,2.55191,2.60673,2.67697,2.77436,2.25566,2.08509,2.3551,2.77733,2.28069,2.45032,2.58414,2.71566,2.84839,1.98747,2.2799,2.44196,2.53457,0.686592,0.675934,0.647574,0.654787,0.691731,0.773214,1.05824,1.27701,1.63652,1.82952,1.95327,2.25525,2.39111,2.50037,2.64085,2.74415,2.93729,2.78445,2.93481,2.70185,2.83528,2.9664,1.86891,1.99667,2.21272,2.57495,2.67726,1.82694,1.95318,2.07233,2.17115,2.28155,2.46118,2.09077,2.39226,2.55854,2.69174,2.80263,2.91236,3.02357,3.13343,3.33762,3.12946,2.72879,0,3.09998,3.33981,3.46329,2.9471,3.14997,3.4397,3.57353,2.62288,2.74893,2.9459,3.18373,3.29369,2.29533,2.52368,2.70089,2.91785,3.0663,3.17322,2.61353,2.90223,3.01679,2.5629,2.77752,3.00482,3.14085,3.26341,3.19715,2.96676,2.86021,3.2539,3.47978,2.93739,3.4516,3.96635,4.44516,5.03696,5.2022,6.29659,6.51655,7.02534,7.28443,6.67966,7.1168,6.53589,5.80966,5]

function updateEnvironment(index){
    env = new Environment()
    for(i=0; i<index; i++){
        if(i == 0 || env.actionType == 1){
            env.chanceAction(actions[i])
        }
        else{
            env.agentAction(actions[i])
        }
        while(env.actionType == 0){
            // Check if there is only one valid action
            numValidActions = 0
            validAction = -1
            for(d = 0; d < 4; d++){
                if(env.validAgentAction(d)){
                    numValidActions++
                    validAction = d
                }
            }
            if(numValidActions == 1){
                env.agentAction(validAction)
            }
            else{
                break
            }
        }
    }
}


updateEnvironment(1)
currAction = actions[1]
currActionIndex = 2

/*
updateEnvironment(203)
currAction = actions[203]
currActionIndex = 204
*/
tick = 0


/*
//Manual game:
currAction = 0
tick = -1
env.randomChanceAction()
*/

console.log(env)


function fillRect(color,sx,sy,l,w){
    ctx.fillStyle = color;
    ctx.fillRect(sx,sy,l,w);
}

function drawLine(color,p1x,p1y,p2x,p2y, width){
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(p1x,p1y);
    ctx.lineTo(p2x,p2y);
    ctx.stroke();
}

function fillCirc(color,x,y,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,2*pi);
    ctx.fillStyle = color;
    ctx.fill();
}

function fillText(text,color,size,x,y){
    ctx.font = String(size)+"px Arial";
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.fillText(text,x,y);
}

document.addEventListener("keydown",keyHandler);
document.addEventListener("click",clickHandler);

keyMove = ["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"]

paused = true

function keyHandler(event){
    key = event.code
    event.preventDefault()
    /*
    for(i=0; i<4; i++){
        if(keyMove[i] == key){
            if(env.timer != TIME_LIMIT && env.validAgentAction(i)){
                currAction = i
                tick = 0
            }
        }
    }
    */
    if(key == "Space"){
        paused = !paused
        if(paused){
            tick = 0
        }
    }
    if(key == "ArrowRight"){
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowLeft"){
        while(true){
            currActionIndex--
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowDown"){
        currActionIndex = 2
        currAction = actions[currActionIndex-1]
        updateEnvironment(currActionIndex-1)
    }
    if(key == "ArrowUp"){
        currActionIndex = actions.length - 15
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
}

function clickHandler(event){
    rect = canvas.getBoundingClientRect();
    x = event.clientX - rect.left;
    y = event.clientY - rect.top;
}

function draw(){
    fillRect(space, 0, 0, windx, windy)
    fillRect(cLine, marginx - border, marginy - border, boardx*cellS + 2*border, boardy*cellS + 2*border)
    fillRect(space, marginx, marginy, boardx*cellS, boardy*cellS)
    for(var i = 0; i < boardx; i++){
        for(var j = 0; j < boardy; j++){
            if((i + j) % 2 == 0){
                fillRect(cShade, marginx + j * cellS, marginy + i * cellS, cellS, cellS)
            }
        }
    }
    fillCirc(cApple, marginx + env.appley*cellS + cellS/2, marginy + env.applex*cellS + cellS/2, appleSize/2)
    for(i = 0; i < boardx; i++){
        for(j = 0; j < boardy; j++){
            type = env.snake[i][j]
            if(type != -1){
                centerx = marginx + j*cellS + cellS/2
                centery = marginy + i*cellS + cellS/2
                slideProp = tick / framesPerMove
                if(i == env.tailx && j == env.taily && (env.headx + dir[currAction][0] != env.applex || env.heady + dir[currAction][1] != env.appley)){
                    nextx = centerx + dir[type][1] * cellS * slideProp
                    nexty = centery + dir[type][0] * cellS * slideProp
                    fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    drawLine(cSnake, nextx, nexty, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                }
                else{
                    fillCirc(cSnake, centerx, centery, snakeWidth / 2)
                    if(type == 4){
                        nextDir = dir[currAction]
                        nextx = centerx + nextDir[1] * cellS * (tick / framesPerMove)
                        nexty = centery + nextDir[0] * cellS * (tick / framesPerMove)
                        drawLine(cSnake, centerx, centery, nextx, nexty, snakeWidth)
                        fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    }
                    else{
                        drawLine(cSnake, centerx, centery, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                    }
                }
            }
        }
    }
    fillText("Score: " + env.score.toString(), cText, textSize, windx/2, marginy/2)
    fillText("Timer: " + env.timer.toString(), cText, textSize, windx/2, marginy/2 + textSize * 1.5)


    fillText("Value", cValue, textSize, marginx/3, textSize)
    fillText(values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize)
    fillText("Search Value", cSearch, textSize, marginx/3, textSize*2)
    fillText(search_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*2)
    fillText("Network Value", cNetwork, textSize, marginx/3, textSize*3)
    fillText(network_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*3)

    drawLine(cValue, marginx/4, windy/2, marginx/4, windy/2 - values[currActionIndex-2] * 25, marginx/4)

    drawLine(cSearch, marginx*2/4, windy/2, marginx*2/4, windy/2 - search_values[currActionIndex-2] * 25, marginx/4)

    drawLine(cNetwork, marginx*3/4, windy/2, marginx*3/4, windy/2 - network_values[currActionIndex-2] * 25, marginx/4)

    //fillText("Reward", cText, textSize, marginx/4, 100)
    //fillText(values[currActionIndex-1].toString(), cText, textSize, marginx/4, 120)
    //drawLine(cText, marginx/4, windy/2, marginx/4, windy/2 + rewards[currActionIndex-1] * 100, 3)
}

endState = false

function update(){
    if(endState) return
    draw()
    if(!paused){
        tick++
    }
    if(tick >= framesPerMove){
        tick = 0

        env.agentAction(currAction)
        if(env.actionType == 1){
            env.chanceAction(actions[currActionIndex])
            currActionIndex++
        }
        if(env.timer == TIME_LIMIT){
            endState = true
            return
        }

        // Check if there is only one valid action
        numValidActions = 0
        validAction = -1
        for(i = 0; i < 4; i++){
            if(env.validAgentAction(i)){
                numValidActions++
                validAction = i
            }
        }
        if(numValidActions == 0){
            endState = true
            return
        }
        if(numValidActions == 1){
            currAction = validAction
        }
        else{
            currAction = actions[currActionIndex]
            currActionIndex++
        }
    }
}

function updateManual(){
    draw()
    if(tick == -1){
        
    }
    else if(tick < framesPerMove){
        tick++
    }
    else{
        env.agentAction(currAction)
        tick = -1
        if(env.actionType == 1){
            env.randomChanceAction()
        }
    }
}

var ONE_FRAME_TIME = 1000 / 60 ;
var mainloop = function() {
    update()
    //updateManual()
};
setInterval( mainloop, ONE_FRAME_TIME );

</script>

</body>

</html>
