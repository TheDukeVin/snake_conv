
<!DOCTYPE html>
<html>


<head>
<title> Visualizing snake </title>
</head>


<body>

<div class="panel">
<canvas id="canvas" width="1000" height="600" style="position:relative; top:50px; left:50px"></canvas>
</div>

<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
 
boardx = 10;
boardy = 10;
cellS = 40;
windx = 1000;
windy = 600;
marginx = (windx - boardx * cellS) / 2
marginy = (windy - boardy * cellS) / 2
border = 5
snakeWidth = 20
appleSize = 20
textSize = 20

framesPerMove = 7

dir = [[0,1], [1,0], [0,-1], [-1,0]];

pi = Math.PI;

space = "#fff"
cLine = "#000"
cShade = "#eee"
cSnake = "#00f"
cApple = "#f00"
cText = "#000"

cValue = "#d00"
cSearch = "#bb0"
cNetwork = "#0d0"

TIME_LIMIT = 1000

function randint(max){
    return Math.floor(Math.random()*max)
}

class Environment{
    constructor(){
        this.timer = 0
        this.score = 0;
        this.actionType = 0;
        this.snakeSize = 2;
        this.headx = boardx/2;
        this.heady = 2;
        this.tailx = this.headx;
        this.taily = 1;

        this.snake = []
        for(var i=0; i<boardx; i++){
            this.snake[i] = []
            for(var j=0; j<boardy; j++){
                this.snake[i][j] = -1;
            }
        }
        this.snake[this.headx][this.heady] = 4;
        this.snake[this.tailx][this.taily] = 0;
        this.applex = 0;
        this.appley = 0;
    }

    agentAction(actionIndex){
        this.timer ++
        var newHeadx = this.headx + dir[actionIndex][0];
        var newHeady = this.heady + dir[actionIndex][1];
        this.snake[this.headx][this.heady] = actionIndex;
        this.headx = newHeadx;
        this.heady = newHeady;
        this.snake[newHeadx][newHeady] = 4;

        if(this.headx == this.applex && this.heady == this.appley){
            this.score += 1;
            //score += 1 - timer*0.5/maxTime;
            this.snakeSize++;
            this.actionType = 1;
        }
        else{
            var tailDir = this.snake[this.tailx][this.taily];
            this.snake[this.tailx][this.taily] = -1;
            this.tailx += dir[tailDir][0];
            this.taily += dir[tailDir][1];
        }
    }

    chanceAction(actionIndex){
        this.applex = Math.floor(actionIndex / boardy);
        this.appley = actionIndex % boardy;
        this.actionType = 0
    }

    validAgentAction(d){
        var newHeadx = this.headx + dir[d][0];
        var newHeady = this.heady + dir[d][1];
        if(newHeadx == -1 || newHeadx == boardx){
            return false;
        }
        if(newHeady == -1 || newHeady == boardy){
            return false;
        }
        return this.snake[newHeadx][newHeady] == -1;
    }

    randomChanceAction(){
        while(true){
            this.applex = randint(boardx)
            this.appley = randint(boardy)
            if(this.snake[this.applex][this.appley] == -1){
                break
            }
        }
        this.actionType = 0
    }
}

env = new Environment();

//Agent game:
actions = [0,3,3,3,3,3,2,2,89,1,1,0,1,1,0,1,0,0,0,0,0,0,1,0,1,82,2,2,2,2,2,2,2,20,3,2,3,2,3,3,3,3,75,0,1,1,0,1,0,1,0,1,0,38,0,3,3,3,0,3,0,57,1,1,2,51,2,2,2,2,2,2,3,38,0,0,0,0,0,1,0,3,3,3,0,19,0,3,3,64,2,1,2,1,1,2,1,2,1,74,1,63,2,3,44,3,3,0,33,2,95,3,0,0,1,1,1,2,1,1,1,1,60,2,2,2,2,2,3,3,39,0,0,3,3,0,1,0,3,0,0,0,0,0,3,93,3,2,1,3,3,2,2,1,2,2,1,2,2,1,1,1,2,1,1,1,0,0,88,0,0,0,0,0,0,2,72,2,2,2,2,2,3,2,32,3,3,3,3,64,0,1,1,1,27,1,0,3,3,3,0,3,3,77,3,0,1,1,1,1,2,1,87,1,65,0,3,3,1,3,3,3,94,2,1,1,1,50,2,2,2,2,3,3,3,37,0,0,0,0,0,0,3,0,3,44,2,2,1,79,3,3,2,3,0,0,1,0,0,0,1,1,1,1,1,10,2,3,2,1,2,2,3,2,1,2,3,3,3,3,3,3,2,2,44,3,1,0,1,1,1,48,1,0,0,0,21,3,0,1,1,1,1,2,2,2,3,2,1,2,3,0,3,3,3,3,2,2,3,50,3,0,1,0,1,1,0,3,3,3,3,2,1,0,0,1,2,3,47,0,1,2,0,3,2,3,3,0,0,3,0,0,7,3,3,3,3,85,2,1,2,3,2,2,2,2,1,1,1,0,1,1,2,1,0,0,3,96,0,1,89,0,0,79,3,82,2,1,2,2,2,1,2,45,3,0,0,3,9,0,0,0,0,3,3,3,3,4,2,2,2,2,41,2,2,2,2,1,1,1,0,81,1,2,0,1,1,32,2,1,0,0,3,2,2,2,1,0,2,3,3,98,3,3,0,0,0,0,1,1,0,1,1,0,1,1,1,1,44,2,0,2,2,0,0,2,0,2,0,2,0,0,3,0,0,56,0,3,3,3,0,1,1,64,2,2,1,22,0,1,2,1,0,0,3,3,3,3,3,0,3,2,2,0,0,2,41,2,2,0,1,60,2,1,94,1,0,1,2,0,0,33,0,0,3,3,3,3,1,2,2,2,2,2,3,2,3,3,26,0,3,0,0,76,3,2,2,2,2,1,1,1,1,3,2,45,3,0,2,2,3,9,3,1,3,3,0,1,1,15,2,1,51,0,1,1,1,2,2,1,2,41,4,0,0,3,3,0,82,2,2,1,1,1,1,1,0,3,99,0,1,0,0,0,0,12,3,2,1,3,3,0,0,3,1,3,2,1,2,3,3,3,0,1,1,2,0,2,3,3,2,2,3,41,0,1,0,63,3,0,1,91,2,2,3,1,1,83,3,3,1,1,3,85,3,1,1,3,98,0,1,0,59,0,3,3,3,67,2,2,1,66,2,78,3,2,3,3,1,3,0,1,2,2,2,1,2,2,3,2,1,2,0,0,0,64,1,2,2,3,1,3,1,2,45,5,0,0,0,0,3,3,3,2,2,2,44,1,0,0,3,0,1,16,2,3,0,0,3,2,1,1,0,0,1,2,3,1,1,1,0]
values = [1.53848,1.61945,1.70469,1.79441,1.88885,1.98827,2.09291,2.20306,1.26638,1.33304,1.4032,1.47705,1.55479,1.63662,1.72276,1.81343,1.90887,2.00934,2.11509,2.22641,2.34359,2.46694,2.59678,2.73345,2.87732,1.97612,2.08013,2.18961,2.30485,2.42616,2.55385,2.68827,2.82975,1.92606,2.02743,2.13414,2.24646,2.36469,2.48915,2.62016,2.75806,2.90322,2.00339,2.10883,2.21982,2.33666,2.45964,2.58909,2.72536,2.8688,3.01979,3.17873,3.34603,2.46951,2.59948,2.73629,2.88031,3.0319,3.19148,3.35945,3.53626,2.66975,2.81027,2.95817,3.11387,2.22512,2.34224,2.46551,2.59527,2.73187,2.87565,3.027,3.18632,2.30139,2.42251,2.55001,2.68422,2.8255,2.97421,3.13075,3.29552,3.46897,3.65155,3.84373,4.04604,3.20635,3.37511,3.55275,3.73973,2.88393,3.03572,3.19549,3.36367,3.54071,3.72706,3.92322,4.12971,4.34706,4.57586,3.76406,3.96217,3.11807,3.28218,3.45493,2.58413,2.72014,2.8633,3.014,2.12,2.23158,1.2964,1.36464,1.43646,1.51206,1.59164,1.67541,1.76359,1.85641,1.95412,2.05697,2.16523,2.27919,1.34652,1.41739,1.49198,1.57051,1.65317,1.74018,1.83177,1.92817,0.977025,1.02845,1.08258,1.13955,1.19953,1.26266,1.32912,1.39907,1.47271,1.55022,1.63181,1.7177,1.8081,1.90326,2.00344,1.05625,1.11184,1.17036,1.23196,1.2968,1.36505,1.43689,1.51252,1.59212,1.67592,1.76413,1.85698,1.95471,2.05759,2.16589,2.27988,2.39987,2.52618,2.65914,2.79909,2.94641,3.10149,3.26473,2.38392,2.50939,2.64146,2.78049,2.92683,3.08087,3.24302,3.41371,2.54075,2.67447,2.81523,2.9634,3.11937,3.28355,3.45637,3.63828,2.77714,2.9233,3.07716,3.23912,3.4096,2.53642,2.66991,2.81044,2.95835,3.11406,2.22532,2.34244,2.46573,2.59551,2.73211,2.87591,3.02727,3.1866,3.35432,2.47823,2.60866,2.74596,2.89048,3.04261,3.20275,3.37132,3.54876,3.73553,2.87951,3.03106,2.13796,2.25048,2.36893,2.49361,2.62485,2.763,2.90842,3.0615,2.17,2.28421,2.40443,2.53098,2.66419,1.75178,1.84398,1.94103,2.04319,2.15073,2.26392,2.38307,2.5085,1.58789,1.67147,1.75944,1.85204,1.94952,2.05212,2.16013,2.27382,2.3935,2.51947,1.59944,1.68362,1.77224,1.86551,0.911064,0.959015,1.00949,1.06262,1.11855,1.17742,1.23939,1.30462,1.37328,1.44556,1.52164,1.60173,1.68603,1.77477,1.86818,1.9665,1.01737,1.07092,1.12728,1.18661,1.24907,1.31481,1.38401,1.45685,1.53353,1.61424,1.6992,1.78863,1.88277,1.98186,2.08617,2.19597,2.31155,2.43321,2.56127,1.64344,1.72994,1.82099,1.91683,2.01772,2.12391,2.2357,1.30073,1.36919,1.44125,1.51711,1.59696,0.628377,0.661449,0.696263,0.732908,0.771482,0.812086,0.854828,0.899819,0.947178,0.997029,1.0495,1.10474,1.16289,1.22409,1.28852,1.35633,1.42772,1.50286,1.58196,1.66522,1.75286,1.84512,1.94223,0.991823,1.04402,1.09897,1.15681,1.2177,1.28179,1.34925,1.42026,1.49501,1.5737,1.65652,1.74371,1.83548,1.93209,2.03378,2.14082,2.25349,2.3721,2.49695,1.57573,1.65867,1.74596,1.83786,1.93459,2.03641,2.14359,2.25641,2.37516,2.50017,2.63176,2.77027,2.91608,3.06956,2.17848,2.29314,2.41383,2.54087,2.6746,1.76274,1.85551,1.95317,2.05597,2.16418,2.27808,2.39798,2.52419,2.65705,2.79689,2.9441,3.09905,3.26216,3.43385,3.61458,3.80482,4.00507,4.21586,4.43775,4.67132,3.86455,4.06794,4.28204,3.45478,3.63661,3.82801,2.97686,3.13353,2.24583,2.36403,2.48845,2.61942,2.75729,2.90241,3.05516,3.21596,2.33259,2.45536,2.58459,2.72062,2.86381,1.96191,2.06516,2.17386,2.28827,2.4087,2.53548,2.66893,2.80939,2.95726,2.06027,2.16871,2.28285,2.403,2.52947,1.60997,1.69471,1.7839,1.87779,1.97662,2.08066,2.19016,2.30543,2.42677,1.50187,1.58091,1.66412,1.7517,1.8439,1.94095,0.990469,1.0426,1.09747,1.15523,1.21604,1.28004,1.34741,1.41833,1.49297,1.57155,1.65426,1.74133,1.83298,1.92945,0.978372,1.02986,1.08407,1.14112,1.20118,1.2644,1.33095,1.401,1.47474,1.55236,1.63406,1.72006,1.81059,1.90589,2.0062,2.11179,2.22293,1.2873,1.35505,1.42637,1.50144,1.58046,1.66364,1.7512,1.84337,1.94039,2.04252,2.15002,2.26318,2.38229,2.50768,2.63966,2.77859,2.92483,2.02614,2.13278,2.24503,2.36319,2.48757,2.61849,2.75631,2.90138,2.00145,2.10679,2.21767,2.33439,1.40462,1.47855,1.55637,1.63828,1.72451,1.81527,1.91081,2.01138,2.11724,2.22868,2.34597,2.46945,2.59942,2.73623,2.88024,3.03183,3.1914,3.35937,3.53618,2.66966,2.81017,2.95808,3.11376,3.27765,2.39752,2.52371,2.65654,1.74372,1.8355,1.9321,2.03379,2.14083,2.25351,2.37211,1.44433,1.52035,1.60037,1.68459,1.77326,1.86659,1.96483,2.06824,2.1771,2.29168,2.41229,2.53926,2.6729,2.81358,2.96166,3.11754,3.28162,2.40171,2.52811,2.66117,2.80123,2.94867,2.05123,2.15919,2.27283,2.39245,2.51837,2.65092,2.79044,2.9373,3.0919,3.25463,3.42593,3.60624,2.74341,2.8878,3.03979,3.19978,3.36819,3.54546,2.67943,2.82045,2.9689,3.12516,3.28964,3.46278,3.64503,3.83687,2.98618,3.14335,3.30879,2.4303,2.55821,2.69286,2.83459,2.98377,3.14081,3.30612,3.48013,3.66329,2.80346,1.89838,1.9983,2.10347,2.21418,2.33072,2.45339,1.52988,1.6104,1.69516,1.78438,1.87829,1.97715,2.08121,2.19075,2.30605,2.42742,1.50255,1.58163,1.66487,1.7525,1.84474,1.94183,2.04403,1.09898,1.15682,1.2177,1.28179,1.34926,1.42027,1.49502,1.57371,1.65653,1.74372,1.83549,1.9321,2.03379,2.14083,2.25351,2.37211,2.49696,2.62838,2.76671,2.91233,3.06561,3.22696,3.3968,3.57558,3.76376,3.96186,4.17038,4.38987,3.56828,3.75609,3.95378,4.16187,3.32829,3.50346,3.68785,3.88195,3.03363,3.19329,3.36136,3.53828,3.7245,3.92053,3.07424,3.23604,3.40636,3.58564,3.77436,3.97301,3.12949,3.2942,3.46757,3.65008,3.84219,2.99178,3.14924,3.31499,3.48946,2.62048,2.7584,2.90358,3.0564,3.21727,2.33397,2.45681,2.58611,2.72222,1.81287,1.90828,0.956084,1.0064,1.05937,1.11513,1.17382,1.2356,1.30063,1.36909,1.44114,1.51699,1.59684,1.68088,1.76935,1.86247,1.96049,2.06368,2.17229,2.28662,2.40697,2.53366,2.66701,2.80737,1.9025,2.00263,2.10803,2.21898,2.33577,2.45871,2.58811,2.72433,2.86771,1.96601,1.01686,1.07038,1.12671,1.18601,1.24843,1.31414,1.38331,1.45611,1.53275,1.61342,1.69834,0.735092,0.773781,0.814506,0.857375,0.9025,0.95,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
network_values = [2.21676,2.2611,2.46248,2.56218,2.84874,2.65149,2.80014,2.73719,1.30078,1.36652,1.48274,1.39224,1.45536,1.45111,1.68381,1.72778,1.76953,2.09382,2.10718,2.27778,2.5246,2.72962,2.7161,2.8714,3.0686,2.20586,2.18163,2.3515,2.41692,2.78219,2.77639,2.85575,3.18834,2.12592,2.16799,2.1698,2.40505,2.36708,2.39541,2.71957,2.59283,2.96857,1.77016,1.85556,2.0399,2.35709,2.25182,2.51661,2.52272,2.5689,2.83682,2.92496,3.19958,2.00439,2.13525,2.28625,2.41756,2.64705,2.69019,2.8738,2.77125,2.55599,2.82246,2.7725,2.79516,1.83315,2.19637,2.33771,2.39896,2.49069,2.78012,2.60198,3.10593,1.90829,1.92794,1.98814,2.18707,2.26587,2.47181,2.16423,2.25528,2.47278,2.55778,2.649,2.94154,2.61563,2.256,2.37731,2.58952,1.61365,1.71444,2.04813,2.17976,2.27349,2.62017,2.66888,2.82876,2.82813,2.99103,2.82964,2.86317,2.45779,2.66697,2.93945,2.34425,2.53956,2.66304,2.69772,2.6242,2.84382,1.69047,1.64763,1.58523,1.60026,1.78853,2.08888,2.02753,2.13707,2.39048,2.55623,2.41698,2.49745,2.08158,2.06074,2.05334,2.26688,2.42432,2.55772,2.81544,2.97912,1.60071,1.50558,1.54955,1.66161,1.80146,1.89172,1.72186,1.58882,1.93928,1.91679,1.8549,2.06403,2.39296,2.2988,2.44093,1.50951,1.28327,1.43297,1.60359,1.55526,1.27704,1.4585,1.60569,1.81296,1.76569,1.83357,2.12319,2.04757,2.02481,2.25754,2.3052,2.09284,2.08013,2.14538,2.44702,2.6621,2.7845,2.88855,2.38883,2.22415,2.21994,2.5721,2.60259,2.90743,2.91714,2.68265,1.96801,2.12743,2.14334,2.33661,2.51997,2.93411,2.81687,2.93536,2.34811,2.36404,2.33093,2.95387,2.73197,2.10205,2.32337,2.50456,2.55535,2.78709,2.03691,1.93972,1.99268,2.11118,2.2286,2.45725,2.34841,2.58285,2.83018,1.67907,1.76489,1.8921,1.93481,2.13718,2.17031,2.36488,2.32706,2.59796,2.31746,2.66372,1.9811,2.01022,1.7439,1.77835,2.03757,2.81309,3.00297,3.14111,1.84947,2.28239,2.30752,2.41973,2.59724,1.91286,2.12965,2.02089,2.10261,2.23451,2.74678,2.7454,2.85383,1.60445,1.65261,1.70653,1.73736,1.95129,2.16269,2.30017,2.4437,2.29814,2.62317,1.99733,1.86564,2.25556,2.29992,1.43414,1.43975,1.5759,1.05404,1.3954,1.34857,1.64558,1.52287,1.63386,1.6768,1.62896,2.02399,2.2972,1.88439,2.59456,2.82525,1.43358,1.32151,1.21655,1.23849,1.51333,1.38121,1.37882,1.46403,1.66777,1.50195,1.79266,1.81189,1.91489,1.82657,1.91347,1.85754,2.07544,2.48219,2.44697,1.22389,1.82983,1.83565,2.13461,2.04658,2.15152,2.4357,1.84646,1.96523,1.96838,2.25964,2.56612,1.35466,1.38619,1.61104,1.37755,1.23428,1.15609,1.29847,1.26978,1.58202,1.55829,1.51333,1.50677,1.75287,1.92631,1.92359,1.97591,1.78451,1.79025,2.09246,2.24168,2.22911,2.28239,2.70738,1.53704,1.84682,1.87569,1.79416,1.71007,1.63675,1.42476,1.35789,1.39852,1.64581,1.59683,1.38196,1.49972,2.00582,1.45,1.59586,1.9183,2.27731,2.5948,1.32589,1.75315,1.71928,1.80047,1.63097,1.77391,1.95231,1.86364,2.0475,1.93002,2.48453,2.42946,2.45138,2.58533,1.69582,2.19362,2.03066,2.54458,2.15921,1.46454,1.51021,1.45951,1.49816,1.33868,1.31787,1.52918,1.45256,1.63275,1.79364,1.81881,1.69013,1.49552,2.01464,1.73219,1.80909,2.3156,2.44723,2.5275,2.41474,2.59468,2.45224,2.56332,2.12854,2.52072,2.75028,2.72693,2.57121,2.13961,1.78634,2.06699,2.18414,1.8858,1.82516,2.0624,2.86536,1.81137,2.17287,2.16677,2.16371,2.60907,1.25839,2.07503,1.7452,1.95732,1.66604,2.16523,2.82178,3.10658,3.02749,2.14638,2.42724,2.2851,2.59641,3.24131,2.02463,1.97489,1.9804,1.91364,2.15633,2.09481,2.19712,2.2729,2.55361,2.05038,2.17275,2.06673,2.55977,2.07436,2.22824,1.2787,0.787699,1.15566,1.57821,1.25365,1.49963,1.27382,1.86877,1.74456,2.07425,2.64551,1.88141,2.12564,3.00136,1.48119,1.39012,1.85403,1.45028,1.51589,1.64136,1.9908,1.93484,2.00234,1.8466,2.09994,2.06267,2.10531,2.26391,2.53476,2.59666,2.31612,1.57454,1.57996,1.47812,1.71136,1.05455,1.1165,1.7634,1.77859,1.94587,1.69561,2.66851,2.67768,2.21931,2.65238,1.76281,2.5661,3.23989,2.08154,2.78411,1.62277,1.54583,1.34485,2.62777,2.44671,2.88518,1.83691,2.58744,2.27177,2.8263,1.36656,1.51069,1.43488,1.31087,1.32698,1.24991,1.10906,1.60663,1.16313,1.22578,1.43832,1.41838,1.26224,2.29856,2.14585,2.18293,2.39807,2.46548,2.60827,2.1548,2.45551,2.28316,2.44767,2.98413,2.37748,2.67456,3.11266,1.77382,1.98136,1.76908,1.67066,1.77725,1.9727,1.71209,0.744775,0.968618,1.21822,1.56933,1.43091,1.05929,1.67873,1.81556,2.08505,1.9987,2.10399,1.92772,2.20742,2.5618,2.43329,2.85797,3.10875,2.33705,2.68206,2.44604,2.93379,2.59813,2.18875,1.80001,1.62494,1.83062,2.34525,2.16985,2.25673,2.63268,2.72392,3.14096,3.12541,3.14117,2.01877,2.46647,2.68129,2.38049,2.63476,2.09322,1.56884,1.68419,1.88852,2.17213,2.06184,2.70904,2.25689,2.92227,2.43554,2.75752,2.61673,1.85272,2.08047,2.12123,2.02183,2.47611,2.6803,2.24666,1.9567,2.5023,2.45419,2.12524,1.94394,2.12366,2.9057,2.55212,2.52536,1.59383,1.84376,0.848561,1.9037,0.522547,2.88657,2.98521,2.6654,2.63038,2.89728,1.84328,2.25475,2.05803,2.13057,2.69771,2.72365,2.88038,1.54481,1.64063,1.7347,1.35611,1.64249,1.42889,1.53594,1.83372,1.76472,1.5475,1.6674,1.59533,1.29887,0.900057,1.65465,1.75668,1.73797,1.75505,1.89842,2.06157,1.83277,2.34468,2.27566,2.4407,3.29848,3.53289,2.09011,3.38592,2.16598,2.68487,2.71603,3.72881,2.58898,3.19371,3.24869,3.42287,2.82853,2.48271,2.50875,3.38372,3.22237,3.08283,2.85744,2.80669,3.04432,3.26245,3.30719,3.75986,2.96643,3.4199,3.67664,3.55326,3.21765,2.71309,3.0686,3.82953,3.55903,3.2547,2.88712,3.72226,3.66715,3.56241,2.81406,2.88894,2.92889,3.1334,3.04295,3.09506,2.13171,2.15225,1.43618,2.07843,1.70462,1.67089,1.70778,1.93162,1.83339,1.47624,1.69955,1.92117,1.39384,1.7175,1.61604,0.349802,1.85159,0.492418,0.690942,1.14452,2.38828,3.13558,1.62568,1.75784,2.29399,1.7894,2.40362,2.57394,2.57227,2.76106,3.22471,3.48727,2.11456,2.22867,2.57731,2.21708,2.26237,2.26064,2.87811,2.65125,2.70108,2.8243,3.29289,2.06302,2.27272,2.39334,1.66207,1.55214,3.03058,2.96882,2.54256,2.40805,1.68422,2.59701,2.76355,2.18212,2.66429,1.80501,1.84438,2.06343,1.85872,1.73098,1.58956,1.83933,1.73874,1.52149,1.88955,1.58691]
search_values = [1.69467,1.80968,1.93956,2.11597,2.30208,2.46296,2.61531,2.78975,1.09556,1.14064,1.19756,1.22045,1.29472,1.36504,1.45017,1.51497,1.61289,1.70947,1.80718,1.95361,2.11186,2.29423,2.46607,2.57658,2.75069,1.70647,1.73223,1.81158,2.01249,2.22519,2.41763,2.62333,2.83159,1.62101,1.68066,1.75831,1.93517,2.11984,2.27876,2.43264,2.59129,2.75655,1.54567,1.64397,1.7276,1.78072,1.82801,1.95815,2.14368,2.33086,2.53179,2.68145,2.89583,1.72998,1.77166,1.88701,2.0686,2.24603,2.44351,2.58012,2.79126,2.24448,2.48332,2.65732,2.86663,1.57832,1.68574,1.82484,2.06332,2.27984,2.45894,2.62896,2.84295,1.48318,1.56085,1.62675,1.7316,1.90545,2.05671,1.8035,2.05297,2.26321,2.40726,2.55921,2.76176,2.20637,2.38458,2.52949,2.70621,1.41273,1.50632,1.66426,1.82608,2.03819,2.19384,2.33075,2.50033,2.65389,2.86113,2.6224,2.86511,2.38889,2.58797,2.79525,2.23272,2.39978,2.55269,2.73809,2.52192,2.75306,1.3095,1.2871,1.32588,1.40115,1.47559,1.65788,1.7116,1.84927,2.03586,2.23638,2.4289,2.62952,1.59032,1.78358,1.95369,2.10399,2.23247,2.38286,2.52933,2.69327,1.20629,1.19984,1.21591,1.26351,1.31075,1.37839,1.3503,1.43791,1.50843,1.66429,1.88324,2.08699,2.26678,2.39227,2.54775,0.972347,0.962551,0.982547,1.03828,1.06677,1.08716,1.13526,1.22438,1.30368,1.33064,1.39197,1.49359,1.47693,1.48629,1.59395,1.6848,1.90218,1.96086,2.12113,2.24117,2.39545,2.55114,2.72137,1.81662,2.01193,2.16741,2.30635,2.45285,2.51321,2.59982,2.77575,1.63753,1.85712,2.02468,2.16896,2.31877,2.44822,2.3192,2.51447,1.89573,2.17904,2.41106,2.5878,2.78818,1.99724,2.21611,2.40793,2.55745,2.73188,1.64584,1.62022,1.63704,1.73589,1.95508,2.19387,2.29824,2.48392,2.68805,1.35546,1.21191,1.55621,1.76649,1.91137,2.05579,2.24271,2.43074,2.58821,2.41693,2.59372,1.38797,1.7192,1.93319,2.07048,2.188,2.29548,2.45451,2.58441,1.58455,1.59504,1.83806,2.07867,2.22505,1.64426,1.79567,1.94549,2.08527,2.22995,2.36742,2.51077,2.67288,1.27244,1.30931,1.38143,1.54447,1.73588,1.89569,2.04119,2.2049,2.34265,2.5334,1.92366,2.09844,2.237,2.41795,0.862424,0.917866,1.00653,0.848348,0.969896,1.09126,1.1966,1.40992,1.58168,1.72336,1.86044,1.97382,2.07886,2.22521,2.35308,2.50558,0.952385,0.980122,0.965711,1.02886,1.0449,1.08912,1.13278,1.0866,1.15983,1.17502,1.2367,1.33996,1.47257,1.6719,1.82452,1.97378,2.0955,2.25824,2.45401,1.67934,1.86319,2.01231,1.96589,2.14314,2.1985,2.35687,1.81977,1.95423,2.09488,2.24039,2.39651,0.848918,0.784243,0.806135,0.867402,0.918837,0.93818,0.986925,1.03605,1.08195,1.14203,1.13674,1.2441,1.3144,1.39831,1.44499,1.48384,1.65988,1.80911,1.95293,2.0815,2.10651,2.20468,2.40305,0.903242,0.858536,0.862255,0.907568,0.911273,0.913921,0.884764,0.873449,1.09486,1.44104,1.63633,1.79117,1.92004,2.0298,2.1484,2.28027,2.3178,2.44131,2.6138,1.11896,1.16145,1.21408,1.34478,1.3972,1.42645,1.50104,1.64559,1.80451,1.98436,2.14597,2.25285,2.42573,2.6252,1.61803,1.87469,2.07335,2.24677,2.42805,0.845361,0.908187,0.878718,0.884171,0.944013,0.951743,0.961466,0.937747,0.936717,1.14882,1.3608,1.52212,1.64695,1.77026,1.89313,2.01994,2.13037,2.26639,2.3881,2.54834,2.24812,2.45124,2.64289,2.36217,2.50038,2.67965,2.52444,2.71091,1.42619,1.81743,2.03233,2.18158,2.31995,2.45897,2.61136,2.75802,2.1043,2.25293,2.39159,2.54194,2.74098,1.3245,1.48149,1.77302,1.94977,2.09424,2.20488,2.33659,2.47163,2.61798,2.08634,2.22629,2.36245,2.49964,2.65977,1.42274,1.55043,1.71321,1.82139,1.92682,2.04756,2.15686,2.27994,2.43776,1.63921,1.80905,1.83829,1.6412,1.66788,1.80377,0.751643,0.847111,1.03357,1.27852,1.44636,1.58881,1.73707,1.84907,1.98637,2.09855,2.20742,2.37863,2.4962,2.64896,1.15105,1.18985,1.16725,1.19157,1.21415,1.23014,1.19907,1.18107,1.33793,1.13558,1.49115,1.7658,1.92166,2.04797,2.16486,2.25791,2.39059,0.546685,0.626756,0.705447,0.820514,0.953009,1.04793,1.14581,1.26126,1.40424,1.5278,1.65875,1.77863,1.90998,2.04954,2.19423,2.35136,2.53332,1.74112,1.72821,1.90389,2.07181,2.20583,2.31201,2.33857,2.50868,2.04366,2.19313,2.29443,2.45411,0.668645,0.662486,0.649417,0.572067,0.60537,0.709687,0.881761,1.09564,1.22484,1.35014,1.44422,1.53855,1.6293,1.72861,1.79525,1.89249,1.97377,2.08159,2.18241,2.06221,2.17619,2.30508,2.37083,2.53958,2.28711,2.41912,2.59247,1.02888,1.13826,1.29166,1.51082,1.63273,1.7035,1.81954,0.830836,0.989854,1.07304,1.13263,1.19202,1.26064,1.42762,1.61267,1.78863,1.93105,2.06467,2.20882,2.3507,2.50044,2.67,2.84176,3.01479,2.21954,2.39202,2.55046,2.70185,2.91389,1.21231,1.40993,1.63363,1.7896,1.90065,2.02649,2.18233,2.31464,2.43767,2.57313,2.67014,2.84953,1.85666,2.01201,2.12492,2.24425,2.25994,2.45162,1.63296,1.91535,2.07959,2.19928,2.3466,2.48359,2.65286,2.8305,2.51308,2.53733,2.71705,1.49901,1.62,1.8261,1.96573,2.10845,2.2494,2.40752,2.57597,2.75979,3.0325,1.85155,2.0118,2.13545,2.28106,2.45927,2.61674,1.74648,1.93973,2.08636,2.23956,2.24289,2.33671,2.38611,2.45064,2.61494,2.79632,1.77672,2.09492,2.29061,2.4363,2.59798,2.73401,2.89125,0.922188,0.854641,0.77875,0.787124,0.73573,0.71953,0.737797,0.710853,0.755416,0.792271,0.810412,0.74253,0.744995,0.766121,0.989007,1.22398,1.40601,1.54328,1.70537,1.83512,1.96778,2.10508,2.24719,2.40748,2.55729,2.71731,2.89995,3.06141,2.70578,2.85904,3.01932,3.21868,2.65393,2.84209,2.95183,3.14139,2.25761,2.50074,2.71275,2.92374,3.08928,3.28409,2.77634,2.77022,2.89666,2.96639,3.06906,3.27649,2.81923,2.88926,3.00414,3.14633,3.35347,2.87394,3.03898,3.26595,3.48035,2.70779,2.82548,2.98763,3.21103,3.40843,2.68836,2.80392,2.89266,3.10958,2.75272,2.98961,0.824476,0.75293,0.667253,0.675871,0.719924,0.666823,0.942134,0.482424,0.296682,0.308813,0.575949,1.00708,1.28081,1.45009,1.54447,1.69537,1.81368,1.94509,2.07561,2.27514,2.40473,2.54906,2.09025,2.27989,2.43712,2.59599,2.75235,2.91953,3.11941,3.31553,3.49877,3.35002,1.51888,1.78378,2.05146,2.25779,2.42805,2.61696,2.7981,2.99484,3.18724,3.39132,3.57751,2.05728,2.32792,2.71011,3.11472,3.42849,3.62571,3.83884,1.06815,0.755703,0.666417,0.672779,0.648956,0.623094,0.594489,0.489427,0.409398,0.275629,0.184113,0.0888581,0.0560245,0.0633664,0.038143,0.017985,0.00512587,1.07047]

console.log(actions.length)
console.log(values.length)
console.log(network_values.length)

env.chanceAction(actions[0])
currAction = actions[1]
currActionIndex = 2
tick = 0


/*
//Manual game:
currAction = 0
tick = -1
env.randomChanceAction()
*/

console.log(env)


function fillRect(color,sx,sy,l,w){
    ctx.fillStyle = color;
    ctx.fillRect(sx,sy,l,w);
}

function drawLine(color,p1x,p1y,p2x,p2y, width){
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(p1x,p1y);
    ctx.lineTo(p2x,p2y);
    ctx.stroke();
}

function fillCirc(color,x,y,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,2*pi);
    ctx.fillStyle = color;
    ctx.fill();
}

function fillText(text,color,size,x,y){
    ctx.font = String(size)+"px Arial";
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.fillText(text,x,y);
}

document.addEventListener("keydown",keyHandler);
document.addEventListener("click",clickHandler);

keyMove = ["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"]

function keyHandler(event){
    key = event.code
    event.preventDefault()
    for(i=0; i<4; i++){
        if(keyMove[i] == key){
            if(env.timer != TIME_LIMIT && env.validAgentAction(i)){
                currAction = i
                tick = 0
            }
        }
    }
}

function clickHandler(event){
    rect = canvas.getBoundingClientRect();
    x = event.clientX - rect.left;
    y = event.clientY - rect.top;
}

function draw(){
    fillRect(space, 0, 0, windx, windy)
    fillRect(cLine, marginx - border, marginy - border, boardx*cellS + 2*border, boardy*cellS + 2*border)
    fillRect(space, marginx, marginy, boardx*cellS, boardy*cellS)
    for(var i = 0; i < boardx; i++){
        for(var j = 0; j < boardy; j++){
            if((i + j) % 2 == 0){
                fillRect(cShade, marginx + j * cellS, marginy + i * cellS, cellS, cellS)
            }
        }
    }
    fillCirc(cApple, marginx + env.appley*cellS + cellS/2, marginy + env.applex*cellS + cellS/2, appleSize/2)
    for(i = 0; i < boardx; i++){
        for(j = 0; j < boardy; j++){
            type = env.snake[i][j]
            if(type != -1){
                centerx = marginx + j*cellS + cellS/2
                centery = marginy + i*cellS + cellS/2
                slideProp = tick / framesPerMove
                if(i == env.tailx && j == env.taily && (env.headx + dir[currAction][0] != env.applex || env.heady + dir[currAction][1] != env.appley)){
                    nextx = centerx + dir[type][1] * cellS * slideProp
                    nexty = centery + dir[type][0] * cellS * slideProp
                    fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    drawLine(cSnake, nextx, nexty, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                }
                else{
                    fillCirc(cSnake, centerx, centery, snakeWidth / 2)
                    if(type == 4){
                        nextDir = dir[currAction]
                        nextx = centerx + nextDir[1] * cellS * (tick / framesPerMove)
                        nexty = centery + nextDir[0] * cellS * (tick / framesPerMove)
                        drawLine(cSnake, centerx, centery, nextx, nexty, snakeWidth)
                        fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    }
                    else{
                        drawLine(cSnake, centerx, centery, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                    }
                }
            }
        }
    }
    fillText("Score: " + env.score.toString(), cText, textSize, windx/2, marginy/2)
    fillText("Timer: " + env.timer.toString(), cText, textSize, windx/2, marginy/2 + textSize * 1.5)


    fillText("Value", cValue, textSize, marginx/3, textSize)
    fillText(values[currActionIndex-1].toString(), cText, textSize, marginx*2/3, textSize)
    fillText("Search Value", cSearch, textSize, marginx/3, textSize*2)
    fillText(search_values[currActionIndex-1].toString(), cText, textSize, marginx*2/3, textSize*2)
    fillText("Network Value", cNetwork, textSize, marginx/3, textSize*3)
    fillText(network_values[currActionIndex-1].toString(), cText, textSize, marginx*2/3, textSize*3)

    drawLine(cValue, marginx/4, windy/2, marginx/4, windy/2 - values[currActionIndex-1] * 25, marginx/4)

    drawLine(cSearch, marginx*2/4, windy/2, marginx*2/4, windy/2 - search_values[currActionIndex-1] * 25, marginx/4)

    drawLine(cNetwork, marginx*3/4, windy/2, marginx*3/4, windy/2 - network_values[currActionIndex-1] * 25, marginx/4)

    //fillText("Reward", cText, textSize, marginx/4, 100)
    //fillText(values[currActionIndex-1].toString(), cText, textSize, marginx/4, 120)
    //drawLine(cText, marginx/4, windy/2, marginx/4, windy/2 + rewards[currActionIndex-1] * 100, 3)
}

endState = false

function update(){
    if(endState) return
    draw()
    tick++
    if(tick >= framesPerMove){
        tick = 0

        env.agentAction(currAction)
        if(env.actionType == 1){
            env.chanceAction(actions[currActionIndex])
            currActionIndex++
        }
        if(env.timer == TIME_LIMIT){
            endState = true
            return
        }

        // Check if there is only one valid action
        numValidActions = 0
        validAction = -1
        for(i = 0; i < 4; i++){
            if(env.validAgentAction(i)){
                numValidActions++
                validAction = i
            }
        }
        if(numValidActions == 0){
            endState = true
            return
        }
        if(numValidActions == 1){
            currAction = validAction
        }
        else{
            currAction = actions[currActionIndex]
            currActionIndex++
        }
    }
}

function updateManual(){
    draw()
    if(tick == -1){
        
    }
    else if(tick < framesPerMove){
        tick++
    }
    else{
        env.agentAction(currAction)
        tick = -1
        if(env.actionType == 1){
            env.randomChanceAction()
        }
    }
}

var ONE_FRAME_TIME = 1000 / 60 ;
var mainloop = function() {
    update()
    //updateManual()
};
setInterval( mainloop, ONE_FRAME_TIME );

</script>

</body>

</html>
