
<!DOCTYPE html>
<html>


<head>
<title> Visualizing snake </title>
</head>


<body>

<div class="panel">
<canvas id="canvas" width="1000" height="600" style="position:relative; top:50px; left:50px"></canvas>
</div>

<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
 
boardx = 10;
boardy = 10;
cellS = 40;
windx = 1000;
windy = 600;
marginx = (windx - boardx * cellS) / 2
marginy = (windy - boardy * cellS) / 2
border = 5
snakeWidth = 20
appleSize = 20
textSize = 20

framesPerMove = 7

dir = [[0,1], [1,0], [0,-1], [-1,0]];

pi = Math.PI;

space = "#fff"
cLine = "#000"
cShade = "#eee"
cSnake = "#00f"
cApple = "#f00"
cText = "#000"

cValue = "#d00"
cSearch = "#bb0"
cNetwork = "#0d0"

TIME_LIMIT = 1200

function randint(max){
    return Math.floor(Math.random()*max)
}

class Environment{
    constructor(){
        this.timer = 0
        this.score = 0;
        this.actionType = 0;
        this.snakeSize = 2;
        this.headx = boardx/2;
        this.heady = 2;
        this.tailx = this.headx;
        this.taily = 1;

        this.snake = []
        for(var i=0; i<boardx; i++){
            this.snake[i] = []
            for(var j=0; j<boardy; j++){
                this.snake[i][j] = -1;
            }
        }
        this.snake[this.headx][this.heady] = 4;
        this.snake[this.tailx][this.taily] = 0;
        this.applex = 0;
        this.appley = 0;
    }

    agentAction(actionIndex){
        this.timer ++
        var newHeadx = this.headx + dir[actionIndex][0];
        var newHeady = this.heady + dir[actionIndex][1];
        this.snake[this.headx][this.heady] = actionIndex;
        this.headx = newHeadx;
        this.heady = newHeady;
        this.snake[newHeadx][newHeady] = 4;

        if(this.headx == this.applex && this.heady == this.appley){
            this.score += 1;
            //score += 1 - timer*0.5/maxTime;
            this.snakeSize++;
            this.actionType = 1;
        }
        else{
            var tailDir = this.snake[this.tailx][this.taily];
            this.snake[this.tailx][this.taily] = -1;
            this.tailx += dir[tailDir][0];
            this.taily += dir[tailDir][1];
        }
    }

    chanceAction(actionIndex){
        this.applex = Math.floor(actionIndex / boardy);
        this.appley = actionIndex % boardy;
        this.actionType = 0
    }

    validAgentAction(d){
        var newHeadx = this.headx + dir[d][0];
        var newHeady = this.heady + dir[d][1];
        if(newHeadx == -1 || newHeadx == boardx){
            return false;
        }
        if(newHeady == -1 || newHeady == boardy){
            return false;
        }
        return this.snake[newHeadx][newHeady] == -1;
    }

    randomChanceAction(){
        while(true){
            this.applex = randint(boardx)
            this.appley = randint(boardy)
            if(this.snake[this.applex][this.appley] == -1){
                break
            }
        }
        this.actionType = 0
    }
}

env = new Environment();

//Agent game:
actions = [75,1,0,0,1,0,30,1,2,2,3,2,2,2,3,3,3,3,81,0,1,1,1,1,1,6,2,3,3,3,0,3,0,0,3,3,3,0,0,0,84,1,2,1,1,1,1,1,2,1,1,13,2,3,3,3,3,3,3,3,93,2,1,2,3,3,2,1,1,1,1,1,1,0,0,21,3,2,3,3,3,3,3,2,3,50,2,1,0,2,64,0,0,0,0,82,1,2,2,1,70,2,3,53,0,0,3,2,2,3,3,32,3,2,3,17,0,0,0,0,3,3,0,46,1,1,1,2,96,1,1,1,1,1,8,2,3,3,3,3,3,3,0,3,0,3,0,25,0,2,2,1,2,1,1,2,3,3,3,3,3,90,2,1,2,2,1,2,1,2,1,1,1,1,88,0,0,0,0,0,0,0,0,2,13,3,2,3,2,2,2,3,3,3,3,3,2,86,1,1,1,1,1,1,0,0,0,22,2,2,2,2,3,3,3,3,3,3,93,3,3,0,1,1,1,2,1,2,1,0,1,2,1,2,2,1,86,0,3,19,3,0,0,0,3,3,3,3,3,3,4,3,2,2,2,2,22,2,2,1,1,51,1,2,1,1,57,0,0,0,0,0,0,88,0,1,1,0,0,1,81,2,2,2,2,2,2,2,63,3,0,0,0,0,33,3,0,1,0,3,0,59,0,0,0,0,0,0,1,1,17,2,3,1,2,1,0,0,0,1,1,2,2,2,2,2,2,2,2,0,3,2,0,3,0,0,0,0,3,0,3,0,3,76,0,1,1,2,1,2,1,12,0,3,3,3,3,2,2,2,2,1,20,2,3,89,1,1,1,1,1,1,1,0,0,0,0,0,3,0,1,0,64,2,2,2,2,2,3,51,2,2,2,3,43,3,0,0,55,0,1,0,48,3,0,0,0,59,1,1,0,3,65,3,3,3,1,2,1,0,2,2,2,2,2,2,1,1,1,3,3,0,0,0,3,1,2,3,1,1,3,0,0,0,3,1,3,2,2,2,2,2,95,2,1,1,1,0,0,0,0,89,0,0,0,0,34,3,3,1,1,3,3,3,2,3,2,3,3,75,2,1,1,1,0,0,32,0,3,1,0,2,0,27,3,0,0,0,0,0,15,3,2,2,7,2,3,0,49,0,1,1,1,95,2,1,2,0,1,3,1,47,0,2,0,3,0,0]
values = [1.91866,2.01965,2.12594,2.23784,2.35562,2.4796,1.4796,1.55747,1.63944,1.72573,1.81656,1.91217,2.01281,2.11874,2.23026,2.34764,2.4712,2.60126,1.60126,1.68554,1.77425,1.86763,1.96593,2.0694,2.17831,1.17831,1.24033,1.37433,1.44666,1.5228,1.60295,1.68731,1.77612,1.8696,1.968,2.07158,2.18061,2.29538,2.41618,2.54335,1.54335,1.62458,1.71009,1.80009,1.89483,1.99456,2.09954,2.21004,2.32636,2.4488,2.57768,1.57768,1.66072,1.74812,1.84013,1.93698,2.03892,2.14624,2.2592,2.3781,1.3781,1.45063,1.52698,1.60735,1.69195,1.781,2.1866,2.30168,2.42282,2.55034,2.68457,2.82586,3.13115,3.29594,3.46941,2.46941,2.59938,2.73619,2.8802,3.03179,3.19136,3.35933,3.53613,3.72225,3.91815,2.91815,3.07174,3.40359,3.77129,3.96978,3.12608,3.29061,3.4638,3.64611,3.83801,2.83801,2.98738,3.14461,3.31012,3.48433,2.48433,2.61509,2.8976,2.45238,2.58145,2.71732,2.86033,3.01088,3.33615,3.51174,3.69657,2.69657,2.83849,2.98789,3.14514,2.14514,2.25805,2.37689,2.50199,2.63367,2.77229,2.9182,3.07179,2.07179,2.18083,2.29561,2.41643,2.54361,1.54361,1.62485,1.71037,1.80039,1.89515,1.99489,0.994894,1.04726,1.10238,1.16039,1.22147,1.28576,1.35343,1.42466,1.57857,1.66165,1.74911,1.84117,1.93807,0.938071,1.03941,1.15171,1.27613,1.34329,1.48841,1.56675,1.64921,1.73601,1.82738,1.92356,2.0248,2.13137,2.24354,1.24354,1.30899,1.37789,1.45041,1.52675,1.6071,1.69168,1.78072,1.87444,1.9731,2.07695,2.18626,2.30132,1.36982,1.44191,1.5178,1.59769,1.68177,1.77029,1.86346,1.96154,2.17345,2.28784,1.28784,1.35562,1.42697,1.50207,1.58113,1.66435,1.75195,1.84415,1.94121,2.04338,2.15093,2.26414,2.3833,1.3833,1.45611,1.53275,1.61342,1.69833,1.78772,1.88181,1.98085,2.08511,2.31037,1.31037,1.37933,1.45193,1.52835,1.60879,1.69346,1.78259,1.87641,1.97517,2.07913,2.18855,1.18855,1.25111,1.31696,1.53603,1.61688,1.70198,1.79155,1.88585,1.9851,2.08958,2.19956,2.31532,2.43718,2.99222,3.14971,3.31548,3.48998,3.67366,2.67366,3.11843,3.28256,2.28256,2.40269,2.52915,2.66226,2.80238,2.94987,3.10513,3.26856,3.44059,3.62167,3.81229,2.81229,3.11611,3.28011,3.45275,3.63447,3.82576,2.82576,2.97448,3.13104,3.29583,3.46929,2.46929,2.59926,2.73606,2.88006,3.03164,2.03164,2.13857,2.25113,2.36961,2.49433,2.62561,2.7638,1.7638,1.85663,2.16548,2.27945,2.39942,2.52571,2.65864,1.65864,1.74594,1.83783,1.93455,2.03637,2.14355,2.25637,2.37513,1.37513,1.4475,1.52368,1.60388,1.68829,2.07278,1.25124,1.45938,1.53619,1.61705,1.70215,1.79174,1.88604,0.886043,0.932677,0.981765,1.03344,1.08783,1.14508,1.20535,1.26879,1.33557,0.335568,0.35323,0.39139,0.41199,0.433673,0.456498,0.480525,0.505815,0.56046,0.589958,0.653693,0.688098,0.724314,0.762436,0.802564,0.844804,0.889267,0.936071,1.0372,1.09179,1.14925,1.27341,1.34043,1.41098,1.48524,1.56341,1.64569,1.73231,1.82348,2.02048,2.12682,2.23876,2.35659,1.35659,1.42799,1.50315,1.58226,1.7532,1.84547,2.04484,2.15246,1.15246,1.21312,1.34418,1.41492,1.56778,2.24502,2.36318,2.48756,2.61848,2.7563,2.90137,1.90137,2.00144,2.45724,1.45724,1.53394,1.61467,1.69965,1.78911,1.88327,1.98239,2.19656,2.31216,2.43386,2.56195,2.69679,2.83873,2.98814,3.14541,3.48522,3.86174,2.86174,3.1709,3.33779,3.51346,3.69838,3.89303,4.09793,3.09793,3.26098,3.43261,3.61327,3.80344,2.80344,2.95099,3.10631,3.2698,2.2698,2.38926,2.51501,2.64738,1.64738,1.73409,1.82535,1.92142,2.02255,1.02255,1.07637,1.13302,1.19265,1.25543,0.28302,0.297916,0.313595,0.347474,0.365762,0.385013,0.405277,0.497573,0.523761,0.551328,0.580345,0.61089,0.643042,0.676886,0.831038,0.874777,0.969282,1.0203,1.13052,1.19002,1.25266,1.31859,1.38799,0.387986,0.429901,0.476345,0.682113,0.755804,0.837456,0.881532,0.976767,1.02818,1.3987,1.54981,1.71724,1.80762,1.90276,2.00291,2.10832,2.21929,1.21929,1.35101,1.42212,1.49696,2.14361,2.25643,2.37519,2.5002,2.63179,1.63179,1.71768,1.80808,1.90324,2.10886,1.10886,1.16722,1.29331,1.36138,1.50846,1.58785,1.67142,1.94946,2.05207,2.16007,2.27376,2.39343,2.5194,1.5194,1.59937,1.68355,1.77216,1.86543,2.06695,2.17574,1.17574,1.51948,1.68363,2.06706,2.29037,2.5378,2.81197,1.81197,1.90734,2.00772,2.11339,2.22462,2.34171,2.46496,1.46496,1.54206,1.62322,1.70865,0.708653,0.74595,0.785211,0.915831,-0.0885986,-0.0981702,-0.103337,-0.108776,-0.114501,-1.1145,-1.17316,-1.36831,-1.51614,-1.67993,-1.86142,-2.06252,-2.40562,-5.98737,-6.6342,-7.35092,-7.73781,-8.14506,-8.57375,-10]
network_values = [2.38364,2.53369,2.68843,3.18219,2.99713,3.12569,1.74814,1.83752,2.01193,2.2171,1.91895,1.91611,2.32322,2.06335,2.45991,2.35109,2.85246,2.5837,2.08197,2.24862,2.15114,2.31023,2.56219,2.89039,2.64409,1.24511,1.35354,1.83605,1.59445,1.80753,1.84133,1.88179,1.94322,1.90523,2.01783,2.20832,2.24096,2.3939,2.51521,2.63203,1.5364,1.73897,1.59439,1.85784,1.78168,1.95398,2.18468,2.59444,2.49557,2.74558,2.82013,1.67215,1.81539,1.87261,2.05734,1.98364,2.08567,2.54424,2.67878,2.70799,1.60035,1.77239,1.8124,1.73543,1.54507,1.52166,1.88182,2.05109,1.72914,1.90925,1.94191,2.17616,2.48177,2.44958,2.69619,1.84612,1.68086,1.50562,1.50371,2.36872,2.30542,2.23126,2.52837,2.7556,2.83095,2.16338,2.07136,2.44959,2.45931,2.56814,2.00414,2.31875,2.40059,2.7245,2.94045,2.03672,2.2451,1.98517,2.3371,2.19092,2.09836,2.15829,1.94292,1.98771,2.22715,1.97959,2.16038,2.06862,2.49379,2.70906,2.83283,2.23628,2.74507,3.01733,2.69747,1.43912,1.6068,1.66664,1.85056,2.07696,2.14791,2.21601,2.61935,1.80798,2.17433,2.25312,2.5412,2.43752,1.77569,2.01085,2.08601,2.50949,2.55302,2.27417,1.24542,1.01621,1.08379,1.6296,0.983939,1.36419,1.51903,1.68199,1.59369,2.08867,2.20826,2.04485,1.94356,1.61988,1.82333,1.73552,1.58018,1.13414,1.69082,1.17848,1.11403,1.28369,1.50224,1.60255,2.43776,2.59478,2.36282,1.10823,1.25269,1.44943,1.40941,1.63771,1.4761,1.49215,1.57134,1.74793,1.89893,1.96989,1.93638,1.8238,1.54234,2.03042,1.64689,2.28459,2.19499,2.4238,2.74359,2.48925,2.57221,2.84917,1.32548,1.25078,1.45621,1.53339,1.51574,1.58861,1.70703,1.82971,2.18741,2.01375,2.29024,2.46326,2.46787,1.06925,1.28479,1.11696,1.23626,1.45101,1.68341,1.46144,1.81452,1.72758,2.17706,1.14832,1.00663,1.1104,1.35143,1.2232,1.53075,1.48372,1.43628,1.8095,2.09057,2.21038,1.26587,1.03394,1.14927,1.18943,1.18561,1.4935,1.49639,1.29429,1.54077,1.1197,1.46997,1.72172,1.67606,1.59984,1.75703,1.89836,2.22983,1.69313,1.80591,1.9086,1.81178,1.09369,0.909854,1.26343,1.0834,0.489854,1.5565,1.28727,1.40516,1.76688,2.37492,1.98381,1.28521,1.62567,2.15006,2.27326,2.34531,2.71968,1.64076,2.34617,2.26151,2.8329,2.66243,1.80893,1.8567,2.14295,2.33127,1.9907,0.571521,1.31818,1.57266,0.934454,1.92157,1.45967,2.39501,1.52058,1.22154,1.48072,1.67365,1.94421,2.17898,2.12439,0.96458,0.816538,1.26564,1.40765,0.917141,1.63754,1.62242,1.88287,1.29554,0.868862,1.39995,1.31054,0.123496,1.81288,1.564,1.37471,1.90798,1.75417,2.4475,2.1463,1.81905,1.17122,1.31492,1.07231,1.47605,1.55717,0.944167,1.83195,1.85984,1.26121,1.60356,1.09187,1.4138,0.807037,1.16873,0.868159,0.904494,0.89952,0.615458,0.792172,0.649288,0.729914,0.60634,0.525737,0.766421,1.03902,0.921056,1.02215,0.896132,0.930528,1.24373,1.13026,1.08639,1.36401,1.12199,0.874821,1.31334,1.56425,1.13002,1.7152,2.374,1.72169,2.0607,0.516963,0.7747,1.10227,1.16084,1.42704,0.929869,1.7507,1.79451,1.05067,0.585458,0.41806,0.876024,0.662648,0.741219,0.966749,1.76375,2.06915,2.18031,2.17685,1.70066,2.11948,2.13655,0.906693,0.96007,1.05085,1.16587,1.42756,1.43315,1.40414,1.17181,1.49644,1.10746,1.17577,1.53186,1.80753,1.79244,2.08286,2.27533,2.08694,1.31255,1.72299,1.55159,1.99978,1.87477,2.27436,2.71484,1.49665,2.19804,1.77443,2.23019,2.0078,1.85116,1.30522,1.98812,2.1148,1.33682,1.32186,1.55108,1.68284,1.19542,1.39859,1.5846,2.15761,1.00401,-0.201159,1.14606,-1.68083,-1.92207,-0.26166,-0.423745,0.480206,0.909492,0.638627,0.708311,0.76523,0.219307,-0.0135697,0.688186,0.582002,0.628993,0.508082,0.320699,0.283712,0.811359,0.154503,1.29895,1.35978,1.55151,1.44447,1.62183,1.33503,1.82741,0.828536,0.665432,0.866506,0.880286,1.05824,0.857126,0.780722,0.651341,0.445846,1.12991,0.982657,1.49222,1.18554,1.73801,1.83359,1.86131,1.96825,0.628179,1.20296,1.0979,0.790647,1.17602,1.33971,1.86582,2.05292,2.03305,1.18679,1.83329,2.11656,1.72323,1.74435,0.986986,1.10861,1.16893,1.18911,1.38174,1.32772,1.64631,2.03716,1.57249,2.2315,2.00999,2.45795,2.53695,1.29117,1.58981,1.38697,1.46211,1.8862,1.56764,1.84409,0.63891,0.966933,0.457059,1.3716,1.40217,1.67373,1.85231,1.30114,0.736621,0.975591,0.99851,1.25872,1.32721,1.77747,0.928928,1.05388,1.77038,1.24887,1.50004,0.453749,0.482531,0.0382926,0.788998,1.14093,1.20895,1.15418,1.71062,0.553213,0.6527,-0.0424105,0.762314,0.426465,0.821637,-0.752022,-1.0078,-1.22941,0.209263,-0.00835917,-0.471385,0.460284,0.747281,-0.0104666]
search_values = [2.03945,2.23586,2.44703,2.6538,2.78463,3.00785,1.47998,1.43403,1.54966,1.61628,1.69208,1.77943,1.95322,2.13047,2.29098,2.4483,2.60283,2.76694,1.53056,1.76671,1.98264,2.13095,2.31582,2.51062,2.71236,1.15141,1.14836,1.29259,1.36399,1.41595,1.4698,1.534,1.62287,1.7416,1.90897,2.10971,2.25817,2.39723,2.55914,2.72106,1.26621,1.37049,1.43165,1.52399,1.63889,1.8326,2.03673,2.2278,2.36141,2.56546,2.77448,1.28337,1.38811,1.58479,1.7757,1.93733,2.14013,2.32502,2.5108,2.70114,1.21777,1.22847,1.32601,1.28797,1.14493,1.11527,1.34879,1.57777,1.77135,1.89739,2.03546,2.16643,2.40587,2.54836,2.70211,1.2825,1.39975,1.4746,1.54896,1.69178,1.89395,2.11388,2.28741,2.44112,2.64501,2.02484,2.1172,2.24642,2.41842,2.57159,1.97249,2.16621,2.34347,2.52428,2.71876,1.75408,1.99349,2.18166,2.31515,2.4775,1.84447,2.04134,2.33514,1.36996,1.5086,1.73021,1.87648,2.0609,2.31141,2.50241,2.68843,2.05309,2.27595,2.41208,2.61395,1.35452,1.47647,1.60757,1.7896,1.99344,2.16937,2.30637,2.50563,1.87044,2.12754,2.2684,2.41521,2.58997,1.47287,1.67036,1.87535,2.05519,2.23341,2.41692,0.769453,0.741086,0.833503,0.972444,1.15128,1.32386,1.44498,1.56373,1.76827,1.88935,2.01346,1.84626,1.97221,0.686462,0.745169,0.729431,0.855793,0.874924,1.1091,1.34635,1.49791,1.58611,1.70022,1.80439,1.91176,2.03206,2.17554,0.869327,0.990496,1.04335,1.00114,1.07462,1.1823,1.45323,1.56534,1.79042,1.92446,2.05518,2.18674,2.31754,1.39651,1.57172,1.72008,1.83543,1.94787,2.0504,2.13872,2.24391,2.45631,2.61769,1.07557,1.02279,1.04901,1.11844,1.18688,1.22824,1.3046,1.50659,1.71201,1.88526,2.01283,2.13509,2.32275,0.767567,1.07829,1.24369,1.37517,1.50079,1.62178,1.73989,1.88221,2.00295,2.23765,0.676961,1.05847,1.25375,1.40957,1.5338,1.67145,1.78048,1.88937,2.00728,2.13267,2.26878,0.666215,0.660619,0.665256,0.795677,0.818372,0.845889,0.872593,0.851914,0.790611,0.921847,1.02235,1.14784,1.25556,1.5974,1.73001,1.87419,1.99544,2.13251,1.61819,1.9234,2.07315,0.727757,0.94949,1.22111,1.4184,1.55616,1.60684,1.69609,1.79208,1.89827,2.00965,2.14452,1.70009,1.92541,2.05772,2.18829,2.33158,2.47804,1.79331,1.98992,2.11766,2.23447,2.42185,1.53144,1.7294,1.84961,1.92809,2.09963,0.9527,1.11277,1.28243,1.46772,1.62227,1.79291,1.96785,1.05773,1.24026,1.47915,1.5768,1.70818,1.82329,1.95777,0.560737,0.86005,1.05766,1.26368,1.42605,1.55831,1.69043,1.81334,0.965664,1.2376,1.40902,1.52546,1.63861,1.99235,1.3164,1.66385,1.78675,1.72869,1.82216,1.93561,2.08235,0.723548,0.788969,1.09522,1.29846,1.45368,1.58601,1.71632,1.80804,1.93309,0.38417,0.249881,0.192565,0.0934358,-0.0421215,0.0218328,0.030245,0.0599732,0.10854,0.115794,0.145819,0.177003,0.235638,0.293054,0.360152,0.417864,0.482908,0.524277,0.600975,0.609848,0.640466,0.734912,0.706721,0.724094,0.745252,0.815438,1.00409,1.22883,1.35195,1.55911,1.66544,1.75273,1.9227,0.503308,0.807851,1.02798,1.13077,1.28957,1.38405,1.54862,1.6916,0.220401,0.425535,0.685946,0.870427,1.00323,1.45773,1.57499,1.68546,1.79327,1.89016,2.024,1.73619,1.92455,2.36912,0.524669,0.514643,0.53378,0.553747,0.764037,0.922963,1.01392,1.12556,1.13886,1.26572,1.36121,1.45206,1.196,1.35527,1.55968,1.84284,2.08943,1.43627,1.65104,1.8149,1.95829,2.09757,2.24054,2.40696,1.46252,1.6308,1.79356,1.95915,2.07335,1.66686,1.63347,1.74242,1.90944,1.39627,1.49452,1.65296,1.74942,0.790016,0.878171,0.936789,1.072,1.19668,0.265115,0.950658,1.11596,1.1882,1.25915,-0.175181,-0.155454,-0.154308,-0.130651,-0.107363,-0.186686,-0.0291773,0.175742,0.245535,0.341213,0.420845,0.478042,0.550635,0.611873,0.77364,0.854746,0.96194,1.02346,1.13794,1.19135,1.24717,1.26888,1.3848,-0.0569007,0.026275,0.100915,0.175298,0.29413,0.446238,0.576887,0.673251,0.759677,1.04779,1.06451,1.20092,1.24851,1.31566,1.3585,1.47073,1.58024,0.776521,0.965255,1.07086,1.15451,1.6637,1.77942,1.89929,2.01817,2.14483,1.59668,1.73042,1.86169,1.98505,2.2259,0.59794,0.695048,0.828904,1.00725,1.21873,1.35488,1.47612,1.75176,1.86689,1.99876,2.06351,2.22948,2.4085,0.647101,0.797383,0.93751,1.02497,1.1061,1.24459,1.34764,0.745631,1.02371,1.14899,1.38526,1.50365,1.6754,1.88525,0.943419,1.12318,1.265,1.36688,1.4657,1.60174,1.7364,1.14244,1.32375,1.47782,1.59404,1.05301,1.15865,1.0528,1.25695,0.90673,1.01672,0.962351,0.975355,1.01881,0.0114395,0.223471,0.307541,0.387926,0.460358,0.50131,0.544392,0.656095,-5.7088,-6.56137,-7.24922,-7.77226,-8.14679,-8.56243,-10]

function updateEnvironment(index){
    env = new Environment()
    for(i=0; i<index; i++){
        if(i == 0 || env.actionType == 1){
            env.chanceAction(actions[i])
        }
        else{
            env.agentAction(actions[i])
        }
        while(env.actionType == 0){
            // Check if there is only one valid action
            numValidActions = 0
            validAction = -1
            for(d = 0; d < 4; d++){
                if(env.validAgentAction(d)){
                    numValidActions++
                    validAction = d
                }
            }
            if(numValidActions == 1){
                env.agentAction(validAction)
            }
            else{
                break
            }
        }
    }
}


updateEnvironment(1)
currAction = actions[1]
currActionIndex = 2

/*
updateEnvironment(203)
currAction = actions[203]
currActionIndex = 204
*/
tick = 0


/*
//Manual game:
currAction = 0
tick = -1
env.randomChanceAction()
*/

console.log(env)


function fillRect(color,sx,sy,l,w){
    ctx.fillStyle = color;
    ctx.fillRect(sx,sy,l,w);
}

function drawLine(color,p1x,p1y,p2x,p2y, width){
    ctx.strokeStyle = color;
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(p1x,p1y);
    ctx.lineTo(p2x,p2y);
    ctx.stroke();
}

function fillCirc(color,x,y,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,2*pi);
    ctx.fillStyle = color;
    ctx.fill();
}

function fillText(text,color,size,x,y){
    ctx.font = String(size)+"px Arial";
    ctx.fillStyle = color;
    ctx.textAlign = "center";
    ctx.fillText(text,x,y);
}

document.addEventListener("keydown",keyHandler);
document.addEventListener("click",clickHandler);

keyMove = ["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"]

paused = true

function keyHandler(event){
    key = event.code
    event.preventDefault()
    /*
    for(i=0; i<4; i++){
        if(keyMove[i] == key){
            if(env.timer != TIME_LIMIT && env.validAgentAction(i)){
                currAction = i
                tick = 0
            }
        }
    }
    */
    if(key == "Space"){
        paused = !paused
        if(paused){
            tick = 0
        }
    }
    if(key == "ArrowRight"){
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowLeft"){
        while(true){
            currActionIndex--
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
    if(key == "ArrowDown"){
        currActionIndex = 2
        currAction = actions[currActionIndex-1]
        updateEnvironment(currActionIndex-1)
    }
    if(key == "ArrowUp"){
        currActionIndex = actions.length - 15
        while(true){
            currActionIndex++
            currAction = actions[currActionIndex-1]
            updateEnvironment(currActionIndex-1)
            if(env.actionType == 0){
                break
            }
        }
    }
}

function clickHandler(event){
    rect = canvas.getBoundingClientRect();
    x = event.clientX - rect.left;
    y = event.clientY - rect.top;
}

function draw(){
    fillRect(space, 0, 0, windx, windy)
    fillRect(cLine, marginx - border, marginy - border, boardx*cellS + 2*border, boardy*cellS + 2*border)
    fillRect(space, marginx, marginy, boardx*cellS, boardy*cellS)
    for(var i = 0; i < boardx; i++){
        for(var j = 0; j < boardy; j++){
            if((i + j) % 2 == 0){
                fillRect(cShade, marginx + j * cellS, marginy + i * cellS, cellS, cellS)
            }
        }
    }
    fillCirc(cApple, marginx + env.appley*cellS + cellS/2, marginy + env.applex*cellS + cellS/2, appleSize/2)
    for(i = 0; i < boardx; i++){
        for(j = 0; j < boardy; j++){
            type = env.snake[i][j]
            if(type != -1){
                centerx = marginx + j*cellS + cellS/2
                centery = marginy + i*cellS + cellS/2
                slideProp = tick / framesPerMove
                if(i == env.tailx && j == env.taily && (env.headx + dir[currAction][0] != env.applex || env.heady + dir[currAction][1] != env.appley)){
                    nextx = centerx + dir[type][1] * cellS * slideProp
                    nexty = centery + dir[type][0] * cellS * slideProp
                    fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    drawLine(cSnake, nextx, nexty, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                }
                else{
                    fillCirc(cSnake, centerx, centery, snakeWidth / 2)
                    if(type == 4){
                        nextDir = dir[currAction]
                        nextx = centerx + nextDir[1] * cellS * (tick / framesPerMove)
                        nexty = centery + nextDir[0] * cellS * (tick / framesPerMove)
                        drawLine(cSnake, centerx, centery, nextx, nexty, snakeWidth)
                        fillCirc(cSnake, nextx, nexty, snakeWidth / 2)
                    }
                    else{
                        drawLine(cSnake, centerx, centery, centerx + dir[type][1] * cellS, centery + dir[type][0] * cellS, snakeWidth)
                    }
                }
            }
        }
    }
    fillText("Score: " + env.score.toString(), cText, textSize, windx/2, marginy/2)
    fillText("Timer: " + env.timer.toString(), cText, textSize, windx/2, marginy/2 + textSize * 1.5)


    fillText("Value", cValue, textSize, marginx/3, textSize)
    fillText(values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize)
    fillText("Search Value", cSearch, textSize, marginx/3, textSize*2)
    fillText(search_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*2)
    fillText("Network Value", cNetwork, textSize, marginx/3, textSize*3)
    fillText(network_values[currActionIndex-2].toString(), cText, textSize, marginx*2/3, textSize*3)

    drawLine(cValue, marginx/4, windy/2, marginx/4, windy/2 - values[currActionIndex-2] * 25, marginx/4)

    drawLine(cSearch, marginx*2/4, windy/2, marginx*2/4, windy/2 - search_values[currActionIndex-2] * 25, marginx/4)

    drawLine(cNetwork, marginx*3/4, windy/2, marginx*3/4, windy/2 - network_values[currActionIndex-2] * 25, marginx/4)

    //fillText("Reward", cText, textSize, marginx/4, 100)
    //fillText(values[currActionIndex-1].toString(), cText, textSize, marginx/4, 120)
    //drawLine(cText, marginx/4, windy/2, marginx/4, windy/2 + rewards[currActionIndex-1] * 100, 3)
}

endState = false

function update(){
    if(endState) return
    draw()
    if(!paused){
        tick++
    }
    if(tick >= framesPerMove){
        tick = 0

        env.agentAction(currAction)
        if(env.actionType == 1){
            env.chanceAction(actions[currActionIndex])
            currActionIndex++
        }
        if(env.timer == TIME_LIMIT){
            endState = true
            return
        }

        // Check if there is only one valid action
        numValidActions = 0
        validAction = -1
        for(i = 0; i < 4; i++){
            if(env.validAgentAction(i)){
                numValidActions++
                validAction = i
            }
        }
        if(numValidActions == 0){
            endState = true
            return
        }
        if(numValidActions == 1){
            currAction = validAction
        }
        else{
            currAction = actions[currActionIndex]
            currActionIndex++
        }
    }
}

function updateManual(){
    draw()
    if(tick == -1){
        
    }
    else if(tick < framesPerMove){
        tick++
    }
    else{
        env.agentAction(currAction)
        tick = -1
        if(env.actionType == 1){
            env.randomChanceAction()
        }
    }
}

var ONE_FRAME_TIME = 1000 / 60 ;
var mainloop = function() {
    update()
    //updateManual()
};
setInterval( mainloop, ONE_FRAME_TIME );

</script>

</body>

</html>
